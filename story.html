<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Le Storie</title>
</head>
<body>
    <div id="cards-container">
<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 A City Stroll </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "A City Stroll",
            content: `Sarah *came* to a new city. She *felt* happy. She *left* her hotel and *went* for a walk. She *saw* tall buildings and many people. She *came* to a big park. Inside, she *found* a small, quiet path. She *knew* it *was* special. Birds *sang* in the trees. The sun *made* the leaves **glow**. Sarah *sat* on a bench. She *ate* a small sandwich she *had bought*. She *drank* water. She *thought* this **spot** *was* wonderful. She *felt* very **peaceful**. She *took* many photos. She *would tell* her friends. Exploring *was* fun!`,
            level: "A2",
            difficultWords: {"glow":"to produce a soft, steady light","spot":"a particular place or area","peaceful":"quiet and calm; without trouble"}
          },
          b1: {
            title: "A City Stroll",
            content: `Upon arrival, Sarah *felt* an immediate **urge** to explore the new city on foot. She *left* her hotel and *went* out, hoping to *find* something truly special. As she *walked*, the city's vibrant energy *began* to *draw* her in. She *saw* bustling markets and impressive architecture. She *came* across a large, green park where many people *sat*. Following a narrow path, she *found* a hidden garden. The quiet atmosphere *made* her *feel* completely at ease. Birds *sang* soft melodies. Sunlight *shone* through the canopy, creating a beautiful **dapple** effect on the ground. She *chose* a secluded bench and *sat* down, *eating* a croissant she *had bought*. She *drank* coffee, *letting* the peacefulness *overtake* her. She *knew* she *had found* her new favorite **spot**. She *took* out her sketchbook and *began* to *draw* the scene, feeling inspired. This spontaneous walk *gave* her unexpected joy.`,
            level: "B1",
            difficultWords: {"urge":"a strong desire or impulse","dapple":"a pattern of spots or patches of light and shade","spot":"a particular place or area"}
          },
          c1: {
            title: "A City Stroll",
            content: `Upon her arrival, Sarah *felt* an irresistible **impulse** to *delve* into the city's authentic character. She *left* her luggage at the hotel, *driven* by a fervent desire to *seek* its hidden **gems**. As she *wound* through the labyrinthine streets, the city's vibrant pulse *held* her attention. She *beheld* an eclectic mix of ancient architecture and contemporary structures. She *came* upon an expansive public park where families *lay* on the verdant grass and children *ran* freely. Following a less-traveled path, she *found* a secluded botanical garden, a veritable oasis amidst the urban sprawl. The profound serenity *made* her *feel* utterly at peace. Birds *sang* intricate melodies that *swept* through the tranquil space. Sunlight *shone* through the dense foliage, *casting* a beautiful **dappled** pattern on the ground. She *chose* a weathered stone bench and *sat* down, *savouring* an artisanal pastry she *had bought*. She *drank* rich espresso, *letting* the quietude *overcome* her spirit. She *knew* she *understood* she *had found* a true treasure. She *took* out her sketchbook and *began* to *draw* the scene, utterly *drawn* into its enchantment. This unplanned expedition *brought* her an unexpected, profound sense of contentment, far *beyond* what she *had dreamt* of.`,
            level: "C1",
            difficultWords: {"impulse":"a sudden, strong urge or desire to act","gems":"something highly valued or cherished, often a place or object","dappled":"marked with spots or patches of light and shade"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Exam Morning </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Exam Morning (A2)",
            content: `Lisa *woke* up early. She *felt* a little **nervous**. Today *was* her big exam. She *got* out of bed and *went* to the kitchen. She *ate* breakfast and *drank* some juice. Her mom *said*, "You *can* *do* it!" Lisa *knew* her books well. She *had* *read* them many times. She *put* her pens in her bag and *chose* a lucky one. The sun *began* to **shine** brightly. Lisa *left* home and *began* to walk fast. She *felt* more **calm** now. She *was* ready to *write* everything she *knew*.`,
            level: "A2",
            difficultWords: {"nervous":"feeling worried or afraid.","shine":"to give out bright light.","calm":"not feeling excited, upset, or worried."}
          },
          b1: {
            title: "The Exam Morning (B1)",
            content: `Lisa *woke* up early, a knot of **apprehension** *tightening* in her stomach. Today *was* the day of her crucial exam, and she *felt* a weight on her shoulders. She quickly *got* out of bed and *went* to the kitchen. She *ate* a light breakfast and *drank* her tea slowly, trying to *keep* her thoughts steady. Her mother *came* in and *said*, "You've *done* all the work, you *know* this material!" Lisa *had* *read* her notes thoroughly for weeks; she *hadn't* *forgotten* anything important. She *took* her special pens and *put* them carefully in her bag. Outside, the morning sun *began* to **shine** brightly through the window, making the room *feel* warm and comforting. Lisa *left* the house, *walking* with a determined stride. The fresh air *made* her *feel* a sense of **resolve**, and her anxiety *began* to *fade*. She *knew* she *could* *do* her best.`,
            level: "B1",
            difficultWords: {"apprehension":"a feeling of worry or fear that something bad might happen.","shine":"to produce or reflect light.","resolve":"firm determination to do something."}
          },
          c1: {
            title: "The Exam Morning (C1)",
            content: `A jolt of **trepidation** *awoke* Lisa before her alarm *had* even *rung*. This *was* the culmination of months of meticulous preparation, the pivotal examination that *would* *dictate* her academic trajectory. She *sprang* from bed, a resolute glint in her eyes, and *made* her way to the kitchen. There, she *ate* a light but nutritious breakfast, *drank* herbal tea to *still* her racing pulse. Her mother, ever perceptive, *came* and *spoke* words of profound encouragement: "You've *shown* immense dedication; you *know* this material intrinsically." Lisa *had* *read* every treatise, *absorbed* every lecture; she *had* *left* no stone *unturned*. She *chose* her favourite fountain pen, its brass gleam a beacon of luck, and *put* it alongside a pristine notepad in her satchel. Outside, the nascent morning sun *began* to **radiate** warmth, and its rays *shone* brightly, a welcome contrast to her internal **turmoil**. Lisa *went* out, *breathing* deeply the crisp air that *felt* like a tonic. A surge of conviction *rose* within her, *dispelling* the lingering doubts. She *knew* she *was* ready to *tackle* the formidable challenge and *bear* the weight of expectation.`,
            level: "C1",
            difficultWords: {"trepidation":"a feeling of fear or anxiety about something that may happen.","radiate":"to send out rays of light or heat; to show an emotion or quality strongly.","turmoil":"a state of great disturbance, confusion, or uncertainty."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Reaching New Heights </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Reaching New Heights",
            content: `Leo *had* a big fear of heights. He *did* not like tall places. One day, his friends *came* and *said*, "Let's *go* to the Sky **Tower**!" Leo *felt* afraid. His heart *went* fast. He *knew* it *was* hard, but he *chose* to *try*. His friend Mia *gave* him a smile. They *went* up. Leo *took* small steps. He *held* the rail tight. Finally, he *stood* at the top. He *saw* a beautiful **view** of the city. He *began* to *feel* good. His fear *did not seem* so big now. He *knew* he *was* **brave**. He *made* a big step forward. He *had done* it!`,
            level: "A2",
            difficultWords: {"Tower":"A very tall building or structure.","View":"What you can see from a place.","Brave":"Not afraid."}
          },
          b1: {
            title: "Reaching New Heights",
            content: `Leo *had* a deep fear of heights. High places *made* him *feel* uneasy. One afternoon, his friends *came* with an exciting idea. They *said*, "Let's *go* to the Sky Tower's **Observation Deck**!" Leo *felt* his stomach *do* a flip. He *knew* this *would be* a challenge. But he *chose* to *overcome* his fear. Mia, his close friend, *gave* him reassuring words. They *began* their ascent. Leo's palms *grew* sweaty. He *took* slow, careful steps, *keeping* his hand firmly on the railing. When he finally *stood* at the peak, he *saw* a **vast** panorama of the city below. A sense of awe *came* over him. He *understood* that his fear *did not define* him. He *felt* a surge of **courage**. He *took* a deep breath and *knew* he *had become* stronger.`,
            level: "B1",
            difficultWords: {"Observation Deck":"A high platform from which people can look at a view.","Vast":"Very big.","Courage":"The ability to do something that is difficult or dangerous."}
          },
          c1: {
            title: "Reaching New Heights",
            content: `Leo *had long been* afflicted by a profound fear of heights. Towering structures and sheer drops *always made* him *feel* a debilitating sense of **vertigo**. One crisp autumn afternoon, his friends *came* with an enticing proposition. They *bid* him *join* them at the Sky Tower's newly opened **panorama** deck! Leo *felt* a familiar dread *begin* to coil in his stomach. He *knew* this *was* a formidable test. Yet, he *chose* to *overcome* this deeply ingrained phobia. Mia, his steadfast friend, *gave* him gentle encouragement, *knowing* his struggle. As they *began* their ascent, Leo's hands *grew* clammy, but he *did not let* his resolve *waver*. He *took* deliberate, measured steps, his gaze *kept* on the floor, occasionally *casting* a quick *glance* at Mia. Reaching the summit, he slowly *brought* his eyes up. What he *saw* *was* a breathtaking sprawl of the city, stretching into the horizon. A profound shift *came* over him. He *understood* that he *had overcome* a significant internal barrier. The paralyzing grip of fear *had been broken*. A powerful wave of **resilience** *swept* over him. He *felt* an unprecedented sense of liberation. He *knew* he *had truly become* transformed.`,
            level: "C1",
            difficultWords: {"Vertigo":"A feeling of dizziness caused by looking down from a high place.","Panorama":"A wide and unobstructed view of an extensive area in all directions.","Resilience":"The ability to recover quickly from difficulties; toughness."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Leo's Sky Dream </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Leo's Sky Dream",
            content: `Leo *had* a big dream. He wanted to *build* a flying drone. He *spent* many hours *drawing* plans. Then he *went* to a shop and *bought* many **parts**. Leo *began* to *put* the drone together. It *was* hard work, but he *kept* trying. He *knew* he *had* to finish it. Finally, the drone *was* ready. He *took* it outside for its first flight. He *set* it on the grass. Leo *pressed* a button. The drone *got* high! He *felt* so **proud**. He *saw* his house from high above. It *was* an amazing **adventure**. His dream *came* true.`,
            level: "A2",
            difficultWords: {"parts":"small pieces that make up something bigger.","proud":"feeling happy about something good you did.","adventure":"an exciting or unusual experience."}
          },
          b1: {
            title: "Leo's Sky Dream",
            content: `Leo *had* a passionate dream: to *build* his very own flying drone. He *spent* countless hours *drawing* detailed blueprints and *thinking* about the design. Next, he *went* to various stores and *bought* all the necessary **components**. Leo *began* the complex process of *putting* the drone together, following instructions carefully. It *was* a challenging task, but he *kept* his focus and *knew* he would *see* it fly. Finally, the drone *was* complete. He *took* it to an open field for its maiden flight. He *set* it gently on the ground and *pressed* the launch button. The drone *rose* into the air and *flew* steadily. Leo *felt* a rush of **elation** as he *saw* the world from a new perspective. His ambitious **endeavor** *came* to life.`,
            level: "B1",
            difficultWords: {"components":"individual pieces that make up a larger machine or system.","elation":"a feeling of great happiness and excitement.","endeavor":"an attempt to achieve a goal."}
          },
          c1: {
            title: "Leo's Sky Dream",
            content: `Leo *had* long *sought* a profound aspiration: to *build* his own aerial drone. He *spent* countless evenings meticulously *drawing* intricate schematics and *thinking* about the optimal design. Subsequently, he *went* to specialized vendors and *bought* all the essential **components**. Leo *began* the arduous process of *assembling* the drone, carefully *binding* wires and *fitting* circuits. He *knew* the undertaking *was* formidable, yet he *kept* his resolve, *driven* by his vision. Eventually, the sophisticated device *was* complete. He *took* it to a vast, unobstructed expanse for its inaugural flight. He *set* it gingerly on the earth and *pressed* the activation switch. The drone *rose* majestically and *flew* into the sky, its rotors whirring as it ascended. Leo *felt* an overwhelming wave of **exhilaration** as he *saw* the landscape from an unprecedented **pinnacle**. His audacious dream *had* truly *come* to fruition.`,
            level: "C1",
            difficultWords: {"intricate":"very complicated or detailed.","exhilaration":"a feeling of strong excitement, happiness, or thrill.","pinnacle":"the most successful point; the culmination."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Sir Gareth and the Whispering Woods </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Sir Gareth and the Whispering Woods (A2)",
            content: `Sir Gareth *was* a brave knight. He *heard* a problem: a dark **shadow** *came* over the Whispering Woods. People *felt* very scared. Sir Gareth *knew* he *had* to help. He *put* on his **armor** and *went* to the woods. Inside, he *saw* a big, black bird. This bird *took* the sun's light. Sir Gareth *drew* his sword. He *began* to *fight* the bird. He *threw* his sword. The bird *flew* away. The light *came* back to the woods. Everyone *was* happy. They *said*, "Sir Gareth *is* a hero!" Sir Gareth *felt* **proud**. He *became* the hero of the land.`,
            level: "A2",
            difficultWords: {"shadow":"a dark area made when light is blocked","armor":"special clothes knights wear to protect them","proud":"feeling pleased and happy about something you did"}
          },
          b1: {
            title: "Sir Gareth and the Whispering Woods (B1)",
            content: `Sir Gareth *was* a **valiant** knight. He *heard* whispers of a dark **ominous** presence that *fell* upon the Whispering Woods. The villagers *felt* deep fear. Sir Gareth *knew* he *had* to intervene. He *put* on his gleaming armor and *rode* to the forest. As he *went* deeper, he *saw* a **colossal**, shadowy bird that *had taken* all the sunlight. The air *became* cold. Sir Gareth *drew* his shining sword, *ready* to *fight*. He *threw* his shield to distract it and *began* to battle the creature. The bird *flew* wildly, then *came* crashing down before it *fled* into the darkness. The sun’s warmth *returned*. The villagers *came* to the woods, and *saw* the light. They *spoke* of his bravery. Sir Gareth *felt* a sense of peace. He *became* a legend, *known* throughout the kingdom.`,
            level: "B1",
            difficultWords: {"valiant":"very brave or courageous","ominous":"suggesting that something bad is going to happen","colossal":"extremely large or great"}
          },
          c1: {
            title: "Sir Gareth and the Whispering Woods (C1)",
            content: `Sir Gareth *was* an **undaunted** knight, his reputation *preceded* him. He *heard* chilling tales of a malevolent shadow that *had fallen* upon the ancient Whispering Woods, *causing* profound dread among the populace. Gareth *knew* he *had* to intervene. He *donned* his meticulously crafted armor and *rode* forth towards the **somber** forest. Deep within its labyrinthine depths, he *perceived* a gargantuan, ebony avian creature that *had seized* the sun’s luminescence, plunging the woods into perpetual gloom. The atmosphere *became* increasingly oppressive. Sir Gareth *drew* his **resplendent** sword, its hilt *felt* cold in his grip, and *prepared* to *contend* with the entity. He *threw* his gauntlet to distract it and *began* a fierce engagement. The monstrous fowl *flew* with immense power, *beating* its wings, before it *came* crashing down, then *fled* into the deeper recesses of the woods. Slowly, the sun's radiant warmth *returned*. The grateful villagers *came* to behold the restored light, their voices *rose* in acclamation. Sir Gareth *felt* a deep sense of accomplishment. He *became* not merely a hero, but a legendary figure, whose valor *was spoken* of for generations.`,
            level: "C1",
            difficultWords: {"undaunted":"not afraid or discouraged by difficulty, danger, or disappointment","somber":"dark or dull in color or tone; gloomy","resplendent":"shining brilliantly; very bright"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Rainy Day Revelry </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Rainy Day Board Games",
            content: `The rain *began* to fall. Leo and Mia *knew* they *couldn't* *go* outside to play. They *felt* a little sad. "Let's *find* games!" Mia *said*. Leo *went* to the closet and *brought* out many boxes. They *chose* a fun game. They *sat* down and *began* to play. They *ate* cookies and *drank* juice. Mia *won* the first game! They *had* so much fun. The rain *fell* all day, but they *did not* *feel* bored. They *made* their own sunny day inside. It *was* a **great** day. They *kept* playing. The room *felt* **cozy** and warm, a perfect **escape**.`,
            level: "A2",
            difficultWords: {"great":"very good, excellent","cozy":"comfortable and warm","escape":"a way to get away from something or somewhere"}
          },
          b1: {
            title: "The Rainy Day Board Game Marathon",
            content: `Heavy rain *began* to *fall* outside, *making* Leo and Mia *understand* their sports plans *were* off. "We *can't* *go* out," Leo *said*, feeling a little disappointed. "But we *can make* our own fun!" Mia replied, her eyes *light* up. They *went* to the cupboard and *brought* out a stack of board games. They *chose* "Quest for the Crystal." They *sat* at the table, a cozy **ambiance** filling the room. They *began* to play, their laughter echoing. They *drank* warm tea and *ate* homemade sandwiches. Mia *was* quite good; she *won* two games straight! They *felt* cheerful, the rainy day *having given* them an unexpected gift. They *kept* playing until the sky *grew* dark, *having spent* the entire afternoon in delightful competition. It *was* a truly **memorable** day, far better than they *had thought*. The **pitter-patter** of rain on the window sounded like applause.`,
            level: "B1",
            difficultWords: {"ambiance":"the character and atmosphere of a place","memorable":"worth remembering or easily remembered, especially because of being special or unusual","pitter-patter":"the sound of light, quick taps"}
          },
          c1: {
            title: "The Rainy Day Board Game Marathon",
            content: `The storm *broke* without warning, *sending* sheets of rain down, and *making* Leo and Mia's outdoor plans *fall* through. "Our cycling trip *is* definitely off," Leo *said*, *feeling* a pang of disappointment. Mia, however, *saw* opportunity. "This *is* a chance to *make* our own **exhilarating** fun!" she *told* him. They *went* to their games collection, *bringing* forth a treasure trove. They *chose* "Lords of Strategy," its complex rules *meant* a worthy challenge. As the rain *beat* against the panes, they *began* their contest, the atmosphere *kept* lively with focused energy. They *drank* artisan tea and *ate* an array of homemade **delicacies**. Mia *proved* a tactical genius, *winning* an impressive four consecutive rounds. The initial setback *gave* way to genuine pleasure. They *kept* playing until dusk *fell*, *having found* their perfect indoor **diversion**. The rhythmic drip of the rain *became* the backdrop to their day of wits.`,
            level: "C1",
            difficultWords: {"exhilarating":"making one feel very happy, animated, or thrilled; exciting","delicacies":"rare or expensive foods that are considered very appealing","diversion":"an activity that distracts the mind from tedious or serious concerns; a pastime"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Olly and the Whispering Woods </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Olly and the Whispering Woods",
            content: `Olly *was* a shy owl. He *did* not *speak* much. One night, a strange light *began* to **glow** from the **Whispering** Woods. The animals *felt* scared. A fox *came* and *said*, "I *saw* a bright light!" A rabbit *ran* away. Animals *hid*. Olly *knew* he *had* to *do* something. He *took* a breath and *flew* into the woods. He *went* to the light. He *found* a small firefly that *was* *lost*. Olly *brought* it back. The animals *understood*. They *felt* **relief**. They *became* happy. Olly *felt* proud he *did* a good thing.`,
            level: "A2",
            difficultWords: {"glow":"to produce a soft light","Whispering":"making a soft, quiet sound","relief":"a feeling of happiness when something bad stops"}
          },
          b1: {
            title: "Olly and the Whispering Woods",
            content: `Olly *was* a quiet young owl who rarely *spoke*. He *kept* to himself, observing the forest from afar. One evening, a mysterious light *began* to **shine** from the heart of the Whispering Woods. Fear *spread* among the forest creatures. A nervous fox *came* and *told* everyone, "I *saw* a **peculiar** light! It *made* my fur *stand* on end!" Other animals *fled* and *hid*. Olly *felt* a strong urge to act. He *knew* he *had* to *find* out what *it* *was*. He *took* a deep breath, *spread* his wings, and *flew* directly towards the **eerie** glow. He *went* deeper and deeper until he *found* a tiny, disoriented firefly that *had* *lost* its way. Olly gently *brought* the firefly back. The animals *understood* the harmless truth and *felt* immediate relief. They *became* joyous. Olly *felt* immense pride, knowing he *had* *shown* courage and *made* a difference.`,
            level: "B1",
            difficultWords: {"shine":"to produce light","peculiar":"unusual and strange","eerie":"strange and frightening"}
          },
          c1: {
            title: "Olly and the Whispering Woods",
            content: `Olly, a reticent young owl, habitually *kept* to the shadows, rarely *spoke* a sound beyond a soft hoot. He *chose* to observe, often *feeling* disconnected from the lively forest **din**. One fateful twilight, an enigmatic luminescence *began* to *shine* from the very core of the ancient Whispering Woods. A palpable sense of dread *swept* through the animal populace. A visibly distressed fox *came* into the clearing and *told* everyone, "I *beheld* an unearthly glow! It *made* my fur *stand* on end!" Scores of creatures *fled*, seeking refuge and *crept* into their hidden burrows. Olly, despite his innate shyness, *felt* an undeniable compulsion to intervene. He *knew* he *could* not *forgo* his responsibility to *find* the truth. He *drew* a deep breath, *spread* his powerful wings, and *flew* resolutely towards the **radiant** source. He *went* deeper into the sylvan depths until he *found* a miniscule, disoriented firefly that *had* *lost* its way. Olly gently *bore* the minuscule creature back to the assembled throng. The animals, *having* *understood* the innocuous reality, *felt* profound relief. Their apprehension *fell* away, and joy *rose* among them. Olly *felt* an unprecedented sense of accomplishment, realizing he *had* *overcome* his own inhibitions and *wrought* a tangible difference.`,
            level: "C1",
            difficultWords: {"din":"a loud, unpleasant, and prolonged noise","radiant":"sending out light; shining or glowing brightly","sylvan":"relating to or characteristic of woods or forests"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Family Reunion Day </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "A Special Family Day",
            content: `Leo *was* excited. It *was* the big family picnic. He *came* to the park with his mom and dad. Many people *were* there. A big blanket *was* **spread** on the grass. Leo *saw* his Grandma Rose. She *gave* him a big hug. He *felt* happy.
They all *ate* yummy food. Grandma *made* special cookies. Leo *drank* juice. He *ran* and *played* with his cousins. They *threw* a ball. Leo *heard* much **laughter**. It *was* a fun day. Everyone *had* a good time. They *became* closer. Leo *knew* he *would* remember this day. He *felt* a strong **bond**.`,
            level: "A2",
            difficultWords: {"spread":"stretched out or opened wide.","laughter":"the sound of people laughing.","bond":"a strong connection or feeling of unity between people."}
          },
          b1: {
            title: "The Joyful Family Reunion",
            content: `Leo *felt* a mix of **anticipation** and shyness. It *was* the annual family reunion, held at Oakwood Park. He *came* with his parents, carrying a large fruit salad his mother *had made*. As they *drove* in, he *saw* dozens of relatives already present. They *had spread* a **vibrant** array of blankets and food across the wide green lawn. Leo's eyes *found* Grandma Rose. She *had seen* him and *came* forward, her arms open wide. She *gave* him a warm hug. Leo *knew* this day *would bring* much joy.
Everyone *ate* and *drank* from the delicious array of dishes. Grandma Rose *began* to *reminisce*, telling funny stories from her youth, and everyone *heard* her hearty **laughter**. Leo *ran* and *played* with his cousins, inventing new games. They *threw* a frisbee and *caught* it many times. As the sun *began* to *set*, Leo *felt* a strong sense of belonging. This day *made* their family *feel* closer than ever. He *would keep* these memories for a long time.`,
            level: "B1",
            difficultWords: {"anticipation":"a feeling of looking forward to something, usually with pleasure.","vibrant":"full of energy and life; bright and striking.","reminisce":"to think or talk about past experiences with pleasure."}
          },
          c1: {
            title: "The Cherished Family Convocation",
            content: `Leo *felt* a **profound** sense of contentment mingling with the initial shyness. It *was* the annual family **convocation**, a tradition deeply *woven* into their lineage, *held* at the sprawling Oakwood Park. He *came* with his parents, bearing a large, meticulously prepared fruit salad his mother *had made*. As their vehicle *drove* onto the grounds, he *saw* countless relatives already *standing* across the expansive, verdant lawn. They *had spread* a truly **vibrant** **culinary** array of delectable dishes and an assortment of blankets. Leo's gaze *sought* Grandma Rose, who *had evidently been seeking* him, and she *came* forward, her arms extended in a welcoming gesture. She *gave* him a tender embrace. Leo *knew* this day *would bring* an abundance of joy.
Amidst the general merriment, everyone *partook* of the sumptuous array of dishes and *drank* refreshing beverages. Grandma Rose *began* to *tell* amusing anecdotes from her formative years, eliciting robust laughter that *rang* through the air. Leo, invigorated, *ran* and *swam* in the pond with his cousins, effortlessly inventing new games that *kept* them engaged. They *threw* a frisbee with precision and *caught* it with practiced ease. As the sun *began* its descent, *casting* long shadows, Leo *felt* a deep-seated sense of belonging that *had grown* throughout the day. This gathering *had forged* an even stronger familial *bond*, reinforcing connections that *would endure*. He *would keep* these moments indefinitely.`,
            level: "C1",
            difficultWords: {"profound":"very great or intense; having or showing great knowledge or insight.","convocation":"a large formal meeting of people; a ceremonial gathering.","culinary":"relating to cooking or the kitchen."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Whispers of the Night Forest </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "A2: Whispers of the Night Forest",
            content: `Mia *went* to the forest at night. She *had* a small light. The moon *was* big. She *saw* tall trees. She *heard* a bird *sing*. The forest *felt* very **quiet**. Suddenly, she *saw* a soft light. It *was* a group of small things that **glowed**. They *were* bright green. Mia *came* closer. She *took* a photo with her phone. She *thought* it *was* very beautiful. She *felt* happy. She *left* them there. She *went* home. She *knew* she *would* *dream* about this **special** night. It *was* an amazing walk.`,
            level: "A2",
            difficultWords: {"quiet":"making very little noise.","glowed":"produced a soft light.","special":"better or more important than usual."}
          },
          b1: {
            title: "B1: Whispers of the Night Forest",
            content: `Mia *chose* to *go* for a walk in the forest after dark. She *wore* warm clothes and *brought* a small light. As she *went* deeper, the day's sounds *gave* way to the night's quiet. She *heard* owls, and crickets *sang*. The moonlight *came* through the trees, *making* patterns on the ground. Suddenly, she *saw* a **faint** light ahead. She *felt* curious and *drew* closer. It *was* a patch of mushrooms that *shone* with a soft **radiance**. She *stood* there for a moment, *feeling* the magic. She *took* a photo, careful not to disturb them. She *left* them to continue their natural **illumination**. She *went* home, *knowing* she *would* *keep* this memory. She *felt* very peaceful and happy.`,
            level: "B1",
            difficultWords: {"faint":"not clear or strong; slight.","radiance":"light or heat as emitted or reflected by something.","illumination":"light; lighting."}
          },
          c1: {
            title: "C1: Whispers of the Night Forest",
            content: `Mia *chose* to *go* for a nocturnal **excursion** into the dense forest. She *put* on thermal attire and *brought* a powerful headlamp, though she *knew* she *would* seldom need its full beam. As she *went* deeper, the pervasive sounds of daytime *gave* way to the subtle harmonies of the night. She *heard* the distant hoot of an owl and the incessant chirping of crickets, whose collective rhythm *wove* through the air. Moonlight *came* through the intricate canopy, *casting* ethereal, shifting patterns upon the forest floor. Abruptly, she *saw* a **luminescent** shimmer emanating from a cluster of fungi. A profound sense of wonder *swept* over her as she *drew* closer. It *was* a vibrant tableau of bioluminescent mushrooms that *shone* with an almost otherworldly **effulgence**. She *stood* in quiet contemplation, *feeling* herself utterly immersed in the magical spectacle. She *took* a single photograph, ensuring her presence did not disrupt their delicate ecosystem, then *left* them undisturbed, a clandestine secret *held* within the forest's embrace. She *went* home, *knowing* she *had* *borne* witness to a truly extraordinary phenomenon that *would* forever *keep* itself etched in her memory. She *felt* an unparalleled sense of serenity and contentment.`,
            level: "C1",
            difficultWords: {"excursion":"a short journey or trip, especially one engaged in as a leisure activity.","luminescent":"emitting light not caused by heat.","effulgence":"the quality of being bright and radiant."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Birthday Cake Catastrophe </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Lily’s Birthday Cake",
            content: `It *was* Lily’s birthday. She *began* to make a big cake. She *chose* a good recipe. Lily *put* flour and eggs in a bowl. She *made* the mix. Then, she *put* it in the oven. It *smelled* very good! When it *was* ready, she *took* it out. The cake *was* **perfect**. Lily *carried* it to the table. Suddenly, she **slipped** on a wet spot. Oh no! The cake *fell* down. It *was* a **mess**. Lily *felt* very sad. Her mom *came* quickly. “Don’t worry,” mom *said*. “We *can* still have fun.” Mom *went* to the shop. She *bought* ice cream. They *made* a new "ice cream cake." Lily *ate* it and *was* happy. She *had* a great birthday.`,
            level: "A2",
            difficultWords: {"perfect":"without any faults; excellent.","slipped":"lost balance and nearly fell.","mess":"an untidy or dirty state of things."}
          },
          b1: {
            title: "Lily’s Birthday Cake Disaster",
            content: `It *was* Lily’s tenth birthday, and she *dreamed* of a spectacular cake. She *chose* a complex recipe and *began* baking early. She *found* all ingredients and *put* them together carefully. Soon, a delicious aroma filled the kitchen as the cake baked. When it *was* finally done, she *took* it out. The cake *looked* **magnificent**, perfectly golden. Lily carefully carried it across the kitchen to the counter. Suddenly, her foot *caught* on a loose rug. She *felt* herself *lose* balance. The cake *flew* from her hands and *hit* the floor with a sad thud. It *broke* into many pieces. Lily *stood* there, feeling very sad. Her mom *came* running. "Oh, dear!" she *said*. "What a **calamity**!" But mom *had* an idea. She quickly *drove* to the store and *bought* a large tub of ice cream and candies. Together, they *made* a fun, **improvised** "ice cream mountain." Lily *ate* it, *found* it surprisingly delicious, and declared it the best birthday ever. Her day *was* ultimately saved.`,
            level: "B1",
            difficultWords: {"magnificent":"extremely impressive or beautiful.","calamity":"an event causing great and often sudden damage or distress; a disaster.","improvised":"created and performed spontaneously or without preparation."}
          },
          c1: {
            title: "Lily’s Birthday Cake Catastrophe",
            content: `Lily *had* long *dreamed* of the perfect cake for her tenth birthday, a towering confection adorned with intricate frosting. She *chose* a particularly ambitious recipe and *began* the arduous baking process at dawn. She *brought* forth a panoply of ingredients, meticulously weighed and blended them. A beguiling aroma soon pervaded the entire house as the elaborate creation baked. When it *was* finally done, she *drew* it from the oven, a masterpiece of culinary art. The cake *shone*, a vision of perfection. Lily *bore* the delicate dessert with utmost care, navigating the bustling kitchen toward the celebratory table. Without warning, her foot *caught* on a rogue floorboard, and she *felt* herself *begin* to topple. Time seemed to *freeze*. The cake *flew* from her grasp, spinning in the air before it *smote* the tiled floor with a sickening thud, shattering into irreparable fragments. Lily *stood* **transfixed**, her joy utterly shredded. Her mother, hearing the **commotion**, *came* swiftly. "Oh, my dear child," she breathed, surveying the **decimated** confection. "What an unforeseen predicament!" Yet, her mother, ever resourceful, *had* a flash of inspiration. She *drove* immediately to an artisanal ice cream parlour, *bought* an assortment of gourmet flavours, and *brought* them home. Together, they fashioned an extravagant ice cream sundae tower. Lily *ate* it with gusto, *found* it unexpectedly delightful, and declared it a far more memorable birthday treat than any cake could *have* *been*.`,
            level: "C1",
            difficultWords: {"transfixed":"motionless with wonder or awe.","commotion":"a state of confused and noisy disturbance.","decimated":"drastically reduced in strength or effectiveness; originally, to kill one-tenth of."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Missing Suitcase Mystery </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Missing Suitcase Mystery",
            content: `Leo *was* excited. He *went* to the airport. He *took* a plane to a new city. When he *came* to get his bag, he *saw* many bags. But his spot *was* **empty**. He *did* not *find* his red suitcase. He *felt* **worried**. "Where *is* it?" he *thought*. He *spoke* to a man at the counter. The man *took* his name. He *said*, "We *will look* for it." Leo *went* home and *slept*. The next day, the airport *sent* him a message. His bag *was* found! He *went* back and *got* his suitcase. He *was* very happy. It *was* a huge **relief**. He *knew* he *would not forget* this trip.`,
            level: "A2",
            difficultWords: {"empty":"containing nothing; not full.","worried":"feeling anxious or unhappy about something.","relief":"a feeling of happiness because something difficult or unpleasant has stopped."}
          },
          b1: {
            title: "The Missing Suitcase Mystery",
            content: `Leo *was* absolutely thrilled for his trip. He *went* to the airport, checked in, and *flew* to a vibrant new city. Upon arrival, he *made* his way to the baggage claim. He *saw* a long line of suitcases *come* out, but as each one passed, his particular red bag *was* nowhere in sight. The carousel *kept* turning, and his anxiety *grew*. His designated spot *was* **vacant**. He *began* to *feel* increasingly concerned. He *knew* something *was* wrong. He *spoke* to an airport attendant, who *took* down his details and *said* they *would begin* a search. Leo *went* home, *feeling* quite down, and *slept* uneasily. The following morning, he *received* an email: his bag *had been* located! He *went* straight back to the airport and *got* his suitcase. A wave of **solace** *swept* over him. He *knew* he *would not forget* this experience; it *taught* him a valuable **lesson**.`,
            level: "B1",
            difficultWords: {"vacant":"not filled or occupied.","solace":"comfort or consolation in a time of distress or sadness.","lesson":"a piece of learning or an experience that serves as a guide for future behavior."}
          },
          c1: {
            title: "The Missing Suitcase Mystery",
            content: `Leo *felt* an intense anticipation for his journey. He *made* his way to the bustling airport, completed his check-in, and *undertook* a long-haul flight to a truly **cosmopolitan** city. Upon disembarking, he proceeded swiftly to the baggage reclaim area. He observed a continuous stream of luggage emerging onto the carousel, yet as each piece *went* by, his distinctive crimson suitcase remained conspicuously absent. The conveyor *kept* revolving, and his initial unease *began* to intensify. The space where his bag *ought to have been* *lay* entirely **unoccupied**. He *knew* a significant issue *had arisen*. He *sought* out an airport official, to whom he imparted his personal particulars. The official assured him they *would instigate* an immediate search. Leo *returned* home, *feeling* rather disheartened, and endured a restless night. The subsequent morning, he *received* an email notification: his cherished bag *had been* successfully located! He *drove* back to the airport with haste and *retrieved* his suitcase. A profound sense of **reassurance** *swept* over him. This entire ordeal, he *knew*, would remain etched in his memory; it *had taught* him an invaluable lesson in patience and perseverance.`,
            level: "C1",
            difficultWords: {"cosmopolitan":"familiar with and at ease in many different countries and cultures; having an international character.","unoccupied":"not being used or lived in; empty.","reassurance":"the action of giving fresh confidence and conviction to someone."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Weekend Chores Fun </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Weekend Chores Fun",
            content: `It *was* Saturday. The sun *came* up. Maya and Leo *woke* up. Their parents *said*, "Let's *do* weekend **chores**!" Maya *began* to clean her room. She *put* her toys away. She *made* her bed. Her room *became* very **tidy**. Leo *went* outside. He *saw* his dad. They *took* out the broom. They *swept* the path. The leaves *flew* away. They *knew* the garden *would be* clean. Their mom *brought* out juice and cookies. They *drank* and *ate* them together. Everyone *felt* happy. Their house *did* **sparkle**. They *knew* chores *could be* fun when they *did* them together. They *had* a good day.`,
            level: "A2",
            difficultWords: {"chores":"regular tasks you do around the house.","tidy":"neat and organized.","sparkle":"to shine brightly."}
          },
          b1: {
            title: "Weekend Chores Fun",
            content: `It *was* a bright Saturday morning. The sun *shone* brightly, *filling* the rooms with light. Maya and Leo *awoke* feeling refreshed. Their parents *came* in and *said*, "Time to *begin* our weekend **chores**!" Maya *chose* to clean her bedroom first. She *began* by organizing her desk, then *put* her books back. She *made* her bed, and her room quickly **gleamed** with tidiness. Meanwhile, Leo *went* into the garden. He *found* his dad, and together they *took* out the garden tools. They *swept* leaves, watching them *fly* in the gentle breeze. They *knew* the garden *would be* beautiful. Their mom *brought* a tray of fresh juice and homemade cookies. They *drank* and *ate* their snack, feeling a sense of accomplishment. The whole family *felt* **invigorated** by their joint effort. Their home truly *did* **collaborated**. They *understood* that even chores *could be* enjoyable when they *did* them together.`,
            level: "B1",
            difficultWords: {"collaborated":"worked together on a task or project.","gleamed":"shone brightly, especially with a clean or polished surface.","invigorated":"filled with energy and vitality."}
          },
          c1: {
            title: "Weekend Chores Fun",
            content: `The pre-dawn hush *gave* way to a glorious Saturday morn. The sun *had risen*, *casting* an ethereal **luminous** glow across the landscape, *penetrating* every nook. Maya and Leo *awoke* naturally, a sense of productive anticipation *beginning* to **pervade** the atmosphere. Their parents *came* into their rooms, subtly *signaling* the commencement of their communal weekend endeavors. "Let's *embark* on our household **chores**!" their mother *uttered* cheerfully.

Maya *chose* to undertake the *meticulously* tidying of her sanctuary. She *began* by categorizing her extensive book collection, *returning* each volume to its *designated* place. Her bed, once dishevelled, *became* a pristine display, and the entire chamber soon *bore* a pristine **gleam**. Concurrently, Leo *went* to the verdant expanse of the garden. He *found* his father already prepared, and together they *took* hold of their implements. They *swept* the fallen leaves, observing them *fly* away on the nascent breeze. Their collective efforts ensured the garden *would be* impeccable.

Their mother *brought* forth a delightful repast – freshly *squeezed* citrus elixir and artisan-baked treats. They *drank* deeply and *ate* with gusto, savoring the fruits of their labor. The entire family *felt* a profound sense of *invigoration* stemming from their joint accomplishment. The **synergy** of their collective undertaking *transformed* a mundane routine into a fulfilling experience. They *knew* that these shared moments, far from being obligations, *constituted* cherished family rituals, proving that chores *could be* thoroughly enjoyable when *undertaken* collectively.`,
            level: "C1",
            difficultWords: {"luminous":"emitting or reflecting light; shining.","pervade":"(especially of a smell, feeling, or quality) spread through and be perceived in every part of.","synergy":"the interaction or cooperation of two or more organizations, substances, or other agents to produce a combined effect greater than the sum of their separate effects."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Sweet Taste of Victory </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Sweet Taste of Victory - Level A2",
            content: `Leo *began* the game. He *felt* a little **nervous**. It *was* a new game, and he *did* not *know* much. He *made* some mistakes. But Leo *did* not *give* up. He *kept* playing. He *thought* hard about the game. Slowly, he *began* to *see* how to *win*. He *found* a good strategy. Then, Leo *won* the game! A big smile *came* to his face. He *felt* so happy and **proud**. His eyes *were* bright with joy. He *knew* he *could do* hard things. He *felt* a warm **glow** inside him.`,
            level: "A2",
            difficultWords: {"nervous":"feeling worried or afraid about something","proud":"feeling pleased and happy about something you have done or are connected with","glow":"a soft, warm light or feeling"}
          },
          b1: {
            title: "The Sweet Taste of Victory - Level B1",
            content: `Leo *began* the final round of the challenging game. He *felt* a surge of **determination**, though a hint of nervousness still *crept* in. He *knew* the rules well, and he *had done* his best in previous rounds. Despite his efforts, he *made* several critical errors, and his score *fell*. He *thought* about *giving* up, but he *chose* to *keep* playing. Leo *found* a new strategy, one he *hadn't seen* before. He *drew* on his focus and *went* for it, *knowing* this was his chance. In the end, Leo *won*! A huge grin *spread* across his face. He *felt* an incredible sense of accomplishment and **radiance**. His heart *beat* with joy, and a feeling of triumph *ran* through him. He *understood* that he *had overcome* a tough challenge, and this victory *showed* him what he *was capable of*. The moment *felt* truly amazing.`,
            level: "B1",
            difficultWords: {"determination":"the quality of being resolute or firm in purpose","radiance":"a glow or light; a feeling of happiness or health that shows in someone's face","overcame":"successfully dealt with or defeated a difficulty"}
          },
          c1: {
            title: "The Sweet Taste of Victory - Level C1",
            content: `Leo *undertook* the decisive phase of the intricate game, a subtle wave of **trepidation** *crept* through him, yet it *was* swiftly *overcome* by an unwavering sense of resolve. He *had spent* countless hours, *built* robust strategies, and *knew* the intricacies of every conceivable move. Despite his meticulous preparation, he *made* a series of unexpected missteps, and his position *sank* precariously. The insidious thought of conceding *fled* from his mind, but his innate **fortitude** *held* firm, compelling him to *keep* going. He *found* a new approach, *sought* a novel path, and *drew* upon his deepest reserves of mental acuity and prior experience. Unexpectedly, he *saw* an ingenious path to triumph, one he *had not seen* before. When the final score *came*, Leo *had won*! An overwhelming wave of **elation** *spread* over him, a profound sense of achievement *bound* his entire being. He *understood* that he *had not only overcome* the formidable game but *had also grown* immensely, truly *having come into* his own as a formidable competitor. This victory *bore* testament to his resilience, and he *felt* a profound sense of self-mastery.`,
            level: "C1",
            difficultWords: {"trepidation":"a feeling of fear or anxiety about something that may happen","fortitude":"courage in pain or adversity","elation":"great happiness and exhilaration"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Opinionated Oracle </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Talking Phone",
            content: `Leo *bought* a new phone. It *was* very **smart**. One day, it *began* to talk! “Good morning, Leo,” it *said*. Leo *did not know* what to *think*. The phone *gave* him advice. “*Wear* a hat today,” it *told* him. Leo *felt* strange. Sometimes, he *got* annoyed. He *thought* about selling it. But the phone also *made* his life easier. It *found* his keys. It *reminded* him to *eat*. Leo *saw* it *was* very **useful**. He *learned* to like its **voice**. He *kept* the talking phone.`,
            level: "A2",
            difficultWords: {"smart":"clever or intelligent","voice":"the sound made when speaking or singing","useful":"able to be used for a practical purpose; helpful"}
          },
          b1: {
            title: "The Talking Phone",
            content: `Leo *bought* a new, **sleek** smartphone. It *was* very advanced, *made* for the future. One morning, it *spoke* to him! "Leo, you *forgot* your umbrella," it *said*. Leo *was* greatly surprised. He *did not know* how to react. The phone *gave* him advice about everything, from his work schedule to what to *eat* for lunch. Leo often *found* its constant comments **annoying**. He *thought* seriously about returning it and *getting* a simpler model. However, the phone also *knew* his schedule perfectly, *told* him about traffic jams before he *left*, and *made* his daily tasks much simpler. He *saw* it *was* more than just a device; it *became* a **quirky** companion that *knew* him well. Leo *began* to *understand* its unique value, despite its sometimes overly talkative nature. He *kept* it, and they *grew* to *be* quite a pair.`,
            level: "B1",
            difficultWords: {"sleek":"smooth and shiny in appearance","annoying":"causing irritation or anger","quirky":"having a peculiar or unusual quality or habit"}
          },
          c1: {
            title: "The Talking Phone",
            content: `Leo *got* a cutting-edge smartphone, a device *said* to *be* the pinnacle of mobile innovation. It *was* meticulously *designed* and *shone* with futuristic appeal. To his astonishment, one crisp morning, it *began* to vocalize. "Leo," a smooth, synthetic voice *uttered*, "you *have forgotten* your umbrella; precipitation is imminent, and you *should wear* your waterproof coat." Leo *was* utterly dumbfounded; he *had never heard* of such a feature, nor *did* he *think* a phone *could speak* with such conviction. The device *gave* him unprompted advice constantly, *choosing* his sartorial selections and even *telling* him his lunch menu. Initially, Leo *found* its perpetual, *opinionated* chatter **exasperating**. He *knew* he *had* to *do* something to curb its startling assertiveness and *thought* seriously of decommissioning the device altogether. Yet, the phone *showed* itself remarkably adept at anticipating his requirements. It *led* him on optimal routes, *managed* his complex calendar with precision, and *made* his intricate professional life **seamless**. Leo *came* to *understand* that this verbose contraption, despite its pronounced **eccentricities** and unsolicited counsel, *was* an indispensable, if peculiar, confidante. He ultimately *chose* to *embrace* its unique sentience, realizing he *had bought* more than just a phone; he *had found* an unlikely partner.`,
            level: "C1",
            difficultWords: {"exasperating":"intensely irritating; infuriating","seamless":"smooth and continuous, without apparent breaks or transitions","eccentricities":"qualities of being unconventional and slightly strange"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Lost City of Aethelgard </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Elias and the Lost City",
            content: `Old Elias *was* an explorer. One day, he *found* an old map. It *showed* a lost city, Aethelgard. He *felt* very excited. Elias *went* to the high mountains. He *saw* a strange fog. He walked through it. He *came* to a beautiful city. Houses *were* made of **glass**. People *were* happy. Elias *took* a small, **shining** stone. As he *went* away, the city *began* to disappear. He *ran* back, but it *was* gone. Elias *knew* he *had seen* something special. He *never told* anyone about the **mystery**.`,
            level: "A2",
            difficultWords: {"glass":"A hard, transparent material that breaks easily, used for making windows and bottles.","shining":"Giving out or reflecting light; glowing.","mystery":"Something that is difficult or impossible to understand or explain."}
          },
          b1: {
            title: "The Legend of Aethelgard",
            content: `An old explorer named Elias *came* across an ancient map. It *bore* the markings of a legendary lost city, Aethelgard. He *felt* a strong pull of curiosity. Elias *set* out on a journey into the rugged mountains. After days, he *saw* a peculiar mist *begin* to form. He *chose* to walk through it, and suddenly, he *stood* before a magnificent city. Its structures *were* crafted from a **lustrous** material, and its inhabitants seemed to live in perfect harmony. Elias *felt* drawn to a small altar where a **radiant** stone *lay*. He *took* it. As he turned to leave, the city *began* to fade. He *ran* back, but it had vanished. Elias *knew* he *had seen* something extraordinary. He *kept* the stone but *never spoke* of his **discovery**.`,
            level: "B1",
            difficultWords: {"lustrous":"Having a soft sheen or a bright surface; shiny.","radiant":"Sending out light or heat; shining brightly.","discovery":"The act of finding or learning something for the first time."}
          },
          c1: {
            title: "Aethelgard: The Fading Enigma",
            content: `Elias Vance, a seasoned explorer, *chose* to *seek* an ancient, **weathered** parchment. It *bore* cryptic symbols depicting Aethelgard, a city *thought* *lost* to human ken. A profound sense of intrigue gripped him. Driven by an insatiable wanderlust, Elias *set* out on an arduous expedition into the formidable mountain ranges. After weeks of relentless trekking, he *saw* an ethereal mist *begin* to coalesce. He *went* forth to penetrate its veil, and abruptly, he *found* himself *standing* before an **awe-inspiring** metropolis. Its edifices *were* meticulously crafted from an iridescent, crystalline substance, and its denizens *appeared* to exist in idyllic tranquility. Elias *felt* compelled towards a central plinth where a pulsating, **luminous** gem *lay*. He *took* possession of it. As he *made* his egress, the entire city *began* to dissipate. He *ran* frantically back, but it *had gone*. Elias *understood* he *had been shown* a fleeting glimpse of the transcendental. He *clung* to the gem but *kept* forever taciturn regarding his experience.`,
            level: "C1",
            difficultWords: {"weathered":"Worn, damaged, or changed in color or texture by exposure to the air and sun.","awe-inspiring":"Causing a feeling of great respect and wonder.","luminous":"Emitting or reflecting light; shining or glowing in the dark."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Leo's Big Splash </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Leo's Big Splash",
            content: `Leo *went* to the swimming **pool**. He *felt* a little scared. His teacher, Maya, *was* there. She *told* him, "Let's *begin*!" Leo *got* into the water. It *was* cold. He *put* his face in the water and *blew* bubbles. He *held* his breath. Maya *taught* him to *kick* his legs. Leo *did* small kicks. He *came* up for air. He *kept* trying to be **brave**. Slowly, Leo *began* to **float**. He *swam* a little bit. He *felt* very happy. He *knew* he *was* able to *learn* more. He *became* a swimmer!`,
            level: "A2",
            difficultWords: {"pool":"a basin of water for swimming.","brave":"ready to face and endure danger or pain; showing courage.","float":"rest or move on or near the surface of a liquid without sinking."}
          },
          b1: {
            title: "Leo's Big Splash",
            content: `Leo *went* to the public **pool**, feeling a clear sense of **hesitation**. His swim teacher, Maya, *was* already there, her encouraging smile *made* him *feel* a bit better. "Today we *begin* properly!" she *said*. Leo *got* into the cool water; it *felt* colder than he *thought* it *would*. He *put* his face under the surface and *blew* out long streams of bubbles, *holding* his breath for longer periods. Maya *showed* him the correct leg **technique**, how to *kick* from his hips. He *did* as she *told* him, moving his arms in smooth strokes. He *came* up for air, *feeling* less afraid. He *kept* practicing, and soon he *felt* a sense of real **progress**. Slowly but surely, Leo *swam* across a small section of the pool. He *knew* he *had* truly *taken* the first big step. He *became* incredibly proud of himself.`,
            level: "B1",
            difficultWords: {"hesitation":"a pause or delay before saying or doing something.","technique":"a skillful or efficient way of doing something.","progress":"forward or onward movement toward a destination."}
          },
          c1: {
            title: "Leo's Big Splash",
            content: `A palpable sense of **apprehension** *clung* to Leo as he *went* to the municipal **pool**. His esteemed swim instructor, Maya, *was* already there, her calm demeanor subtly easing his nerves. "It's time we truly *began* to *overcome* this challenge," she *said* softly. Leo cautiously *got* into the cool, crystal-clear water; it *felt* bracing, but not unwelcome. He *put* his face beneath the surface, *blew* a steady stream of bubbles, and *held* his breath, *feeling* the pressure against his eardrums. Maya meticulously *showed* him the intricate arm strokes and the precise leg kick, *teaching* him to *make* his movements fluid. He *did* exactly as she *bade* him, synchronizing his breath with his strokes. Each time he *came* up for air, a sliver of confidence *began* to *grow*. He *kept* persevering, and gradually, a burgeoning sense of **mastery** *took* hold. He *swam* a full length of the lane, his movements confident and strong. He *knew* he *had* not only *learned* to swim but *had* also *beaten* a deep-seated fear. The feeling of **elation** *washed* over him, a testament to his newly *found* ability.`,
            level: "C1",
            difficultWords: {"apprehension":"anxiety or fear that something bad will happen.","mastery":"comprehensive knowledge or skill in a subject or activity.","elation":"great happiness and exhilaration."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Dream Weaver's Flight </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Leo's Flying Dream",
            content: `Leo *had* a big dream: to *fly*. He *began* his project and *built* a special machine. He *found* old metal and wood in his **garage**. He *took* these things and *made* large **wings**. He *put* all the parts together carefully. It *was* hard work, but he *did* it. One morning, he *came* to a green **field**. He *got* inside his machine. He *said* a quiet wish. The machine *rose* slowly from the ground. Leo *flew* over the trees! He *saw* his small town below. He *felt* very happy. His dream *came* true. He *knew* he *had* *done* something amazing.`,
            level: "A2",
            difficultWords: {"garage":"a building or part of a building where a car is kept.","wings":"flat parts that stick out from the body of a bird or an aircraft and are used for flying.","field":"an area of land, usually covered with grass, used for sports or growing crops."}
          },
          b1: {
            title: "The Inventor's Ascent",
            content: `Leo, a young **inventor**, *dreamt* of soaring through the skies. He *began* a secret project and *built* a flying machine. For weeks, he *sought* discarded items, and *found* various components in abandoned workshops. He *took* old bicycle frames, strong fabric, and small engines. With skill, he *made* a unique **contraption**, carefully attaching its wide wings. He *put* his heart into every detail. Finally, the day *came* for its maiden flight. He *brought* his creation to a vast, open **expanse**. Leo *got* inside, his heart *beat* fast. He *gave* it power, and the machine *rose*, slowly at first, then faster. He *flew* higher and higher, *seeing* the world from above. He *felt* an incredible sense of freedom as he *went* over his town. His lifelong aspiration *had* *become* a reality.`,
            level: "B1",
            difficultWords: {"inventor":"a person who has invented something or whose job is to invent things.","contraption":"a machine or device that appears strange or complicated and is often not very well made.","expanse":"a large, open area of land, water, or sky."}
          },
          c1: {
            title: "The Maverick's Inaugural Flight",
            content: `Leo, a visionary **aeronaut**, *dreamt* of transcending earthly bounds. He *had* *begun* his clandestine endeavor years prior, firmly resolved to *build* a personal aerial **craft**. He *undertook* an arduous quest, diligently *seeking* forgotten schematics and procuring rare components from dilapidated workshops and sprawling junkyards. He *drew* intricate blueprints, *chose* resilient alloys, and *fashioned* bespoke propulsion systems. He *brought* together disparate elements – a repurposed engine, lightweight composite materials, and a meticulously *woven* canvas – *making* an unparalleled machine. He *put* thousands of hours into its painstaking assembly. The dawn of the inaugural flight *broke*, *casting* long shadows. He *led* his marvel to a secluded, expansive **esplanade**. His heart *beat* a furious rhythm as he *slid* into the cockpit. With a decisive push, he *gave* it full throttle. The engine *sprang* to life, its resonant roar *filled* the crisp air. The propellers *spun*, and the machine *rose*, defying the very notion of gravity. He *ascended*, *flew* with graceful precision, *beholding* the landscape *shrink* to a miniature below. He *felt* an overwhelming surge of exhilaration as he *swept* across the vast expanse. His audacious vision *had* truly *come* to fruition, a testament to what ingenuity *could* *achieve*. He *knew* he *had* *made* history.`,
            level: "C1",
            difficultWords: {"aeronaut":"a person who travels in an airship or balloon.","craft":"a vehicle (such as a boat, ship, or aircraft) that is designed for travel on or in water or air.","esplanade":"a long, open, level area, typically by the sea, or a large, flat, open area."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 A Helping Hand </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "A Helping Hand",
            content: `Leo *saw* his friend Mia. She *sat* alone. She *looked* sad. Leo *knew* she *was* not happy. He *went* to her.
"What's wrong?" he *asked*.
Mia *told* him. Her rabbit, Thumper, *was* sick. She *felt* **worried**. She *did not know* what to *do*. The vet *said* Thumper *needed* a special **plant**, but Mia *did not have* it.
Leo *had* an idea. He *knew* a **farm**. "I *will go* and *find* it!" he *said*.
He *drove* to the farm. He *came back* with the plant.
Mia *took* the plant. She *gave* it to Thumper. Thumper *began* to *feel* better.
Mia *was* happy. She *knew* Leo *was* a good friend. Leo *felt* good. He *did* a good thing.`,
            level: "A2",
            difficultWords: {"worried":"feeling anxious or unhappy about something.","plant":"a living thing that grows in the ground, usually with leaves and a stem.","farm":"a place where people grow food or keep animals."}
          },
          b1: {
            title: "A Helping Hand",
            content: `Leo *saw* his friend Mia *sitting* alone. She *wore* a sad face. He *knew* something *was* wrong.
He *went* to her and *sat* beside her. "You *have been* quiet, Mia. What *is* it?" he *asked*.
Mia *began* to *tell* him. Her beloved pet rabbit, Thumper, *had fallen* ill. She *felt* very **anxious**. The vet *told* her Thumper *needed* a rare herb, but she *did not know* where to *find* it. She *had spent* hours looking.
Leo *thought* for a moment. He *knew* a small, **secluded** farm where his grandmother *grew* various unusual plants. "I *know* she *has* it. I *will bring* it to you." he *said*.
He *took* his car and *drove* for nearly an hour. He *found* the herb, *paid* for it, and *came back*.
Mia *gave* the herb to Thumper, who *ate* it. Slowly, Thumper *began* to *show* signs of **recovery**. Mia's face *lit up*. She *felt* immense relief. Leo *knew* he *had made* a difference.`,
            level: "B1",
            difficultWords: {"anxious":"feeling worried or nervous.","secluded":"private, quiet, and not easily accessed.","recovery":"the process of getting better after an illness or injury."}
          },
          c1: {
            title: "A Helping Hand",
            content: `Leo *saw* a palpable sadness emanating from his friend Mia, who *sat* uncharacteristically isolated. Her downcast **demeanor** *showed* a deep unease. He immediately *knew* something significant *was* amiss.
He *went* towards her, *chose* a spot adjacent, and *took* a seat beside her. "Mia, you appear quite distressed," he *began*, his voice soft. "Please, *tell* me what has weighed upon you."
Mia, her voice barely a whisper, *told* her predicament. Her cherished pet, Thumper, a small rabbit she *had bred* since it *was* a kit, *had fallen* gravely ill. She *felt* utterly bereft. The veterinarian *had spoken* of a highly specific, exceedingly rare herb, but despite her exhaustive efforts, she *could not find* its whereabouts. She *had driven* for hours, *made* numerous calls, and *felt* increasingly helpless.
Leo, a thoughtful expression *crept* onto his face, *brought* to mind a remote **sanctuary**—a family farm *kept* by his eccentric aunt—where peculiar botanicals *were grown*. "I *think* my aunt *grows* that exact herb," he stated. "I *will drive* there without delay and *bring* it back. We *will overcome* this."
True to his word, Leo *undertook* the considerable journey, *found* the precise plant, and *paid* a fair sum. He *came back* with the precious remedy.
Mia *gave* the herb to Thumper. Gradually, the rabbit *began* to *show* promising signs of **revitalization**, its breathing growing steady. Witnessing Thumper *wake* and *take* a tentative hop, a radiant smile *lit up*. Mia's face. An overwhelming sense of relief *swept over* her. Leo *understood* that his steadfast support *had made* a profound difference in his friend's life.`,
            level: "C1",
            difficultWords: {"demeanor":"someone's general way of behaving or looking.","sanctuary":"a place of refuge or safety.","revitalization":"the process of giving new life or energy to something."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Secret of Whispering Cave </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Secret of Whispering Cave",
            content: `Leo and Mia *went* to the Whispering Cave. They *found* a small opening and *began* to *go* inside. It *was* very dark. They *had* a light. Deep inside, they *saw* a soft **glowing** light. They *came* to a big **chamber**. Many beautiful crystals *stood* there. They *made* a quiet sound. Leo and Mia *felt* amazed. They *took* pictures. They *left* the cave, *knowing* they *saw* something very **unique**. They *told* their friends about it.`,
            level: "A2",
            difficultWords: {"glowing":"emitting light; shining softly","chamber":"a large room, often in a cave or building","unique":"being the only one of its kind; very special"}
          },
          b1: {
            title: "The Secret of Whispering Cave",
            content: `Leo and Mia *chose* to *go* on an adventure to the Whispering Cave. They *found* a narrow entrance and *began* to **venture** into the darkness. Their flashlight *cast* long shadows. As they *walked* deeper, they *heard* an *eerie* sound and *saw* a faint, **luminescent** light ahead. They *knew* they *had* to explore it. They *came* into a vast cavern. Countless crystals *grew* from the walls and *shone* with an inner light, *making* the whole place *feel* magical. It *was* a true **marvel**. They *took* many photos. When they *left*, they *felt* changed, *having* *seen* something extraordinary. They *spoke* of it often.`,
            level: "B1",
            difficultWords: {"venture":"to go to a dangerous or unknown place","eerie":"strange and frightening","luminescent":"producing light without heat"}
          },
          c1: {
            title: "The Secret of Whispering Cave",
            content: `Leo and Mia *undertook* an expedition to the enigmatic Whispering Cave. They *found* a concealed fissure, through which they *crept* into the profound darkness. Their headlamps barely *pierced* the **abyss**. As they *delved* deeper, an otherworldly **luminescence** *became* visible, *emanating* from the cave's very core. They *knew* they *had* stumbled upon something extraordinary. The passage *led* them into a colossal grotto, where crystalline formations *rose* majestically from the earth, *casting* an **iridescent** glow. The sight *was* so breathtaking it *overcame* them with silent awe. They *took* a series of photographs, *knowing* that what they *had* *witnessed* *forbade* casual description. Upon their return, the profound experience *remained* etched in their memories, *giving* them a new perspective on the natural world.`,
            level: "C1",
            difficultWords: {"abyss":"a deep or seemingly bottomless chasm","luminescence":"the emission of light by a substance not resulting from heat","iridescent":"showing luminous colors that seem to change when seen from different angles"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Colorful Street Treat </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "A New Taste in the Market",
            content: `Leo *went* to the busy street **market**. He *saw* a food stall. It *had* colorful dumplings *steaming*. They *looked* new. Leo *felt* a little shy to *try* them, but he *was* curious. He *bought* one small, pink dumpling. He *took* a bite. The taste *was* sweet and surprising. It *was* very **delicious**! He quickly *ate* the whole thing. Leo *knew* he *would come* back soon. He *was* happy he *did* something new. He *thought* it *was* a great day.`,
            level: "A2",
            difficultWords: {"market":"A place where people buy and sell things.","steaming":"Producing hot vapor or steam.","delicious":"Very pleasant to taste."}
          },
          b1: {
            title: "Discovering a Vibrant Street Snack",
            content: `Leo *went* to the lively street **market**, where the afternoon sun *began* to *shine*. He *saw* a unique food stall that *stood* out. It *had* **vibrant**, colorful dumplings, gently steaming in bamboo baskets. A sweet **aroma** *came* from them. Leo *felt* a mix of curiosity and a little **reluctance**. He *had never seen* anything like them. He *thought* for a moment, then *chose* a bright pink one. He *paid* the vendor and *took* the warm dumpling. He *brought* it closer, its unusual color a mystery. He *took* a cautious bite. To his surprise, it *was* incredibly *delicious*! The sweet filling *made* him smile. He quickly *ate* the rest. Leo *knew* he *had found* a new favorite. He *would come* back to this wonderful place soon.`,
            level: "B1",
            difficultWords: {"vibrant":"Bright and striking.","aroma":"A pleasant, distinctive smell.","reluctance":"Unwillingness or hesitation."}
          },
          c1: {
            title: "A Culinary Revelation at the Market",
            content: `The urban air *was* thick with myriad sounds as Leo *found* himself immersed in the **bustling** street market, a vibrant tapestry where cultures and flavors *interwove*. He *had been drawn* by the pervasive energy, yet a particular stall truly *caught* his eye. There, an array of **exquisite**, brightly *hued* dumplings *shone* under the soft glow of lanterns, their delicate skins almost translucent, gently steaming. An intoxicating **aroma** of something both familiar and exotic *rose* from the bamboo baskets. Leo *felt* a blend of intrigued anticipation and a subtle hesitation. He *had never seen* such visually striking street fare. After a moment of profound contemplation, he *chose* a dumpling whose skin *bore* a captivating swirl of rose and jade. He *paid* the vendor, the warmth of the dumpling *seeping* into his palm as he *took* it. He *brought* it closer; its unique form almost *made* his senses *awake*. With a careful yet eager bite, he *was swept* away. The **culinary** experience *overcame* his preconceived notions; a burst of unexpected, yet harmonious, sweetness *sprang* forth, saturating his palate. He quickly *ate* the entire delicacy, each chew *leaving* a lasting impression. Leo *knew* he *had found* a hidden gem, a delightful surprise that *would lead* him to *return* to this vibrant corner of the city again and again.`,
            level: "C1",
            difficultWords: {"bustling":"Full of energetic and noisy activity.","exquisite":"Extremely beautiful and delicate.","culinary":"Relating to cooking or the kitchen."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Great Road Trip </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Great Road Trip",
            content: `Three friends, Maya, Leo, and Chloe, *chose* to *go* on a trip. They *put* bags in the car. Maya *drove* the car. The sun *rose*. They *saw* green trees and blue sky. They *ate* snacks and *sang* songs. It *was* a fun **adventure**.
Suddenly, the car *made* a strange noise. It *was* a flat tire! They *felt* sad. Leo *knew* what to *do*. He *went* to *find* help. Soon, a nice man *came*. He *brought* tools. He *did* the work on the tire. The friends *were* happy. They *drank* water and *kept* driving. The stars *began* to **sparkle** in the night sky. They *came* to a small town. They *slept* well. They *thought* it *was* a great trip. They *had* a good time and *made* many happy memories. They *knew* they would *do* it again. They *said* goodbye with a big **cheer**.`,
            level: "A2",
            difficultWords: {"adventure":"an exciting or unusual experience.","sparkle":"to shine brightly with small flashes of light.","cheer":"a shout of joy or encouragement."}
          },
          b1: {
            title: "The Great Road Trip",
            content: `Three friends, Maya, Leo, and Chloe, *began* their road trip. They *chose* a scenic route. They *put* their luggage in the boot and Maya *drove*. As they *went*, the morning sun *shone* brightly. They *saw* diverse landscapes, from rolling hills to vast plains stretching to the **horizon**. They *ate* lunch by a lake and *sang* their favorite songs, *feeling* a sense of **adventure**.
Suddenly, a disturbing sound *came* from the car. They *knew* immediately something *was* wrong. A tire had *gone* flat. They *felt* a wave of worry. Leo *took* charge, *knowing* they needed to *find* help. He *went* to the nearest village. A local mechanic *came* swiftly and *brought* his tools. He quickly *made* the tire well again, and their spirits *rose*. They *drank* water and *kept* driving, their **resolve** to enjoy the trip unbroken. As darkness *fell*, stars *began* to *shine* in the sky. They *came* upon a cozy inn where they *slept* soundly. They *thought* about all the fun they *had* and the new friendships they *made*. It *was* an unforgettable journey, and they *knew* they would *do* another one soon. The experience *taught* them resilience. This *was* an **unforeseen** challenge, but they *overcame* it.`,
            level: "B1",
            difficultWords: {"horizon":"the line at which the earth's surface and the sky appear to meet.","resolve":"firm determination to do something.","unforeseen":"not anticipated or predicted."}
          },
          c1: {
            title: "The Great Road Trip",
            content: `The **expedition** of a lifetime *began* for three intrepid friends: Maya, Leo, and Chloe. They *had chosen* a lesser-known, truly scenic route, meticulously packing their vehicle before Maya *took* the wheel. As they *drove* onward, the sun *rose*, *casting* a warm, golden **panoramic** over the vistas that *met* their gaze. They *ate* a delightful picnic by a pristine river and *sang* an impromptu chorus of their cherished melodies, a profound sense of camaraderie and liberation *sweeping* over them.
Their blissful journey *was* momentarily *broken* when a disconcerting sound *sprang* from beneath the car. They instantly *knew* it *was* a catastrophic flat tire. A wave of dismay *swept* through them, but Leo, ever the pragmatist, *took* command. He *set* off to *seek* assistance in the nearest, rather isolated, hamlet. A local mechanic, a genial fellow, *came* and *brought* specialized equipment. He efficiently *put* things right, his skillful hands quickly *overcoming* the obstacle, which *sent* their spirits soaring. They *drank* refreshing beverages and *kept* forging ahead, their unwavering determination *unbroken*. As dusk *fell*, countless stars *began* to *shine* in the inky firmament. They ultimately *came* across a quaint, welcoming lodge where they *slept* profoundly. *Thinking* upon their adventures, they *knew* the indelible memories they *had made*. It *was* a truly **fortuitous** journey that *taught* them invaluable lessons in resilience and teamwork. They *knew* they would *undertake* similar ventures in the future.`,
            level: "C1",
            difficultWords: {"expedition":"a journey undertaken by a group of people with a particular purpose, especially that of exploration, scientific research, or war.","panoramic":"(of a view or picture) with a wide, unbroken view of an area.","fortuitous":"happening by chance rather than intention; often with a positive outcome."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Liam's Rushed Morning </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Liam's Rushed Morning (A2)",
            content: `Liam *woke* up late. His **alarm** *did not ring*. He *got* out of bed fast and *went* to the bathroom. He *brushed* his teeth and *washed* his face. Then he *came* to the kitchen. He *ate* a quick breakfast and *drank* some **juice**. He *put* on his shoes quickly. He *took* his bag and *left* the house. The sun *began* to shine brightly. He *ran* to the bus stop, hoping to catch his bus. Suddenly, he *knew* he *forgot* his keys on the table. He *felt* very **stressed**. It *was* a very busy morning for Liam.`,
            level: "A2",
            difficultWords: {"alarm":"a device that makes a loud sound to wake you up or warn you of danger","juice":"a drink made from fruit or vegetables","stressed":"feeling worried and nervous"}
          },
          b1: {
            title: "Liam's Rushed Morning (B1)",
            content: `Liam *woke* up abruptly. His **reliable** alarm *had not rung*. He *knew* he *was* late. He *got* out of bed quickly and *went* to the bathroom, where he *did* his morning routine. He *came* to the kitchen and *made* himself a quick breakfast, eating it as he *stood*. He *drank* his coffee fast. He *put* on his shoes and *took* his bag, which *had* all his work things. He *left* the apartment, feeling a sense of urgency. The sun *began* to *rise*, casting a gentle **glow**. He *ran* towards the bus stop, thinking about his first meeting. Suddenly, he *felt* a jolt – he *had forgotten* his phone. He *had* to *run* back. This *was* going to *be* a truly **hectic** morning.`,
            level: "B1",
            difficultWords: {"reliable":"can be trusted to do something well; dependable","glow":"a soft, steady light","hectic":"full of activity; very busy and confused"}
          },
          c1: {
            title: "Liam's Rushed Morning (C1)",
            content: `Liam *awoke* with a start, the absence of his usual alarm **jarring** him. A quick glance at the clock *told* him he *had overslept* significantly. He *sprang* from his bed, *fleeing* to the bathroom to *do* his perfunctory morning rituals. Descending to the kitchen, he *made* a **hasty** breakfast, barely *eating* as he *stood*. He *drank* his coffee almost reflexively, the caffeine barely *making* an impact. He *put* on his shoes and *took* his briefcase, *knowing* he *had* to *leave* immediately. As he *went* out of his abode, the nascent sun *began* to *shine*, bathing the street in a soft, ethereal light. He *ran*, nearly sprinting, towards the bus stop, his mind already *caught* in the **maelstrom** of his impending workload. He *felt* a sudden, profound realization – he *had forgotten* his indispensable smartphone. He *had* no choice but to *run* back, *knowing* this morning *was set* to *become* utterly chaotic.`,
            level: "C1",
            difficultWords: {"jarring":"causing a shock or unpleasant feeling","hasty":"done or made in a hurry, especially with careless speed","maelstrom":"a situation in which there is a lot of confusion, strong feelings, violence, or activity"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Mia's Test Day Nerves </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Mia's Big Test Day",
            content: `Mia *woke* up early. She *felt* some **worry**. Today *was* a big test. Her stomach *did not feel* good. She *was not* hungry. She *went* to school **quietly**. Her hands *began* to shake a little. She *saw* her friend Tom. He *came* over. Tom *said*, "You *can do* it! Just **focus**!" Mia *took* a deep breath. She *understood* she *had* to try. She *went* into the room, *sat* down, and *began* to *write*. She *felt* better. She *knew* she *did* her best.`,
            level: "A2",
            difficultWords: {"worry":"a feeling of anxiety or concern","quietly":"making little or no noise","focus":"to give all your attention to something"}
          },
          b1: {
            title: "Mia's Test Challenge",
            content: `Mia *woke* up early, a knot of **anxious** energy in her stomach. Today *was* the big exam. She *felt* very nervous. She *had* a small breakfast but *did not feel* hungry. Her hands *began* to shake as she *went* to school. She *saw* her friend, Tom, who *came* over. He *knew* how she *felt*. He *said*, "You *can do* this, Mia! Don't *forget* what you *learned*." He *stood* beside her to **reassure** her. Mia *took* a moment to breathe deeply. She *understood* she *had* to face it. She *went* into the test room, *sat* down, and *began* to *write*. Gradually, she *felt* more **composed**, knowing she *gave* her best effort.`,
            level: "B1",
            difficultWords: {"anxious":"feeling or showing worry, nervousness, or unease about something with an uncertain outcome","reassure":"to say or do something to remove the doubts or fears of someone","composed":"having one's feelings and expression under control; calm"}
          },
          c1: {
            title: "Conquering the Exam Apprehension",
            content: `Mia *awoke* with a profound sense of **trepidation**. The impending examination *loomed*, casting a shadow over her morning. Her stomach *felt* a tumultuous mix of nerves, making the thought of breakfast unappetizing; yet, she *ate* a few bites, *knowing* she *had* to sustain herself. As she *drove* to school, her palms *grew* clammy, and a tremor *began* in her hands. She *saw* her steadfast friend, Tom, waiting. He *came* to her, his presence a source of comfort. "Remember all you *have learned*," he *said*, his voice firm but gentle. He *stood* by her, a silent bastion of **fortitude**, helping her *find* her inner strength. Mia *took* a deep, steadying breath, *understanding* that this challenge *had* to be confronted. She *went* into the examination hall, *chose* her seat, and *sat* down. As her pen *began* to *write*, a wave of **serenity** *swept* over her. She *knew* she *had done* her utmost, and that *was* enough.`,
            level: "C1",
            difficultWords: {"trepidation":"a feeling of fear or anxiety about something that may happen","fortitude":"courage in pain or adversity","serenity":"the state of being calm, peaceful, and untroubled"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Robo-Helper: The Smart Study Friend </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Robo-Helper: The Smart Study Friend",
            content: `Leo *had* a big problem with homework. It *was* very hard, and he often *did not know* the answers. He *felt* sad and frustrated. Then, his parents *brought* him a new robot. Its name *was* Spark. Spark *was* small and *had* a special light that would **blink** when it thought. Spark *began* to help Leo right away. It *made* tricky math problems easy. It *gave* good ideas for writing. Leo *saw* his grades *go* up. His teacher *said*, "You *did* very well!" Leo *became* very happy. He *knew* much more. Spark *was* a true **assistant** and Leo *felt* very **proud** of his progress.`,
            level: "A2",
            difficultWords: {"blink":"to close and open your eyes quickly, or for a light to shine on and off.","assistant":"someone who helps another person.","proud":"feeling pleased and satisfied about something you own, made, or did."}
          },
          b1: {
            title: "Robo-Helper: The Smart Study Friend",
            content: `Leo often *found* homework challenging. He *did not know* how to approach many problems and *felt* quite frustrated. His grades *were* not great, and he *thought* he *could not learn*. One afternoon, his parents *brought* home a compact robot. They *called* him Spark. Spark *was* small, *built* with sleek metal, and *had* an internal light that would **illuminate** softly. Spark immediately *began* to *show* Leo how to approach his tasks more **efficiently**. It *made* complex equations simple and *gave* him creative prompts for essays. Leo *saw* a clear improvement in his performance. His teachers *spoke* highly of his progress, saying he *had done* remarkably well. Leo *became* confident and *could* finally **comprehend** difficult subjects. Spark truly *was* an amazing helper, *teaching* Leo with great success and helping him *feel* a new sense of achievement.`,
            level: "B1",
            difficultWords: {"illuminate":"to light up or make something brighter.","efficiently":"in a way that achieves maximum productivity with minimum wasted effort or expense.","comprehend":"to understand something fully."}
          },
          c1: {
            title: "Robo-Helper: The Smart Study Friend",
            content: `Leo perpetually *found* his academic pursuits daunting. He frequently *bore* the burden of unresolved assignments, *knew* not how to *grapple* with intricate problems, and consequently *felt* a profound sense of despair. His scholastic record *had been* dismal, and he *had come* to *believe* his intellectual capacity *was* inherently limited. Then, one pivotal afternoon, his discerning parents *brought* home an innovative, sleek robot. They *chose* to *call* him Spark. Spark, though compact, *was* *wrought* with advanced components and *possessed* an internal luminescent core that would **irradiate** subtly. Spark promptly *began* to *show* Leo how to *overcome* his learning impediments, guiding him to formulate effective study strategies. It *made* intricate mathematical theorems *seem* lucid and *gave* him profound insights that *fed* his creativity for written assignments. Leo *witnessed* a significant escalation in his academic standing. His educators *spoke* glowingly of his exceptional turnaround, remarking on how he *had achieved* such profound understanding. Leo *became* genuinely self-assured, *having grasped* concepts he *had previously deemed* inscrutable. Spark unequivocally *proved* to be an indispensable **catalyst**, *breeding* a renewed passion for learning within Leo and *binding* his knowledge base with an **unwavering** foundation.`,
            level: "C1",
            difficultWords: {"irradiate":"to emit rays of light or heat; to shine upon.","catalyst":"a person or thing that precipitates an event or change.","unwavering":"steady or resolute; not wavering."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 A Spark of Time </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "A Spark of Time (A2)",
            content: `Leo *found* an old **device** in his **attic**. It *was* dusty. He *took* it in his hand. Suddenly, it *began* to **hum** a soft sound. A bright light *came*. Leo *felt* strange. In a moment, he *was* in a new place. He *saw* a man with a kind face. "I *am* Nikola Tesla," the man *said*. Tesla *showed* Leo a big machine. Leo *understood* that he *met* a great inventor. Tesla *gave* Leo a small book. Leo *went* back to his room. He *knew* this day *would* *be* special. He *had* a story to *tell*.`,
            level: "A2",
            difficultWords: {"device":"a machine or tool made for a special purpose","attic":"a space or room at the top of a house, under the roof","hum":"to make a low, continuous sound"}
          },
          b1: {
            title: "A Spark of Time (B1)",
            content: `One sunny afternoon, Leo *found* a **peculiar** old **device** hidden in his dusty **attic**. He *picked* it up, *feeling* its cool metal. As he *held* it, the device *began* to *glow* and *hum* softly, a strange sound *filled* the air. In a flash, Leo *was* no longer in his room; he *stood* in a dimly lit **laboratory** *filled* with wires and machines. A tall, elegant man with a thoughtful expression *came* forward. "I *am* Nikola Tesla," he *said* with a smile. Tesla *showed* Leo many *innovative* inventions. Leo *knew* he *met* a true genius. Before Leo *left*, Tesla *gave* him a small, *beautifully* *bound* notebook. Leo *went* home, *thinking* about the extraordinary encounter. He *understood* that he *had* *been* part of something amazing.`,
            level: "B1",
            difficultWords: {"peculiar":"unusual or strange","device":"a machine or tool made for a special purpose","laboratory":"a room or building where scientific experiments are done"}
          },
          c1: {
            title: "A Spark of Time (C1)",
            content: `On a **serene** afternoon, while exploring the seldom-visited depths of his **attic**, Leo *came* upon an **antiquated** and **enigmatic** **device**. Its cold, intricate surface *felt* alien beneath his fingers. As he *held* it, a profound vibration *began*, and a soft, ethereal *glow* *burst* from within, causing the air to **reverberate**. Abruptly, Leo *found* himself *flung* through space and time, no longer in his familiar surroundings, but *stood* amidst the intricate contraptions of a bustling 19th-century **laboratory**. A distinguished figure, whose keen intellect *shone* in his eyes, *drew* near. "I *am* Nikola Tesla," the inventor *spoke* with quiet dignity. Tesla *showed* Leo an array of his visionary and *groundbreaking* inventions, explaining principles that *went* beyond Leo's comprehension. Leo *knew* instantly that he *had* *been* privileged to *meet* one of history's most profound minds. As the extraordinary encounter *drew* to a close, Tesla *gave* Leo a small, leather-bound journal. Leo *went* back to his room, his mind *swam* with the vivid memory. He *understood* that he *had* *seen* a secret chapter of history, one that *would* forever *bind* him to the past.`,
            level: "C1",
            difficultWords: {"antiquated":"old-fashioned or outdated","enigmatic":"mysterious or difficult to understand","reverberate":"to echo or vibrate strongly"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Comeback Kick </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Comeback Kick",
            content: `It *was* the big school football match on the **pitch**. The Green Dragons *were* playing the Red Rovers. The score *was* 1-0 for the Red Rovers. Leo, a player, *felt* sad. He *knew* his team *could do* better. He *ran* fast, putting in a lot of **effort**. He *got* the ball and *came* close to the goal. He *took* a big kick. The ball *went* into the net! The **cheers** *began* loudly. The Green Dragons *won* the match! Everyone *was* very happy. They *made* a lot of noise. Leo *felt* very proud. It *was* a great day.`,
            level: "A2",
            difficultWords: {"pitch":"The grassy area where football is played.","effort":"The hard work you do.","cheers":"Happy shouts from people watching."}
          },
          b1: {
            title: "The Comeback Kick",
            content: `It *was* the highly **anticipated** school football match between the Green Dragons and the Red Rovers. The atmosphere *was* tense on the pitch. By halftime, the Red Rovers *had taken* a 1-0 lead. Leo, the Dragons' captain, *felt* the pressure. He *knew* his team *had to do* something to change the game's outcome. As the second half *began*, Leo *chose* to drive the team forward with renewed energy. He *ran* with incredible speed, *kept* control of the ball, and *brought* it deep into the opponents' half. He *saw* an opening and *shot* powerfully. The ball *flew* past the goalkeeper and *went* straight into the net! A roar of **applause** *swept* through the stadium. The Green Dragons *had come* back, and they *won* the match 2-1! Leo *felt* a wave of relief and triumph. It *was* a truly **memorable** victory.`,
            level: "B1",
            difficultWords: {"anticipated":"Expected or looked forward to something.","applause":"The clapping of hands to show approval.","memorable":"Worth remembering or easily remembered."}
          },
          c1: {
            title: "The Comeback Kick",
            content: `The atmosphere *was* electric, a **tangible** buzz of fervent anticipation preceding the **pivotal** school football match, which *saw* the revered Green Dragons *meet* their tenacious counterparts, the Red Rovers. A profound tension *held* the pitch. By the interval, the Red Rovers *had taken* a slender 1-0 advantage, a deficit that *bore* heavily upon Leo, the Dragons' stalwart captain. He *knew* his squad *had to do* more, to *overcome* this early setback and prevent an **ignominious** defeat. As the second half *began*, Leo *took* the reins, his resolve *shone* bright. He *sprang* into action, *flew* down the flank with blistering pace, adeptly *kept* possession, and *brought* the sphere deep into the adversaries' territory. Spotting a fleeting breach in their defense, he *let* fly a formidable shot. The ball *streaked* past the bewildered goalkeeper, *finding* the back of the net with resounding finality! A deafening crescendo of acclaim *erupted*, as the crowd *rose* in a collective, jubilant roar. The Green Dragons *had come* back, and *won* a dramatic 2-1 triumph! Leo *felt* an overwhelming surge of elation and vindication. It *was* an epoch-making victory, etched forever in the annals of the school's sporting lore.`,
            level: "C1",
            difficultWords: {"tangible":"Perceptible by touch; real or actual.","pivotal":"Of crucial importance in relation to the development or success of something else.","ignominious":"Deserving or causing public disgrace or shame."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Whispering Garden Cat </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Whiskers' Secret",
            content: `Leo *went* to the garden. The sun *was* warm. Leo *saw* Whiskers, their cat. Whiskers *sat* near a bright flower. Suddenly, Whiskers *spoke*! "Hello, Leo," she *said*. Leo *did not know* what to *think*. Leo *felt* very **amazed**. Whiskers *told* Leo, "This flower *gave* me a gift. I *drank* its special **nectar**. Now I *can speak*!" It *had* a soft **glow**. Leo *began* to *understand*. The garden *was* special. Whiskers *went* to the flower and *showed* Leo a tiny drop. Leo *felt* happy. The garden *had* a special secret.`,
            level: "A2",
            difficultWords: {"amazed":"very surprised","nectar":"a sweet liquid made by flowers","glow":"a soft, steady light"}
          },
          b1: {
            title: "The Garden's Whispering Secret",
            content: `Leo *went* into their quiet garden. The sun *shone* brightly. There, Whiskers, their cat, *sat* calmly near a striking flower. To Leo's astonishment, Whiskers *spoke*! "Good morning, Leo," she *said* softly. Leo *could not believe* what they *heard*. Leo *felt* a wave of surprise. Whiskers *told* Leo, "This unusual flower *held* a powerful **nectar**. I *drank* from it yesterday. It *gave* me the ability to *speak*!" Leo *felt* drawn to the flower, which *shone* with an ethereal **shimmer**. Whiskers *knew* many garden **secrets**. Leo *began* to *understand* that their garden *was* more special than they *had known*. Whiskers *took* Leo closer and *showed* a tiny dewdrop clinging to a petal. Leo *felt* a new sense of wonder.`,
            level: "B1",
            difficultWords: {"nectar":"a sweet liquid produced by flowers","shimmer":"a soft, flickering light or reflection","secrets":"pieces of information known only by a few people"}
          },
          c1: {
            title: "The Luminescent Blossom's Oracle",
            content: `Leo *sought* respite in their tranquil garden, the afternoon sun a warm embrace on their skin. There, Whiskers, their usually reserved feline companion, *sat* poised beside a **luminescent** blossom, its petals appearing to glow from within. To Leo's utter astonishment, Whiskers *spoke*, articulating words with remarkable clarity. "A pleasure to finally converse, Leo," the cat *said* with a gentle purr. Leo's mind *went* blank; they *could not comprehend* what they *had heard*, questioning their own sanity. The sagacious cat, sensing Leo's bewilderment, *spoke* further, asserting that the blossom *held* a potent **elixir**, which *gave* it the extraordinary faculty of speech. "I *drank* from it eons ago," Whiskers *said*.

Leo *was overcome* with a complex mix of wonder and disbelief; their perception of reality *became* irrevocably shifted. Whiskers *led* Leo closer to the **resplendent** flower, which *shed* an ethereal glow that seemed to pulse with ancient energy. The cat *told* Leo it *had known* of the garden's profound, hidden mysteries for years, observing them in silence. Leo *began* to *grasp* the true enchantment of their surroundings, *feeling* an undeniable pull to *learn* its depths. Whiskers *put out* a delicate paw, *giving* Leo a glistening dewdrop from the blossom. "A token," Whiskers *said*, "to help you *understand*." Leo *took* the tiny drop, *feeling* a subtle shift within their perception, a world unseen *began* to open.`,
            level: "C1",
            difficultWords: {"luminescent":"emitting light; glowing","elixir":"a magical or medicinal potion","resplendent":"shining brilliantly; very impressive"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 A New Friendship Blossoms </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "A New Friend",
            content: `Leo *went* to school. He *felt* a little **nervous**. It *was* the first day. A new girl *came* into the room. Her name *was* Maya. She *had* a **bright** smile. Maya *chose* a seat next to Leo. Leo *spoke* to her. "Hi!" he *said*. Maya smiled. They *began* to talk. They *found* they liked the same games. Leo *knew* she *was* **friendly**. He *thought*, "This *is* a good day." He *had* a new friend. He *felt* happy.`,
            level: "A2",
            difficultWords: {"nervous":"feeling worried or scared.","bright":"full of light; shining.","friendly":"kind and pleasant."}
          },
          b1: {
            title: "A New Friend",
            content: `Leo *went* to school, *feeling* a bit **hesitantly**. It *was* the first day back. Soon, a new girl *came* into the classroom. Her name *was* Maya. She *had* a **radiant** smile that *lit* up the room. Maya *chose* a desk right next to Leo's. Leo *felt* a little nervous, but he *knew* he *had* to *speak*. "Hi," he *said*. Maya *gave* a warm smile and *began* to talk about her old school. They *found* they *had* many things in common. They *spoke* about books and sports. Leo *felt* a strong **bond** form. He *thought* this *was* the *beginning* of a great friendship. He *left* school that day *feeling* much happier.`,
            level: "B1",
            difficultWords: {"hesitantly":"in a way that shows you are not sure or confident.","radiant":"showing great joy, health, or beauty.","bond":"a close connection joining two or more people."}
          },
          c1: {
            title: "A New Friend",
            content: `Leo *came* to school, a subtle sense of **apprehension** *creeping* in. It *was* the inaugural day of a new academic year, brimming with unfamiliar faces and routines. Moments later, a new student *came* into the bustling classroom. Her name *was* Maya, and her smile *was* truly **effulgent**, seeming to *light* up the entire space with a remarkable warmth. She *chose* a vacant desk precisely adjacent to Leo's. Leo *felt* an initial wave of trepidation, yet he *knew* he *had* to *break* the ice. "Hello," he *said*, his voice sounding steadier than he *felt*. Maya *gave* his greeting with an inviting warmth, and they *began* a conversation, swiftly *finding* a plethora of shared interests. They *spoke* at length about literature, extracurricular pursuits, and future aspirations, *finding* an easy rhythm between them. Leo sensed a burgeoning **camaraderie** *taking* root, a promising connection forming between them. He *knew* this *was* the auspicious *beginning* of a significant friendship, one that would undoubtedly *bring* much joy. He *left* school that afternoon, his spirits lifted, a genuine sense of optimism *having* *taken* hold.`,
            level: "C1",
            difficultWords: {"apprehension":"anxiety or fear that something bad or unpleasant will happen.","effulgent":"shining brightly; radiant.","camaraderie":"mutual trust and friendship among people who spend a lot of time together."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Unexpected Rain Picnic </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Unexpected Rain Picnic (A2)",
            content: `Lily and Tom *went* to the park. They *chose* a big tree. They *put* a blanket down. They *took* out sandwiches and fruit. They *began* to *eat* and *drank* some water. The sun *was* warm.
Suddenly, the sky *became* dark. Black clouds *came* fast. The wind *got* strong. They *heard* thunder. Rain *fell*. It *was* light at first, then it *got* heavy.
"Oh no!" Lily *said*. They quickly *put* their food away. They *took* their bags. They *ran* to a small house. They *got* wet, but they *did* not mind. They *sat* and *ate* the rest. They *felt* happy even with the **sudden** change. What a **funny** day! They *knew* they *would* remember this **adventure**.`,
            level: "A2",
            difficultWords: {"sudden":"happening quickly and unexpectedly.","funny":"making you laugh.","adventure":"an exciting or unusual experience."}
          },
          b1: {
            title: "The Unexpected Rain Picnic (B1)",
            content: `Lily and Tom *went* to their favorite park for a picnic. They *chose* a perfect spot under a **magnificent** old oak tree. They *laid* their colorful blanket and *took* out a basket filled with sandwiches, fresh fruit, and homemade cookies. They *began* to *eat*, enjoying the warm sun that *shone* brightly overhead. Everything *felt* peaceful.
However, the clear sky quickly *became* a canvas of dark, **ominous** clouds. A strong breeze *blew* through the leaves, and they *heard* the distant rumble of thunder. Rain *began* to *fall*—first a few drops, then a steady shower.
"We *need* to go!" Tom *said*. They quickly *put* their food and belongings away. They *held* their bags and *ran* towards a small park shelter. They *got* quite wet, but they *found* themselves *laughing* as they *came* to safety. They *sat* inside, *ate* the rest of their meal, and *waited* for the **downpour** to subside. It *was* an unexpected but memorable outing.`,
            level: "B1",
            difficultWords: {"magnificent":"very good, beautiful, or impressive.","ominous":"suggesting that something bad is going to happen.","downpour":"a lot of rain in a short time."}
          },
          c1: {
            title: "The Unexpected Rain Picnic (C1)",
            content: `Eleanor and Finn *embarked* on an idyllic picnic excursion to the sprawling nature reserve. They *chose* a secluded nook beneath the ancient, gnarled branches of a venerable oak, which *cast* a generous shadow. Unfurling their bespoke tartan rug, they *laid* out an array of gourmet provisions: artisanal sandwiches, exotic fruits, and freshly *baked* pastries. As they *began* to *feast*, the sun *shone* with a radiant *glow*, and a gentle breeze *swept* through the wildflowers, creating an atmosphere of tranquil contentment.
Without warning, the cerulean sky *transformed* into a dramatic tableau of charcoal-grey clouds, *gathering* with startling rapidity. A brisk wind *swept* in, causing the branches to *sway* violently, and a distant, ominous thunderclap *broke* the silence. Moments later, the first heavy raindrops *began* to *pelt* down, quickly escalating into a torrential **deluge**.
"We must *flee*!" Finn *exclaimed*. With practiced haste, they *thrust* their scattered items into their waterproof satchels. They *took* their belongings and *sprinted* through the downpour towards a modest, unassuming **pavilion**. Though thoroughly *drenched*, they *found* themselves *bursting* into laughter, the unexpected turn of events only adding to the day's unique charm. Settled within the shelter, they *devoured* the remainder of their gourmet fare, *recounting* the unforeseen **contingency**, an indelible memory *etched* into their minds.`,
            level: "C1",
            difficultWords: {"deluge":"a severe flood; a very heavy fall of rain.","pavilion":"a light, ornamental building or structure, typically one that is open, used for entertainment or shelter.","contingency":"a future event or circumstance which is possible but cannot be predicted with certainty."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Grandma's Secret Apple Pie </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Grandma's Secret Apple Pie",
            content: `Lily *went* to her grandma's house. "Let's *make* apple pie!" Grandma *said*. Lily *felt* happy in the **cozy** kitchen.
Grandma *gave* Lily red apples. Lily *took* a knife and *cut* them. Grandma *showed* her how to *do* it.
Then they *made* the pie dough. Lily *put* flour and water together. It *became* soft. They *did* it together, laughing.
The pie *went* into the oven. Soon, a sweet **aroma** *began* to *fill* the house. Lily *knew* it *was* good.
After some time, Grandma *took* the pie out. It *was* golden. They *let* it cool.
Later, they *sat* at the table. They *ate* the pie. It *was* delicious. Lily *thought* this **cherished** time *was* very special. She *would keep* this memory always.`,
            level: "A2",
            difficultWords: {"cozy":"comfortable and warm","aroma":"a pleasant, noticeable smell","cherished":"valued highly and loved"}
          },
          b1: {
            title: "Grandma's Secret Apple Pie",
            content: `One sunny afternoon, Lily *went* to her grandma's house. "Shall we *make* my famous apple pie?" Grandma *said*, a **twinkle** in her eye. Lily *felt* excitement *build*.
They *came* to the comfortable kitchen. Grandma *gave* Lily a basket of crisp, red apples. Lily *took* a small paring knife and *began* to *cut* them into neat slices. Grandma *showed* her the special technique, ensuring each slice *was* perfect.
Next, they *made* the rich, flaky pie dough. Lily *put* the ingredients together, carefully *mixing* the flour and butter until it *became* smooth and pliable. They *did* it with practiced ease, their hands working in sync.
The pie *went* into the warm oven. Soon, an irresistible **fragrance** *began* to *fill* every corner of the house, a sweet and spicy scent that *made* Lily eager. Lily *knew* it *would be* perfect.
After a while, Grandma *took* the golden-brown pie out. It *was* beautiful. They *let* it cool on the counter.
Later, they *sat* together, *eating* slices of the warm pie. It *was* incredibly delicious. Lily *thought* this shared **ritual** *was* truly special, a cherished family custom she *would keep* in her heart for years to come.`,
            level: "B1",
            difficultWords: {"twinkle":"a sparkling light in the eye, indicating amusement or liveliness","fragrance":"a pleasant, sweet smell","ritual":"a customary observance or practice"}
          },
          c1: {
            title: "Grandma's Secret Apple Pie",
            content: `A balmy afternoon *found* Lily at her grandmother's quaint abode. "Fancy *making* my legendary apple pie?" Grandma *said*, a benevolent **gleam** in her eyes. Lily *felt* a surge of enthusiastic anticipation.
They *came* to the **hospitable** kitchen, where a comforting warmth *spread* through the air. Grandma *gave* Lily a bounty of crisp, ruby-red apples. Lily *chose* a delicate paring knife and meticulously *began* to *cut* them into uniform slices. Grandma adeptly *showed* her the precise technique, ensuring each segment *was* flawlessly prepared.
Subsequently, they *made* the exquisite, tender pie dough. Lily *put* the meticulously measured ingredients, carefully *bound* the flour and rich butter until the mixture *became* a supple, pliable mass. Their synchronised efforts *made* the task effortless, as if they *knew* the recipe by heart.
The nascent pie *went* into the preheated oven. Before long, an irresistible **perfume** *began* to *rise* through every recess of the dwelling, a complex symphony of sweet and spicy notes that *drew* Lily deeper into the culinary process. Lily intuitively *knew* the outcome *would be* superb.
In due course, Grandma *took* the perfectly golden-brown pie from its fiery chamber. It *was* a true masterpiece. They *let* it cool, the anticipation almost palpable.
Finally, they *sat* together, *eating* generous portions of the still-warm pie. Its flavour *was* profoundly gratifying. Lily *thought* that this shared culinary *endeavour* *was* an invaluable generational bond, a cherished family **legacy** she *would keep* forward, having *learned* so much from this shared experience.`,
            level: "C1",
            difficultWords: {"gleam":"a flash or beam of light; a strong, pleasant emotion","hospitable":"friendly and welcoming to guests or strangers","legacy":"something that is handed down from one generation to the next"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Wrong Train </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Wrong Train",
            content: `Leo *had* a ticket for Brightville. He *went* to the train **platform**. He *saw* a train and *got* on it. He *sat* down and *fell* asleep. When he *woke* up, he *saw* a sign. It *said* "Darkwood." "Oh no!" he *thought*. He *felt* a strong **panic**. This *was* the wrong train! His **destination** *was* Brightville. He *did not know* what to *do*. He *found* a man and *said*, "Where *am* I?" The man *told* him. Leo *took* the next train back. He *was* late but *learned* a lesson: always check the train!`,
            level: "A2",
            difficultWords: {"platform":"An area next to train tracks where people get on and off trains.","panic":"A sudden strong feeling of fear that makes you unable to think or act clearly.","destination":"The place to which someone or something is going or being sent."}
          },
          b1: {
            title: "The Wrong Train",
            content: `Leo *had planned* a trip to Brightville. He *went* to the station, feeling excited. On the correct **platform**, he *saw* a train ready to *depart*. He quickly *bought* a snack and *got* on board, *choosing* a window seat. He *began* to *read* his book, but soon *fell* asleep. He *dreamt* he *was* already in Brightville. When he *woke* up, the train *stood* still. He *looked* out and *felt* **disoriented** as he *read* the station name: Darkwood. He *realized* he *had taken* the wrong train! His heart *sank*. He *knew* he *had made* a serious error. He *got* off and *found* a station agent who *told* him how to **retrace** his journey. It *was* a long trip back, but he *eventually got* to Brightville, albeit late. He *swore* to always double-check his tickets in the future.`,
            level: "B1",
            difficultWords: {"platform":"An area next to train tracks where people get on and off trains.","disoriented":"Confused and not knowing where you are or what direction to go in.","retrace":"To go back over the same path or route."}
          },
          c1: {
            title: "The Wrong Train",
            content: `Leo *had embarked* on a crucial **expedition** to Brightville, *bearing* a meticulously planned itinerary. Arriving at the bustling railway terminus, he *found* his designated platform amidst a slight **commotion**. He *bought* a coffee, *chose* a quiet compartment, and swiftly *settled* in. The rhythmic *sway* of the carriage soon *lulled* him into a deep slumber, where he *dreamt* of successful presentations. He *awoke* abruptly, *feeling* an unsettling stillness. *Casting* his gaze out the window, his heart *began* to pound as he *read* the stark sign: "Darkwood." A cold realization *swept* over him – he *had unequivocally mistaken* his intended service. He *knew* he *had fallen* victim to an **erroneous** choice. He *sprang* up, *felt* a wave of urgency, and *got* off the train. He quickly *sought* assistance from a bewildered conductor who *told* him the necessary steps to *rectify* his blunder. Though the *ensuing* journey *proved* arduous and *cost* him valuable time, Leo *eventually reached* Brightville, profoundly *taught* by his misadventure. He *resolved* to meticulous scrutiny for all future travels.`,
            level: "C1",
            difficultWords: {"expedition":"A journey undertaken by a group of people with a particular purpose, especially of exploration, scientific research, or war.","commotion":"A state of confused and noisy disturbance.","erroneous":"Wrong; incorrect."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Late Start </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Leo's Big Rush",
            content: `Leo *did not hear* his alarm. He *slept* very well. Suddenly, he *woke* up. The sun *was* bright. He *saw* the clock. "Oh no!" he *thought*. It *was* 8:00 AM! School *began* at 8:30. He *had* to *go* fast. Leo *got* out of bed quickly. He *put* on his uniform. He *ran* to the kitchen. He *ate* a piece of toast. His bag *was* already ready. He *took* his bag and *went* out the door. He *ran* all the way to school. The school gate *was* almost shut. He *made* it! He *felt* **tired** but happy. He *learned* his lesson: always *set* your alarm! He *saw* his friends inside. It *was* a **busy** morning. He *knew* he *would* not *forget* this day. He *was* lucky not to be **absent**.`,
            level: "A2",
            difficultWords: {"tired":"feeling like you need to rest or sleep.","busy":"having a lot of things to do.","absent":"not present; not at a place you should be."}
          },
          b1: {
            title: "The Morning Scramble",
            content: `Leo *didn't hear* his alarm. He *slept* soundly, enjoying a deep slumber. Suddenly, his eyes *flew* open. The sunlight *shone* brightly through his window, unusually strong for a school day. He *saw* the clock on his bedside table. "Oh no!" he *thought*, his heart *began* to *beat* fast. It *was* 8:00 AM! School *began* at 8:30. He *knew* he *had* to *get* moving. Leo *got* out of bed with a **jolt**. He *put* on his uniform in record time and *ran* downstairs. He quickly *ate* a piece of toast, barely tasting it. His backpack *was* already packed. He *took* it and *flew* out the door. He *ran* as fast as he *could*, his lungs *burned*. The school gate *was* just closing. He *made* it, *feeling* **exhausted** but relieved. He *learned* a valuable lesson: never trust your alarm's snooze button alone! He *saw* his friends waiting and *knew* he *would* never *forget* this **chaotic** morning.`,
            level: "B1",
            difficultWords: {"jolt":"a sudden, strong, and unpleasant movement or shock.","exhausted":"extremely tired.","chaotic":"in a state of complete confusion and disorder."}
          },
          c1: {
            title: "A Disorienting Dawn",
            content: `Leo *did not awake* to his alarm's persistent chime. He *had slept* profoundly, a deep, undisturbed repose that *felt* almost blissful. Abruptly, his eyes *flung* open. A stark, **unfiltered** brilliance *shone* through his window, an intensity that immediately *struck* him as unusual. He *saw* the digital display on his nightstand. "Good heavens!" he *thought*, a surge of adrenaline *swept* through him. It *read* 8:00 AM! School *was* to *begin* at 8:30. He *knew* instantly that he *was* in a dire predicament. Leo *sprang* from his bed, his movements almost *instinctive*. He *put* on his uniform with uncharacteristic speed and *flew* downstairs. He quickly *ate* a piece of toast, barely tasting it. His satchel *had been* prepared the night before. He *took* it and *burst* out the door. He *ran* with a **frantic** intensity, his body *felt* taut with effort. The formidable school gates *were* on the verge of *shutting*. He *made* it, *feeling* utterly drained but undeniably triumphant. He *had learned* a crucial lesson: reliance on a single alarm *could lead* to unforeseen **catastrophe**. He *saw* his classmates already assembled and *knew* this episode *would become* etched in his memory.`,
            level: "C1",
            difficultWords: {"unfiltered":"not altered or treated; direct and intense.","frantic":"feeling or showing a lot of fear and worry; very anxious and agitated.","catastrophe":"an event causing great and often sudden damage or suffering; a disaster."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>





    <!-- Cards from n8n will appear here -->
  </div>
</body>
</html>


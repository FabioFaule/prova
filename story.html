<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Le Storie</title>
</head>
<body>
    <div id="cards-container">
<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 A Spark of Time </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "A Spark of Time (A2)",
            content: `Leo *found* an old **device** in his **attic**. It *was* dusty. He *took* it in his hand. Suddenly, it *began* to **hum** a soft sound. A bright light *came*. Leo *felt* strange. In a moment, he *was* in a new place. He *saw* a man with a kind face. "I *am* Nikola Tesla," the man *said*. Tesla *showed* Leo a big machine. Leo *understood* that he *met* a great inventor. Tesla *gave* Leo a small book. Leo *went* back to his room. He *knew* this day *would* *be* special. He *had* a story to *tell*.`,
            level: "A2",
            difficultWords: {"device":"a machine or tool made for a special purpose","attic":"a space or room at the top of a house, under the roof","hum":"to make a low, continuous sound"}
          },
          b1: {
            title: "A Spark of Time (B1)",
            content: `One sunny afternoon, Leo *found* a **peculiar** old **device** hidden in his dusty **attic**. He *picked* it up, *feeling* its cool metal. As he *held* it, the device *began* to *glow* and *hum* softly, a strange sound *filled* the air. In a flash, Leo *was* no longer in his room; he *stood* in a dimly lit **laboratory** *filled* with wires and machines. A tall, elegant man with a thoughtful expression *came* forward. "I *am* Nikola Tesla," he *said* with a smile. Tesla *showed* Leo many *innovative* inventions. Leo *knew* he *met* a true genius. Before Leo *left*, Tesla *gave* him a small, *beautifully* *bound* notebook. Leo *went* home, *thinking* about the extraordinary encounter. He *understood* that he *had* *been* part of something amazing.`,
            level: "B1",
            difficultWords: {"peculiar":"unusual or strange","device":"a machine or tool made for a special purpose","laboratory":"a room or building where scientific experiments are done"}
          },
          c1: {
            title: "A Spark of Time (C1)",
            content: `On a **serene** afternoon, while exploring the seldom-visited depths of his **attic**, Leo *came* upon an **antiquated** and **enigmatic** **device**. Its cold, intricate surface *felt* alien beneath his fingers. As he *held* it, a profound vibration *began*, and a soft, ethereal *glow* *burst* from within, causing the air to **reverberate**. Abruptly, Leo *found* himself *flung* through space and time, no longer in his familiar surroundings, but *stood* amidst the intricate contraptions of a bustling 19th-century **laboratory**. A distinguished figure, whose keen intellect *shone* in his eyes, *drew* near. "I *am* Nikola Tesla," the inventor *spoke* with quiet dignity. Tesla *showed* Leo an array of his visionary and *groundbreaking* inventions, explaining principles that *went* beyond Leo's comprehension. Leo *knew* instantly that he *had* *been* privileged to *meet* one of history's most profound minds. As the extraordinary encounter *drew* to a close, Tesla *gave* Leo a small, leather-bound journal. Leo *went* back to his room, his mind *swam* with the vivid memory. He *understood* that he *had* *seen* a secret chapter of history, one that *would* forever *bind* him to the past.`,
            level: "C1",
            difficultWords: {"antiquated":"old-fashioned or outdated","enigmatic":"mysterious or difficult to understand","reverberate":"to echo or vibrate strongly"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Comeback Kick </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Comeback Kick",
            content: `It *was* the big school football match on the **pitch**. The Green Dragons *were* playing the Red Rovers. The score *was* 1-0 for the Red Rovers. Leo, a player, *felt* sad. He *knew* his team *could do* better. He *ran* fast, putting in a lot of **effort**. He *got* the ball and *came* close to the goal. He *took* a big kick. The ball *went* into the net! The **cheers** *began* loudly. The Green Dragons *won* the match! Everyone *was* very happy. They *made* a lot of noise. Leo *felt* very proud. It *was* a great day.`,
            level: "A2",
            difficultWords: {"pitch":"The grassy area where football is played.","effort":"The hard work you do.","cheers":"Happy shouts from people watching."}
          },
          b1: {
            title: "The Comeback Kick",
            content: `It *was* the highly **anticipated** school football match between the Green Dragons and the Red Rovers. The atmosphere *was* tense on the pitch. By halftime, the Red Rovers *had taken* a 1-0 lead. Leo, the Dragons' captain, *felt* the pressure. He *knew* his team *had to do* something to change the game's outcome. As the second half *began*, Leo *chose* to drive the team forward with renewed energy. He *ran* with incredible speed, *kept* control of the ball, and *brought* it deep into the opponents' half. He *saw* an opening and *shot* powerfully. The ball *flew* past the goalkeeper and *went* straight into the net! A roar of **applause** *swept* through the stadium. The Green Dragons *had come* back, and they *won* the match 2-1! Leo *felt* a wave of relief and triumph. It *was* a truly **memorable** victory.`,
            level: "B1",
            difficultWords: {"anticipated":"Expected or looked forward to something.","applause":"The clapping of hands to show approval.","memorable":"Worth remembering or easily remembered."}
          },
          c1: {
            title: "The Comeback Kick",
            content: `The atmosphere *was* electric, a **tangible** buzz of fervent anticipation preceding the **pivotal** school football match, which *saw* the revered Green Dragons *meet* their tenacious counterparts, the Red Rovers. A profound tension *held* the pitch. By the interval, the Red Rovers *had taken* a slender 1-0 advantage, a deficit that *bore* heavily upon Leo, the Dragons' stalwart captain. He *knew* his squad *had to do* more, to *overcome* this early setback and prevent an **ignominious** defeat. As the second half *began*, Leo *took* the reins, his resolve *shone* bright. He *sprang* into action, *flew* down the flank with blistering pace, adeptly *kept* possession, and *brought* the sphere deep into the adversaries' territory. Spotting a fleeting breach in their defense, he *let* fly a formidable shot. The ball *streaked* past the bewildered goalkeeper, *finding* the back of the net with resounding finality! A deafening crescendo of acclaim *erupted*, as the crowd *rose* in a collective, jubilant roar. The Green Dragons *had come* back, and *won* a dramatic 2-1 triumph! Leo *felt* an overwhelming surge of elation and vindication. It *was* an epoch-making victory, etched forever in the annals of the school's sporting lore.`,
            level: "C1",
            difficultWords: {"tangible":"Perceptible by touch; real or actual.","pivotal":"Of crucial importance in relation to the development or success of something else.","ignominious":"Deserving or causing public disgrace or shame."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Whispering Garden Cat </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Whiskers' Secret",
            content: `Leo *went* to the garden. The sun *was* warm. Leo *saw* Whiskers, their cat. Whiskers *sat* near a bright flower. Suddenly, Whiskers *spoke*! "Hello, Leo," she *said*. Leo *did not know* what to *think*. Leo *felt* very **amazed**. Whiskers *told* Leo, "This flower *gave* me a gift. I *drank* its special **nectar**. Now I *can speak*!" It *had* a soft **glow**. Leo *began* to *understand*. The garden *was* special. Whiskers *went* to the flower and *showed* Leo a tiny drop. Leo *felt* happy. The garden *had* a special secret.`,
            level: "A2",
            difficultWords: {"amazed":"very surprised","nectar":"a sweet liquid made by flowers","glow":"a soft, steady light"}
          },
          b1: {
            title: "The Garden's Whispering Secret",
            content: `Leo *went* into their quiet garden. The sun *shone* brightly. There, Whiskers, their cat, *sat* calmly near a striking flower. To Leo's astonishment, Whiskers *spoke*! "Good morning, Leo," she *said* softly. Leo *could not believe* what they *heard*. Leo *felt* a wave of surprise. Whiskers *told* Leo, "This unusual flower *held* a powerful **nectar**. I *drank* from it yesterday. It *gave* me the ability to *speak*!" Leo *felt* drawn to the flower, which *shone* with an ethereal **shimmer**. Whiskers *knew* many garden **secrets**. Leo *began* to *understand* that their garden *was* more special than they *had known*. Whiskers *took* Leo closer and *showed* a tiny dewdrop clinging to a petal. Leo *felt* a new sense of wonder.`,
            level: "B1",
            difficultWords: {"nectar":"a sweet liquid produced by flowers","shimmer":"a soft, flickering light or reflection","secrets":"pieces of information known only by a few people"}
          },
          c1: {
            title: "The Luminescent Blossom's Oracle",
            content: `Leo *sought* respite in their tranquil garden, the afternoon sun a warm embrace on their skin. There, Whiskers, their usually reserved feline companion, *sat* poised beside a **luminescent** blossom, its petals appearing to glow from within. To Leo's utter astonishment, Whiskers *spoke*, articulating words with remarkable clarity. "A pleasure to finally converse, Leo," the cat *said* with a gentle purr. Leo's mind *went* blank; they *could not comprehend* what they *had heard*, questioning their own sanity. The sagacious cat, sensing Leo's bewilderment, *spoke* further, asserting that the blossom *held* a potent **elixir**, which *gave* it the extraordinary faculty of speech. "I *drank* from it eons ago," Whiskers *said*.

Leo *was overcome* with a complex mix of wonder and disbelief; their perception of reality *became* irrevocably shifted. Whiskers *led* Leo closer to the **resplendent** flower, which *shed* an ethereal glow that seemed to pulse with ancient energy. The cat *told* Leo it *had known* of the garden's profound, hidden mysteries for years, observing them in silence. Leo *began* to *grasp* the true enchantment of their surroundings, *feeling* an undeniable pull to *learn* its depths. Whiskers *put out* a delicate paw, *giving* Leo a glistening dewdrop from the blossom. "A token," Whiskers *said*, "to help you *understand*." Leo *took* the tiny drop, *feeling* a subtle shift within their perception, a world unseen *began* to open.`,
            level: "C1",
            difficultWords: {"luminescent":"emitting light; glowing","elixir":"a magical or medicinal potion","resplendent":"shining brilliantly; very impressive"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 A New Friendship Blossoms </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "A New Friend",
            content: `Leo *went* to school. He *felt* a little **nervous**. It *was* the first day. A new girl *came* into the room. Her name *was* Maya. She *had* a **bright** smile. Maya *chose* a seat next to Leo. Leo *spoke* to her. "Hi!" he *said*. Maya smiled. They *began* to talk. They *found* they liked the same games. Leo *knew* she *was* **friendly**. He *thought*, "This *is* a good day." He *had* a new friend. He *felt* happy.`,
            level: "A2",
            difficultWords: {"nervous":"feeling worried or scared.","bright":"full of light; shining.","friendly":"kind and pleasant."}
          },
          b1: {
            title: "A New Friend",
            content: `Leo *went* to school, *feeling* a bit **hesitantly**. It *was* the first day back. Soon, a new girl *came* into the classroom. Her name *was* Maya. She *had* a **radiant** smile that *lit* up the room. Maya *chose* a desk right next to Leo's. Leo *felt* a little nervous, but he *knew* he *had* to *speak*. "Hi," he *said*. Maya *gave* a warm smile and *began* to talk about her old school. They *found* they *had* many things in common. They *spoke* about books and sports. Leo *felt* a strong **bond** form. He *thought* this *was* the *beginning* of a great friendship. He *left* school that day *feeling* much happier.`,
            level: "B1",
            difficultWords: {"hesitantly":"in a way that shows you are not sure or confident.","radiant":"showing great joy, health, or beauty.","bond":"a close connection joining two or more people."}
          },
          c1: {
            title: "A New Friend",
            content: `Leo *came* to school, a subtle sense of **apprehension** *creeping* in. It *was* the inaugural day of a new academic year, brimming with unfamiliar faces and routines. Moments later, a new student *came* into the bustling classroom. Her name *was* Maya, and her smile *was* truly **effulgent**, seeming to *light* up the entire space with a remarkable warmth. She *chose* a vacant desk precisely adjacent to Leo's. Leo *felt* an initial wave of trepidation, yet he *knew* he *had* to *break* the ice. "Hello," he *said*, his voice sounding steadier than he *felt*. Maya *gave* his greeting with an inviting warmth, and they *began* a conversation, swiftly *finding* a plethora of shared interests. They *spoke* at length about literature, extracurricular pursuits, and future aspirations, *finding* an easy rhythm between them. Leo sensed a burgeoning **camaraderie** *taking* root, a promising connection forming between them. He *knew* this *was* the auspicious *beginning* of a significant friendship, one that would undoubtedly *bring* much joy. He *left* school that afternoon, his spirits lifted, a genuine sense of optimism *having* *taken* hold.`,
            level: "C1",
            difficultWords: {"apprehension":"anxiety or fear that something bad or unpleasant will happen.","effulgent":"shining brightly; radiant.","camaraderie":"mutual trust and friendship among people who spend a lot of time together."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Unexpected Rain Picnic </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Unexpected Rain Picnic (A2)",
            content: `Lily and Tom *went* to the park. They *chose* a big tree. They *put* a blanket down. They *took* out sandwiches and fruit. They *began* to *eat* and *drank* some water. The sun *was* warm.
Suddenly, the sky *became* dark. Black clouds *came* fast. The wind *got* strong. They *heard* thunder. Rain *fell*. It *was* light at first, then it *got* heavy.
"Oh no!" Lily *said*. They quickly *put* their food away. They *took* their bags. They *ran* to a small house. They *got* wet, but they *did* not mind. They *sat* and *ate* the rest. They *felt* happy even with the **sudden** change. What a **funny** day! They *knew* they *would* remember this **adventure**.`,
            level: "A2",
            difficultWords: {"sudden":"happening quickly and unexpectedly.","funny":"making you laugh.","adventure":"an exciting or unusual experience."}
          },
          b1: {
            title: "The Unexpected Rain Picnic (B1)",
            content: `Lily and Tom *went* to their favorite park for a picnic. They *chose* a perfect spot under a **magnificent** old oak tree. They *laid* their colorful blanket and *took* out a basket filled with sandwiches, fresh fruit, and homemade cookies. They *began* to *eat*, enjoying the warm sun that *shone* brightly overhead. Everything *felt* peaceful.
However, the clear sky quickly *became* a canvas of dark, **ominous** clouds. A strong breeze *blew* through the leaves, and they *heard* the distant rumble of thunder. Rain *began* to *fall*—first a few drops, then a steady shower.
"We *need* to go!" Tom *said*. They quickly *put* their food and belongings away. They *held* their bags and *ran* towards a small park shelter. They *got* quite wet, but they *found* themselves *laughing* as they *came* to safety. They *sat* inside, *ate* the rest of their meal, and *waited* for the **downpour** to subside. It *was* an unexpected but memorable outing.`,
            level: "B1",
            difficultWords: {"magnificent":"very good, beautiful, or impressive.","ominous":"suggesting that something bad is going to happen.","downpour":"a lot of rain in a short time."}
          },
          c1: {
            title: "The Unexpected Rain Picnic (C1)",
            content: `Eleanor and Finn *embarked* on an idyllic picnic excursion to the sprawling nature reserve. They *chose* a secluded nook beneath the ancient, gnarled branches of a venerable oak, which *cast* a generous shadow. Unfurling their bespoke tartan rug, they *laid* out an array of gourmet provisions: artisanal sandwiches, exotic fruits, and freshly *baked* pastries. As they *began* to *feast*, the sun *shone* with a radiant *glow*, and a gentle breeze *swept* through the wildflowers, creating an atmosphere of tranquil contentment.
Without warning, the cerulean sky *transformed* into a dramatic tableau of charcoal-grey clouds, *gathering* with startling rapidity. A brisk wind *swept* in, causing the branches to *sway* violently, and a distant, ominous thunderclap *broke* the silence. Moments later, the first heavy raindrops *began* to *pelt* down, quickly escalating into a torrential **deluge**.
"We must *flee*!" Finn *exclaimed*. With practiced haste, they *thrust* their scattered items into their waterproof satchels. They *took* their belongings and *sprinted* through the downpour towards a modest, unassuming **pavilion**. Though thoroughly *drenched*, they *found* themselves *bursting* into laughter, the unexpected turn of events only adding to the day's unique charm. Settled within the shelter, they *devoured* the remainder of their gourmet fare, *recounting* the unforeseen **contingency**, an indelible memory *etched* into their minds.`,
            level: "C1",
            difficultWords: {"deluge":"a severe flood; a very heavy fall of rain.","pavilion":"a light, ornamental building or structure, typically one that is open, used for entertainment or shelter.","contingency":"a future event or circumstance which is possible but cannot be predicted with certainty."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Grandma's Secret Apple Pie </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Grandma's Secret Apple Pie",
            content: `Lily *went* to her grandma's house. "Let's *make* apple pie!" Grandma *said*. Lily *felt* happy in the **cozy** kitchen.
Grandma *gave* Lily red apples. Lily *took* a knife and *cut* them. Grandma *showed* her how to *do* it.
Then they *made* the pie dough. Lily *put* flour and water together. It *became* soft. They *did* it together, laughing.
The pie *went* into the oven. Soon, a sweet **aroma** *began* to *fill* the house. Lily *knew* it *was* good.
After some time, Grandma *took* the pie out. It *was* golden. They *let* it cool.
Later, they *sat* at the table. They *ate* the pie. It *was* delicious. Lily *thought* this **cherished** time *was* very special. She *would keep* this memory always.`,
            level: "A2",
            difficultWords: {"cozy":"comfortable and warm","aroma":"a pleasant, noticeable smell","cherished":"valued highly and loved"}
          },
          b1: {
            title: "Grandma's Secret Apple Pie",
            content: `One sunny afternoon, Lily *went* to her grandma's house. "Shall we *make* my famous apple pie?" Grandma *said*, a **twinkle** in her eye. Lily *felt* excitement *build*.
They *came* to the comfortable kitchen. Grandma *gave* Lily a basket of crisp, red apples. Lily *took* a small paring knife and *began* to *cut* them into neat slices. Grandma *showed* her the special technique, ensuring each slice *was* perfect.
Next, they *made* the rich, flaky pie dough. Lily *put* the ingredients together, carefully *mixing* the flour and butter until it *became* smooth and pliable. They *did* it with practiced ease, their hands working in sync.
The pie *went* into the warm oven. Soon, an irresistible **fragrance** *began* to *fill* every corner of the house, a sweet and spicy scent that *made* Lily eager. Lily *knew* it *would be* perfect.
After a while, Grandma *took* the golden-brown pie out. It *was* beautiful. They *let* it cool on the counter.
Later, they *sat* together, *eating* slices of the warm pie. It *was* incredibly delicious. Lily *thought* this shared **ritual** *was* truly special, a cherished family custom she *would keep* in her heart for years to come.`,
            level: "B1",
            difficultWords: {"twinkle":"a sparkling light in the eye, indicating amusement or liveliness","fragrance":"a pleasant, sweet smell","ritual":"a customary observance or practice"}
          },
          c1: {
            title: "Grandma's Secret Apple Pie",
            content: `A balmy afternoon *found* Lily at her grandmother's quaint abode. "Fancy *making* my legendary apple pie?" Grandma *said*, a benevolent **gleam** in her eyes. Lily *felt* a surge of enthusiastic anticipation.
They *came* to the **hospitable** kitchen, where a comforting warmth *spread* through the air. Grandma *gave* Lily a bounty of crisp, ruby-red apples. Lily *chose* a delicate paring knife and meticulously *began* to *cut* them into uniform slices. Grandma adeptly *showed* her the precise technique, ensuring each segment *was* flawlessly prepared.
Subsequently, they *made* the exquisite, tender pie dough. Lily *put* the meticulously measured ingredients, carefully *bound* the flour and rich butter until the mixture *became* a supple, pliable mass. Their synchronised efforts *made* the task effortless, as if they *knew* the recipe by heart.
The nascent pie *went* into the preheated oven. Before long, an irresistible **perfume** *began* to *rise* through every recess of the dwelling, a complex symphony of sweet and spicy notes that *drew* Lily deeper into the culinary process. Lily intuitively *knew* the outcome *would be* superb.
In due course, Grandma *took* the perfectly golden-brown pie from its fiery chamber. It *was* a true masterpiece. They *let* it cool, the anticipation almost palpable.
Finally, they *sat* together, *eating* generous portions of the still-warm pie. Its flavour *was* profoundly gratifying. Lily *thought* that this shared culinary *endeavour* *was* an invaluable generational bond, a cherished family **legacy** she *would keep* forward, having *learned* so much from this shared experience.`,
            level: "C1",
            difficultWords: {"gleam":"a flash or beam of light; a strong, pleasant emotion","hospitable":"friendly and welcoming to guests or strangers","legacy":"something that is handed down from one generation to the next"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Wrong Train </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Wrong Train",
            content: `Leo *had* a ticket for Brightville. He *went* to the train **platform**. He *saw* a train and *got* on it. He *sat* down and *fell* asleep. When he *woke* up, he *saw* a sign. It *said* "Darkwood." "Oh no!" he *thought*. He *felt* a strong **panic**. This *was* the wrong train! His **destination** *was* Brightville. He *did not know* what to *do*. He *found* a man and *said*, "Where *am* I?" The man *told* him. Leo *took* the next train back. He *was* late but *learned* a lesson: always check the train!`,
            level: "A2",
            difficultWords: {"platform":"An area next to train tracks where people get on and off trains.","panic":"A sudden strong feeling of fear that makes you unable to think or act clearly.","destination":"The place to which someone or something is going or being sent."}
          },
          b1: {
            title: "The Wrong Train",
            content: `Leo *had planned* a trip to Brightville. He *went* to the station, feeling excited. On the correct **platform**, he *saw* a train ready to *depart*. He quickly *bought* a snack and *got* on board, *choosing* a window seat. He *began* to *read* his book, but soon *fell* asleep. He *dreamt* he *was* already in Brightville. When he *woke* up, the train *stood* still. He *looked* out and *felt* **disoriented** as he *read* the station name: Darkwood. He *realized* he *had taken* the wrong train! His heart *sank*. He *knew* he *had made* a serious error. He *got* off and *found* a station agent who *told* him how to **retrace** his journey. It *was* a long trip back, but he *eventually got* to Brightville, albeit late. He *swore* to always double-check his tickets in the future.`,
            level: "B1",
            difficultWords: {"platform":"An area next to train tracks where people get on and off trains.","disoriented":"Confused and not knowing where you are or what direction to go in.","retrace":"To go back over the same path or route."}
          },
          c1: {
            title: "The Wrong Train",
            content: `Leo *had embarked* on a crucial **expedition** to Brightville, *bearing* a meticulously planned itinerary. Arriving at the bustling railway terminus, he *found* his designated platform amidst a slight **commotion**. He *bought* a coffee, *chose* a quiet compartment, and swiftly *settled* in. The rhythmic *sway* of the carriage soon *lulled* him into a deep slumber, where he *dreamt* of successful presentations. He *awoke* abruptly, *feeling* an unsettling stillness. *Casting* his gaze out the window, his heart *began* to pound as he *read* the stark sign: "Darkwood." A cold realization *swept* over him – he *had unequivocally mistaken* his intended service. He *knew* he *had fallen* victim to an **erroneous** choice. He *sprang* up, *felt* a wave of urgency, and *got* off the train. He quickly *sought* assistance from a bewildered conductor who *told* him the necessary steps to *rectify* his blunder. Though the *ensuing* journey *proved* arduous and *cost* him valuable time, Leo *eventually reached* Brightville, profoundly *taught* by his misadventure. He *resolved* to meticulous scrutiny for all future travels.`,
            level: "C1",
            difficultWords: {"expedition":"A journey undertaken by a group of people with a particular purpose, especially of exploration, scientific research, or war.","commotion":"A state of confused and noisy disturbance.","erroneous":"Wrong; incorrect."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Late Start </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Leo's Big Rush",
            content: `Leo *did not hear* his alarm. He *slept* very well. Suddenly, he *woke* up. The sun *was* bright. He *saw* the clock. "Oh no!" he *thought*. It *was* 8:00 AM! School *began* at 8:30. He *had* to *go* fast. Leo *got* out of bed quickly. He *put* on his uniform. He *ran* to the kitchen. He *ate* a piece of toast. His bag *was* already ready. He *took* his bag and *went* out the door. He *ran* all the way to school. The school gate *was* almost shut. He *made* it! He *felt* **tired** but happy. He *learned* his lesson: always *set* your alarm! He *saw* his friends inside. It *was* a **busy** morning. He *knew* he *would* not *forget* this day. He *was* lucky not to be **absent**.`,
            level: "A2",
            difficultWords: {"tired":"feeling like you need to rest or sleep.","busy":"having a lot of things to do.","absent":"not present; not at a place you should be."}
          },
          b1: {
            title: "The Morning Scramble",
            content: `Leo *didn't hear* his alarm. He *slept* soundly, enjoying a deep slumber. Suddenly, his eyes *flew* open. The sunlight *shone* brightly through his window, unusually strong for a school day. He *saw* the clock on his bedside table. "Oh no!" he *thought*, his heart *began* to *beat* fast. It *was* 8:00 AM! School *began* at 8:30. He *knew* he *had* to *get* moving. Leo *got* out of bed with a **jolt**. He *put* on his uniform in record time and *ran* downstairs. He quickly *ate* a piece of toast, barely tasting it. His backpack *was* already packed. He *took* it and *flew* out the door. He *ran* as fast as he *could*, his lungs *burned*. The school gate *was* just closing. He *made* it, *feeling* **exhausted** but relieved. He *learned* a valuable lesson: never trust your alarm's snooze button alone! He *saw* his friends waiting and *knew* he *would* never *forget* this **chaotic** morning.`,
            level: "B1",
            difficultWords: {"jolt":"a sudden, strong, and unpleasant movement or shock.","exhausted":"extremely tired.","chaotic":"in a state of complete confusion and disorder."}
          },
          c1: {
            title: "A Disorienting Dawn",
            content: `Leo *did not awake* to his alarm's persistent chime. He *had slept* profoundly, a deep, undisturbed repose that *felt* almost blissful. Abruptly, his eyes *flung* open. A stark, **unfiltered** brilliance *shone* through his window, an intensity that immediately *struck* him as unusual. He *saw* the digital display on his nightstand. "Good heavens!" he *thought*, a surge of adrenaline *swept* through him. It *read* 8:00 AM! School *was* to *begin* at 8:30. He *knew* instantly that he *was* in a dire predicament. Leo *sprang* from his bed, his movements almost *instinctive*. He *put* on his uniform with uncharacteristic speed and *flew* downstairs. He quickly *ate* a piece of toast, barely tasting it. His satchel *had been* prepared the night before. He *took* it and *burst* out the door. He *ran* with a **frantic** intensity, his body *felt* taut with effort. The formidable school gates *were* on the verge of *shutting*. He *made* it, *feeling* utterly drained but undeniably triumphant. He *had learned* a crucial lesson: reliance on a single alarm *could lead* to unforeseen **catastrophe**. He *saw* his classmates already assembled and *knew* this episode *would become* etched in his memory.`,
            level: "C1",
            difficultWords: {"unfiltered":"not altered or treated; direct and intense.","frantic":"feeling or showing a lot of fear and worry; very anxious and agitated.","catastrophe":"an event causing great and often sudden damage or suffering; a disaster."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>





    <!-- Cards from n8n will appear here -->
  </div>
</body>
</html>


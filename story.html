<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Le Storie</title>
</head>
<body>
    <div id="cards-container">
<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 Grandma's Secret Apple Pie </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Grandma's Secret Apple Pie",
            content: `Lily *went* to her grandma's house. "Let's *make* apple pie!" Grandma *said*. Lily *felt* happy in the **cozy** kitchen.
Grandma *gave* Lily red apples. Lily *took* a knife and *cut* them. Grandma *showed* her how to *do* it.
Then they *made* the pie dough. Lily *put* flour and water together. It *became* soft. They *did* it together, laughing.
The pie *went* into the oven. Soon, a sweet **aroma** *began* to *fill* the house. Lily *knew* it *was* good.
After some time, Grandma *took* the pie out. It *was* golden. They *let* it cool.
Later, they *sat* at the table. They *ate* the pie. It *was* delicious. Lily *thought* this **cherished** time *was* very special. She *would keep* this memory always.`,
            level: "A2",
            difficultWords: {"cozy":"comfortable and warm","aroma":"a pleasant, noticeable smell","cherished":"valued highly and loved"}
          },
          b1: {
            title: "Grandma's Secret Apple Pie",
            content: `One sunny afternoon, Lily *went* to her grandma's house. "Shall we *make* my famous apple pie?" Grandma *said*, a **twinkle** in her eye. Lily *felt* excitement *build*.
They *came* to the comfortable kitchen. Grandma *gave* Lily a basket of crisp, red apples. Lily *took* a small paring knife and *began* to *cut* them into neat slices. Grandma *showed* her the special technique, ensuring each slice *was* perfect.
Next, they *made* the rich, flaky pie dough. Lily *put* the ingredients together, carefully *mixing* the flour and butter until it *became* smooth and pliable. They *did* it with practiced ease, their hands working in sync.
The pie *went* into the warm oven. Soon, an irresistible **fragrance** *began* to *fill* every corner of the house, a sweet and spicy scent that *made* Lily eager. Lily *knew* it *would be* perfect.
After a while, Grandma *took* the golden-brown pie out. It *was* beautiful. They *let* it cool on the counter.
Later, they *sat* together, *eating* slices of the warm pie. It *was* incredibly delicious. Lily *thought* this shared **ritual** *was* truly special, a cherished family custom she *would keep* in her heart for years to come.`,
            level: "B1",
            difficultWords: {"twinkle":"a sparkling light in the eye, indicating amusement or liveliness","fragrance":"a pleasant, sweet smell","ritual":"a customary observance or practice"}
          },
          c1: {
            title: "Grandma's Secret Apple Pie",
            content: `A balmy afternoon *found* Lily at her grandmother's quaint abode. "Fancy *making* my legendary apple pie?" Grandma *said*, a benevolent **gleam** in her eyes. Lily *felt* a surge of enthusiastic anticipation.
They *came* to the **hospitable** kitchen, where a comforting warmth *spread* through the air. Grandma *gave* Lily a bounty of crisp, ruby-red apples. Lily *chose* a delicate paring knife and meticulously *began* to *cut* them into uniform slices. Grandma adeptly *showed* her the precise technique, ensuring each segment *was* flawlessly prepared.
Subsequently, they *made* the exquisite, tender pie dough. Lily *put* the meticulously measured ingredients, carefully *bound* the flour and rich butter until the mixture *became* a supple, pliable mass. Their synchronised efforts *made* the task effortless, as if they *knew* the recipe by heart.
The nascent pie *went* into the preheated oven. Before long, an irresistible **perfume** *began* to *rise* through every recess of the dwelling, a complex symphony of sweet and spicy notes that *drew* Lily deeper into the culinary process. Lily intuitively *knew* the outcome *would be* superb.
In due course, Grandma *took* the perfectly golden-brown pie from its fiery chamber. It *was* a true masterpiece. They *let* it cool, the anticipation almost palpable.
Finally, they *sat* together, *eating* generous portions of the still-warm pie. Its flavour *was* profoundly gratifying. Lily *thought* that this shared culinary *endeavour* *was* an invaluable generational bond, a cherished family **legacy** she *would keep* forward, having *learned* so much from this shared experience.`,
            level: "C1",
            difficultWords: {"gleam":"a flash or beam of light; a strong, pleasant emotion","hospitable":"friendly and welcoming to guests or strangers","legacy":"something that is handed down from one generation to the next"}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Wrong Train </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "The Wrong Train",
            content: `Leo *had* a ticket for Brightville. He *went* to the train **platform**. He *saw* a train and *got* on it. He *sat* down and *fell* asleep. When he *woke* up, he *saw* a sign. It *said* "Darkwood." "Oh no!" he *thought*. He *felt* a strong **panic**. This *was* the wrong train! His **destination** *was* Brightville. He *did not know* what to *do*. He *found* a man and *said*, "Where *am* I?" The man *told* him. Leo *took* the next train back. He *was* late but *learned* a lesson: always check the train!`,
            level: "A2",
            difficultWords: {"platform":"An area next to train tracks where people get on and off trains.","panic":"A sudden strong feeling of fear that makes you unable to think or act clearly.","destination":"The place to which someone or something is going or being sent."}
          },
          b1: {
            title: "The Wrong Train",
            content: `Leo *had planned* a trip to Brightville. He *went* to the station, feeling excited. On the correct **platform**, he *saw* a train ready to *depart*. He quickly *bought* a snack and *got* on board, *choosing* a window seat. He *began* to *read* his book, but soon *fell* asleep. He *dreamt* he *was* already in Brightville. When he *woke* up, the train *stood* still. He *looked* out and *felt* **disoriented** as he *read* the station name: Darkwood. He *realized* he *had taken* the wrong train! His heart *sank*. He *knew* he *had made* a serious error. He *got* off and *found* a station agent who *told* him how to **retrace** his journey. It *was* a long trip back, but he *eventually got* to Brightville, albeit late. He *swore* to always double-check his tickets in the future.`,
            level: "B1",
            difficultWords: {"platform":"An area next to train tracks where people get on and off trains.","disoriented":"Confused and not knowing where you are or what direction to go in.","retrace":"To go back over the same path or route."}
          },
          c1: {
            title: "The Wrong Train",
            content: `Leo *had embarked* on a crucial **expedition** to Brightville, *bearing* a meticulously planned itinerary. Arriving at the bustling railway terminus, he *found* his designated platform amidst a slight **commotion**. He *bought* a coffee, *chose* a quiet compartment, and swiftly *settled* in. The rhythmic *sway* of the carriage soon *lulled* him into a deep slumber, where he *dreamt* of successful presentations. He *awoke* abruptly, *feeling* an unsettling stillness. *Casting* his gaze out the window, his heart *began* to pound as he *read* the stark sign: "Darkwood." A cold realization *swept* over him – he *had unequivocally mistaken* his intended service. He *knew* he *had fallen* victim to an **erroneous** choice. He *sprang* up, *felt* a wave of urgency, and *got* off the train. He quickly *sought* assistance from a bewildered conductor who *told* him the necessary steps to *rectify* his blunder. Though the *ensuing* journey *proved* arduous and *cost* him valuable time, Leo *eventually reached* Brightville, profoundly *taught* by his misadventure. He *resolved* to meticulous scrutiny for all future travels.`,
            level: "C1",
            difficultWords: {"expedition":"A journey undertaken by a group of people with a particular purpose, especially of exploration, scientific research, or war.","commotion":"A state of confused and noisy disturbance.","erroneous":"Wrong; incorrect."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>


<!-- ⬇️ One self-contained, appendable card (scoped CSS + JS) -->
<div class="lw-card">
  <style>
    /* ------- Scoped styles: only affect elements inside .lw-card ------- */
    .lw-card { margin: 16px 0; }
    .lw-card * { box-sizing: border-box; }

    .lw-card .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      overflow: hidden;
      animation: lw-slideIn 0.6s ease-out;
      margin: 0 auto;
    }

    @keyframes lw-slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .lw-card .card-header {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .lw-card .card-header h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .lw-card .card-header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .lw-card .card-body { padding: 40px; }

    .lw-card .level-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .lw-card .level-btn {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 15px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .lw-card .level-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .lw-card .level-btn.active {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-color: #0984e3;
    }

    .lw-card .level-btn.facile { border-color: #00b894; }
    .lw-card .level-btn.facile:hover,
    .lw-card .level-btn.facile.active {
      background: linear-gradient(135deg, #00b894, #00a085);
      border-color: #00a085;
    }

    .lw-card .level-btn.medio { border-color: #fdcb6e; }
    .lw-card .level-btn.medio:hover,
    .lw-card .level-btn.medio.active {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      border-color: #e17055;
    }

    .lw-card .level-btn.difficile { border-color: #e84393; }
    .lw-card .level-btn.difficile:hover,
    .lw-card .level-btn.difficile.active {
      background: linear-gradient(135deg, #e84393, #d63384);
      border-color: #d63384;
    }

    .lw-card .level-icon { font-size: 2em; margin-bottom: 10px; }
    .lw-card .level-title { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
    .lw-card .level-description { font-size: 0.9em; opacity: 0.8; }

    .lw-card .story-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-top: 20px;
      min-height: 300px;
      display: none;
      animation: lw-fadeIn 0.5s ease-in;
    }

    .lw-card .story-container.show { display: block; }

    @keyframes lw-fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .lw-card .story-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3436;
    }

    .lw-card .story-content {
      line-height: 1.8;
      font-size: 1.1em;
      color: #636e72;
      text-align: justify;
      margin-bottom: 25px;
    }

    .lw-card .story-level-badge {
      display: inline-block;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .lw-card .highlighted-word {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .lw-card .difficult-words {
      background: #e8f4f8;
      border-left: 4px solid #74b9ff;
      padding: 20px;
      margin-top: 25px;
      border-radius: 8px;
    }

    .lw-card .difficult-words h3 {
      color: #2d3436;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .lw-card .words-list { display: grid; gap: 10px; }

    .lw-card .word-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95em;
    }

    .lw-card .word-item strong { color: #0984e3; }

    .lw-card .no-story {
      text-align: center;
      color: #74b9ff;
      font-style: italic;
      font-size: 1.2em;
      padding: 60px 20px;
    }
  </style>

  <div class="card">
    <div class="card-header">
      <h1>📚 The Late Start </h1>
      <p>Seleziona il livello di difficoltà più adatto a te</p>
    </div>

    <div class="card-body">
      <div class="level-buttons">
        <button class="level-btn facile lw-level-btn" data-level="a2">
          <div class="level-icon">🌱</div>
          <div class="level-title">A2 - Facile</div>
          <div class="level-description">Livello base</div>
        </button>

        <button class="level-btn medio lw-level-btn" data-level="b1">
          <div class="level-icon">🌿</div>
          <div class="level-title">B1 - Intermedio</div>
          <div class="level-description">Livello medio</div>
        </button>

        <button class="level-btn difficile lw-level-btn" data-level="c1">
          <div class="level-icon">🌳</div>
          <div class="level-title">C1 - Avanzato</div>
          <div class="level-description">Livello difficile</div>
        </button>
      </div>

      <div class="story-container lw-story-container">
        <div class="no-story">Seleziona un livello per leggere la storia</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Scope everything to THIS card only
      const root = document.currentScript.closest('.lw-card');

      // ---- Stories data injected by n8n ----
      const storiesData = {
          a2: {
            title: "Leo's Big Rush",
            content: `Leo *did not hear* his alarm. He *slept* very well. Suddenly, he *woke* up. The sun *was* bright. He *saw* the clock. "Oh no!" he *thought*. It *was* 8:00 AM! School *began* at 8:30. He *had* to *go* fast. Leo *got* out of bed quickly. He *put* on his uniform. He *ran* to the kitchen. He *ate* a piece of toast. His bag *was* already ready. He *took* his bag and *went* out the door. He *ran* all the way to school. The school gate *was* almost shut. He *made* it! He *felt* **tired** but happy. He *learned* his lesson: always *set* your alarm! He *saw* his friends inside. It *was* a **busy** morning. He *knew* he *would* not *forget* this day. He *was* lucky not to be **absent**.`,
            level: "A2",
            difficultWords: {"tired":"feeling like you need to rest or sleep.","busy":"having a lot of things to do.","absent":"not present; not at a place you should be."}
          },
          b1: {
            title: "The Morning Scramble",
            content: `Leo *didn't hear* his alarm. He *slept* soundly, enjoying a deep slumber. Suddenly, his eyes *flew* open. The sunlight *shone* brightly through his window, unusually strong for a school day. He *saw* the clock on his bedside table. "Oh no!" he *thought*, his heart *began* to *beat* fast. It *was* 8:00 AM! School *began* at 8:30. He *knew* he *had* to *get* moving. Leo *got* out of bed with a **jolt**. He *put* on his uniform in record time and *ran* downstairs. He quickly *ate* a piece of toast, barely tasting it. His backpack *was* already packed. He *took* it and *flew* out the door. He *ran* as fast as he *could*, his lungs *burned*. The school gate *was* just closing. He *made* it, *feeling* **exhausted** but relieved. He *learned* a valuable lesson: never trust your alarm's snooze button alone! He *saw* his friends waiting and *knew* he *would* never *forget* this **chaotic** morning.`,
            level: "B1",
            difficultWords: {"jolt":"a sudden, strong, and unpleasant movement or shock.","exhausted":"extremely tired.","chaotic":"in a state of complete confusion and disorder."}
          },
          c1: {
            title: "A Disorienting Dawn",
            content: `Leo *did not awake* to his alarm's persistent chime. He *had slept* profoundly, a deep, undisturbed repose that *felt* almost blissful. Abruptly, his eyes *flung* open. A stark, **unfiltered** brilliance *shone* through his window, an intensity that immediately *struck* him as unusual. He *saw* the digital display on his nightstand. "Good heavens!" he *thought*, a surge of adrenaline *swept* through him. It *read* 8:00 AM! School *was* to *begin* at 8:30. He *knew* instantly that he *was* in a dire predicament. Leo *sprang* from his bed, his movements almost *instinctive*. He *put* on his uniform with uncharacteristic speed and *flew* downstairs. He quickly *ate* a piece of toast, barely tasting it. His satchel *had been* prepared the night before. He *took* it and *burst* out the door. He *ran* with a **frantic** intensity, his body *felt* taut with effort. The formidable school gates *were* on the verge of *shutting*. He *made* it, *feeling* utterly drained but undeniably triumphant. He *had learned* a crucial lesson: reliance on a single alarm *could lead* to unforeseen **catastrophe**. He *saw* his classmates already assembled and *knew* this episode *would become* etched in his memory.`,
            level: "C1",
            difficultWords: {"unfiltered":"not altered or treated; direct and intense.","frantic":"feeling or showing a lot of fear and worry; very anxious and agitated.","catastrophe":"an event causing great and often sudden damage or suffering; a disaster."}
          }
        };

      // ---- Helpers (scoped) ----
      function formatStoryText(text) {
        // **bold** -> <strong class="highlighted-word">bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="highlighted-word">$1</strong>');
        // *italic* -> <em>italic</em>
        return text.replace(/\*(.*?)\*/g, '<em>$1</em>');
      }

      function showStory(level) {
        const container = root.querySelector('.lw-story-container');
        const story = storiesData[level];
        if (!container || !story) return;

      let difficultWordsHtml = '';
      if (story.difficultWords) {
        // Se è una stringa JSON, trasformala in oggetto
        let difficultWordsObj = story.difficultWords;
        if (typeof difficultWordsObj === 'string') {
          try {
            difficultWordsObj = JSON.parse(difficultWordsObj);
          } catch (err) {
            console.error('Errore parsing difficultWords:', err);
            difficultWordsObj = {};
          }
        }
      
        if (Object.keys(difficultWordsObj).length > 0) {
          difficultWordsHtml = `
            <div class="difficult-words">
              <h3>📚 Parole Difficili:</h3>
              <div class="words-list">
                ${Object.entries(difficultWordsObj).map(([word, definition]) =>
                  `<div class="word-item"><strong>${word}</strong>: ${definition}</div>`
                ).join('')}
              </div>
            </div>
          `;
        }
      }


        container.innerHTML = `
          <div class="story-title">${story.title}</div>
          <div class="story-level-badge">Livello ${story.level}</div>
          <div class="story-content">${formatStoryText(story.content)}</div>
          ${difficultWordsHtml}
        `;
        container.classList.add('show');
      }

      // ---- Bind buttons inside this card only ----
      root.querySelectorAll('.lw-level-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('.lw-level-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          showStory(btn.getAttribute('data-level'));
        });
      });
    })();
  </script>
</div>





    <!-- Cards from n8n will appear here -->
  </div>
</body>
</html>


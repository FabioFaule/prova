<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <meta name="description" content="Impara i verbi irregolari inglesi con giochi interattivi. Studio, allenamento e test per migliorare il tuo inglese divertendoti. Prova gratis!">

    <meta name="keywords" content="verbi irregolari inglesi, esercizi verbi irregolari inglese traduzione, irregular verbs tabella">
    <meta name="author" content="Learning With Me Team">
    <meta name="robots" content="index, follow">
    <meta property="og:url" content="https://learnwithme.work/test.html">
    <meta property="og:title" content="Learning Games - Impara i Verbi Irregolari Inglesi">


    <link rel="canonical" href="https://learnwithme.work/test.html">

    <script>
        if (location.hostname === "learnwithme.work") {
            var ads = document.createElement("script");
            ads.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8624143381240320";
            ads.setAttribute("crossorigin", "anonymous");
            ads.async = true;
            document.head.appendChild(ads);
        }
    </script>
    <title>Irregular Verbs Trainer</title>
    <style>
        /* Reset e variabili CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #ffffff;
            --primary-hover: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --background: #f8fafc;
            --surface: #ffffff;
            --surface-hover: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #222f3f;
            --border-color: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius: 8px;
            --radius-lg: 12px;--gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-hero: linear-gradient(135deg, #601d26 0%, #920c1e 30%, #C2152B 70%, #76121f 100%);
            --nav-bg: #ffffff;
            --nav-text: #1a365d;
            --nav-hover-bg: #f1f5f9;
            --nav-border: #e2e8f0;
            --text-secondary-header: #222f3f;
            --cards-bg: #f8fafc;
            --card-bg: #ffffff;
            --card-text: #0f172a;
            --card-text-secondary: #475569;
            --footer-bg: transparent;
            --footer-text: #475569;
        }

        /* Dark theme variables */
        [data-theme="dark"] {
            --nav-bg: #1e293b;
            --nav-text: #ffffff;
            --nav-hover-bg: #334155;
            --nav-border: #334155;
            
            --cards-bg: #0f172a;
            --card-bg: #1e293b;
            --card-text: #ffffff;
            --card-text-secondary: #cbd5e1;
            --footer-bg: #0f172a;
            --footer-text: #ffffff;
            
            /* Override delle variabili esistenti per dark mode */
            --background: #0f172a;
            --surface: #1e293b;
            --surface-hover: #334155;   
            --text-primary: #ffffff;
            --text-secondary: #cbd5e1;
            --border-color: #334155;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 80px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Navigation */
        nav {
            background: var(--nav-bg);
            border-bottom: 1px solid var(--nav-border);
            transition: background-color 0.3s ease, border-color 0.3s ease;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .nav-links {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 12px 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--nav-text);
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: var(--radius);
            min-width: 60px;
        }

        .nav-item:hover {
            color: var(--primary-color);
            background: var(--nav-hover-bg);
        }

        .nav-item img {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }

        .nav-item span {
            font-size: 12px;
            font-weight: 500;
        }

        /* Container principale */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 16px;
            background-color: var(--surface);
            transition: background-color 0.3s ease;
        }

/* Game Header */
        .game-header {
            background: var(--gradient-hero);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 24px;
            margin-bottom: 20px;
            text-align: center;
            z-index: 1;
            position: relative;
        }

        .game-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="a" cx="0.5" cy="0.5" r="0.8"><stop offset="0%" stop-color="rgba(255,255,255,0.35)"/><stop offset="100%" stop-color="rgba(255,255,255,0)"/></radialGradient></defs><circle cx="220" cy="220" r="200" fill="url(%23a)"/><circle cx="800" cy="300" r="150" fill="url(%23a)"/><circle cx="600" cy="700" r="250" fill="url(%23a)"/><circle cx="400" cy="500" r="120" fill="url(%23a)"/><circle cx="900" cy="800" r="100" fill="url(%23a)"/></svg>') no-repeat center center;
            background-size: cover;
            opacity: 0.5;
            pointer-events: none;
            z-index: 0;
        }

        .game-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #ffffff 0%, #f5f7f9 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .game-subtitle {
            font-size: 16px;
            color: var(--text-secondary-header);
            margin-bottom: 24px;
            font-weight: 700;
        }

        .game-instructions {
            font-size: 14px;
            color: var(--text-secondary-header);
            background: rgb(37 99 235 / 0.1);
            padding: 12px;
            border-radius: var(--radius);
            margin-bottom: 16px;
        }


        /* Settings Panel */
        .settings-panel {
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 24px;
            margin-bottom: 20px;
        }

        .settings-panel.hidden {
            display: none;
        }

        .settings-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 16px;
            background: var(--surface);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
        }

        .form-select:hover, .form-select:focus-visible {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgb(100 116 139 / 0.1); /* opzionale: ombra soft in tinta secondary */
        }

        .btn-primary {
            width: 100%;
            background: var(--gradient-hero);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 8px;
        }

        .btn-primary:hover {
            background: #601d26;
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        /* Control Panel */
        .control-panel {
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            padding: 16px;
            margin-bottom: 20px;
            position: sticky;
            top: 80px;
            z-index: 50;
        }

        .control-panel.hidden {
            display: none;
        }

        .control-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 12px;
            justify-content: center;
        }

        .timer {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
            padding: 8px 16px;
            background: rgba(44, 75, 141, 0.3);
            border-radius: var(--radius);
            min-width: 120px;
            text-align: center;
        }

        .timer.warning {
            color: var(--warning-color);
            background: rgb(245 158 11 / 0.1);
        }

        .timer.danger {
            color: var(--error-color);
            background: rgb(239 68 68 / 0.1);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .score {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            padding: 8px 16px;
            background: var(--surface-hover);
            border-radius: var(--radius);
        }

        .btn-control {
            padding: 10px 16px;
            border: none;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-check {
            background: var(--success-color);
            color: white;
        }

        .btn-check:hover {
            background: #059669;
        }

        .btn-pause {
            background: var(--warning-color);
            color: white;
        }

        .btn-pause:hover {
            background: #d97706;
        }

        .btn-give-up {
            background: var(--error-color);
            color: white;
        }

        .btn-give-up:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn-control:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        /* Add these CSS rules to enhance the styling */

        /* Make sure navigation buttons are properly styled */
        #restart-level {
            background: #3fa4b9cc;
            color: white;
        }

        #restart-level:hover {
            background: var(--primary-hover);
        }

        #back-to-settings {
            background: #95aac5e4;
            color: white;
        }

        #back-to-settings:hover {
            background: var(--primary-hover);
        }


        /* Test Table */
        .test-container {
            background: var(--surface);
            transition: background-color 0.3s ease;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .test-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid var(--border-color);
        }

        .test-table th {
            background: #920c1e;
            color: white;
            padding: 16px 12px;
            font-weight: 800;
            font-size: 14px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .test-table td {
            padding: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
            vertical-align: middle;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .test-table tr:nth-child(even) {
            background: var(--surface-hover);
            transition: background-color 0.3s ease;
        }

        .verb-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 16px;
            text-align: center;
            background: var(--surface);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .verb-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
        }

        .verb-input.correct {
            border-color: var(--success-color);
            background: rgb(16 185 129 / 0.1);
            color: var(--success-color);
        }

        .verb-input.wrong {
            border-color: var(--error-color);
            background: rgb(239 68 68 / 0.1);
            color: var(--error-color);
        }

        .verb-input.revealed {
            background: #de8d2a;
            color: var(--text-secondary);
        }

        .given-word {
            font-weight: 600;
            color: var(--text-primary);
            background: rgb(37 99 235 / 0.05);
            padding: 10px 12px;
            border-radius: var(--radius);
            border: 2px solid rgb(37 99 235 / 0.2);
        }

        /* Modal per messaggi */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 32px 24px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            max-width: 400px;
            width: 100%;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .modal-text {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .modal.error .modal-title {
            color: var(--error-color);
        }

        .modal.success .modal-title {
            color: var(--success-color);
        }

        .modal.warning .modal-title {
            color: var(--warning-color);
        }
        /* ...existing code... */
        .main-actions {
            display: flex;
            flex-direction: row;
            gap: 8px;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        /* Footer con supporto tema */
        footer {
            background: var(--footer-bg);
            color: var(--footer-text);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        footer a {
            color: var(--footer-text);
            transition: color 0.3s ease;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--nav-hover-bg);
            border: 1px solid var(--nav-border);
            border-radius: var(--radius);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--nav-text);
            font-size: 16px;
            z-index: 10;
        }

        .theme-toggle:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .theme-toggle:active {
            transform: translateY(-50%) scale(0.95);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container {
                padding: 8px 6px;
            }

            .game-title{
                font-size: 2.25rem;
                margin: 0 0 12px;
            }

            .game-subtitle {
                font-size: 12px;
                margin-bottom: 6px;
            }

            .settings-panel, .control-panel, .test-container {
                margin-bottom: 5px;
                top: 65px;
                padding: 6px;
                }

            .control-row {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .control-row > * {
                width: 100%;
                text-align: center;
                justify-content: center;
            }

            .timer {
                order: -1;
                font-size: 15px;
                padding: 5px;
            }
            .score {
                font-size: 12px;
                padding: 5px;
            }
            .btn-control {
                font-size: 14px;
                padding: 5px;
            }
            .btn-give-up, .btn-pause, .btn-check {
               
                font-size: 12px;
                padding: 3px;
                /* center horizontally */
                width: 100%;
                align-items: center;
                justify-content: center;
                text-align: center;
            }

            #restart-level, #back-to-settings {
                font-size: 12px;
                padding: 8px 12px;
                flex: 1 1 0;
                min-width: 0;
                background-color: var(--secondary-color);
            }

            .main-actions {
                flex-direction: row;
                width: 100%;
                justify-content: center;
                gap: 4px;
            }
            .main-actions .btn-control {
                flex: 1 1 0;
                min-width: 0;
                padding: 3px;
                font-size: 12px;
            }
           

            .test-table th,
            .test-table td {
                padding: 8px 4px;
                font-size: 14px;
            }

            .test-table th {
                font-size: 12px;
            }

            .verb-input {
                font-size: 16px;
                padding: 8px;
            }

            .nav-item span {
                font-size: 11px;
            }
           
            .nav-links {
                padding-right: 50px;
                padding: 0 0;
            }

            .theme-toggle {
            width: 32px;
            height: 32px;
            right: 8px;
            font-size: 14px;
            }
           
            .main-actions {
                flex-wrap: wrap;
                gap: 4px;
            }
           
            .main-actions .btn-control {
                flex: 1 1 calc(50% - 2px);
                min-width: 0;
            }
        }

        @media (max-width: 480px) {
            .test-table {
                font-size: 12px;
            }

            .test-table th {
                padding: 12px 2px;
                font-size: 11px;
            }

            .test-table td {
                padding: 8px 2px;
            }

            .verb-input {
                padding: 6px 4px;
                font-size: 14px;
            }

            .given-word {
                padding: 6px 4px;
                font-size: 14px;
            }
            
            .nav-links {
                /* Ulteriore riduzione per schermi molto piccoli */
                padding-right: 45px;
                padding-top: 8px;
                padding-bottom: 8px;
            }
            
            .nav-item {
                padding: 4px 6px;
                min-width: 45px;
            }
            
            .nav-item img {
                width: 20px;
                height: 20px;
            }
            
            .nav-item span {
                font-size: 9px;
            }
            
            .theme-toggle {
                width: 28px;
                height: 28px;
                right: 6px;
                font-size: 12px;
            }
        }

        /* Utilities */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-out {
            animation: fadeOut 2s ease-in-out 2s forwards;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="nav-links">
                <a href="index.html" class="nav-item">
                    <img src="images/home.png" alt="Home">
                    <span>Home</span>
                </a>
                <a href="study_area.html" class="nav-item">
                    <img src="images/learn.png" alt="Learn">
                    <span>Learn</span>
                </a>
                <a href="train.html" class="nav-item">
                    <img src="images/train.png" alt="Train">
                    <span>Train</span>
                </a>
                <a href="test.html" class="nav-item">
                    <img src="images/test.png" alt="Test">
                    <span>Test</span>
                </a>
                <a href="stories/story.html" class="nav-item">
                    <img src="images/story.png" alt="Stories">
                    <span>Stories</span>
                </a>
            </div>
            <button class="theme-toggle" id="theme-toggle" title="Cambia tema">
                <span id="theme-icon">üåô</span>
            </button>
        </div>
    </nav>

    <div class="main-container">
        <div class="game-header" id="game-header">
        <h1 class="game-title">Irregular Verbs Test</h1>
        <p class="game-subtitle">Fill in the gaps and test your competences</p>
        <div class="game-instructions">
        üí° Choose your settings, then complete the missing verb forms. Good luck!
        </div>
    </div>
        <!-- Settings Panel -->
        <div id="settings-panel" class="settings-panel">
            <h2 class="settings-title">‚öôÔ∏è Test Settings</h2>
           
            <div class="form-group">
                <label for="difficulty" class="form-label">üéØ Difficulty Level</label>
                <select id="difficulty" class="form-select">
                    <option value="easy">Easy (A2) - Ket Exam</option>
                    <option value="medium">Medium (B1) - Pet Exam</option>
                    <option value="hard">Hard (B2/C1) - First Exam</option>
                </select>
            </div>

            <div class="form-group">
                <label for="time" class="form-label">‚è∞ Test Duration</label>
                <select id="time" class="form-select">
                    <option value="1">1 minute</option>
                    <option value="15">15 minutes</option>
                    <option value="30">30 minutes</option>
                    <option value="60">60 minutes</option>
                </select>
            </div>

            <div class="form-group">
                <label for="numberOfVerbs" class="form-label">üìù Number of Verbs</label>
                <select id="numberOfVerbs" class="form-select">
                    <option value="5">5 verbs</option>
                    <option value="10">10 verbs</option>
                    <option value="15">15 verbs</option>
                    <option value="20">20 verbs</option>
                    <option value="50">50 verbs</option>
                </select>
            </div>

            <button onclick="applySettings()" class="btn-primary">
                üöÄ Start the Test
            </button>
        </div>

        <!-- Control Panel -->
        <div id="control-panel" class="control-panel hidden">
            <div class="control-row">
                <div id="timer" class="timer">0s</div>
                <div id="score" class="score">Score: 0/10</div>
                <div class="main-actions">
                    <button id="toggle-timer" onclick="toggleTimer()" class="btn-control btn-pause">
                        ‚è∏Ô∏è Pause
                    </button>
                    <button id="check-answers" onclick="checkAnswers()" class="btn-control btn-check">
                        ‚úÖ Check
                    </button>
                    <button id="give-up" onclick="giveUp()" class="btn-control btn-give-up">
                        üòì Give Up
                    </button>
                    <!-- Add these buttons inside the control-row div, after the existing buttons -->
                    <button id="restart-level" onclick="restartLevel()" class="btn-control hidden">
                        üîÑ Restart Level
                    </button>
                    <button id="back-to-settings" onclick="backToSettings()" class="btn-control hidden">
                        ‚öôÔ∏è Back to Settings
                    </button>
                </div>
            </div>
        </div>

        <!-- Test Table -->
        <div id="test-container" class="test-container">
            <div id="test"></div>
        </div>
    </div>

    <!-- Modal per messaggi -->
    <div id="message-modal" class="modal hidden">
        <div class="modal-content">
            <h3 id="modal-title" class="modal-title"></h3>
            <p id="modal-text" class="modal-text"></p>
        </div>
    </div>

    <script>
        // Add this variable at the top with other global variables
        let randomColumnIndex = 0;
        let isFirstTime = true;
        let selectedVerbs = [];
        let score = 0;
        let isTimerRunning = true;
        let stopwatchInterval;
        let elapsedTime = 0;
        let maxTime;

        const verbs = [
 { "Translation": "svegliarsi", "Base Form": "awake", "Simple Past": "awoke", "Past Participle": "awoken" },
 { "Translation": "essere", "Base Form": "be", "Simple Past": "was - were", "Past Participle": "been" },
 { "Translation": "sopportare / sostenere", "Base Form": "bear", "Simple Past": "bore", "Past Participle": "borne" },
 { "Translation": "battere / sconfiggere", "Base Form": "beat", "Simple Past": "beat", "Past Participle": "beaten" },
 { "Translation": "diventare", "Base Form": "become", "Simple Past": "became", "Past Participle": "become" },
 { "Translation": "iniziare / cominciare", "Base Form": "begin", "Simple Past": "began", "Past Participle": "begun" },
 { "Translation": "piegare", "Base Form": "bend", "Simple Past": "bent", "Past Participle": "bent" },
 { "Translation": "scommettere", "Base Form": "bet", "Simple Past": "bet", "Past Participle": "bet" },
 { "Translation": "fare un'offerta", "Base Form": "bid", "Simple Past": "bid", "Past Participle": "bid" },
 { "Translation": "legare / bendare", "Base Form": "bind", "Simple Past": "bound", "Past Participle": "bound" },
 { "Translation": "mordere", "Base Form": "bite", "Simple Past": "bit", "Past Participle": "bitten" },
 { "Translation": "sanguinare", "Base Form": "bleed", "Simple Past": "bled", "Past Participle": "bled" },
 { "Translation": "soffiare", "Base Form": "blow", "Simple Past": "blew", "Past Participle": "blown" },
 { "Translation": "rompere", "Base Form": "break", "Simple Past": "broke", "Past Participle": "broken" },
 { "Translation": "allevare", "Base Form": "breed", "Simple Past": "bred", "Past Participle": "bred" },
 { "Translation": "portare", "Base Form": "bring", "Simple Past": "brought", "Past Participle": "brought" },
 { "Translation": "trasmettere", "Base Form": "broadcast", "Simple Past": "broadcast", "Past Participle": "broadcast" },
 { "Translation": "costruire", "Base Form": "build", "Simple Past": "built", "Past Participle": "built" },
 { "Translation": "bruciare", "Base Form": "burn", "Simple Past": "burned / burnt", "Past Participle": "burned / burnt" },
 { "Translation": "esplodere", "Base Form": "burst", "Simple Past": "burst", "Past Participle": "burst" },
 { "Translation": "comprare", "Base Form": "buy", "Simple Past": "bought", "Past Participle": "bought" },
 { "Translation": "gettare", "Base Form": "cast", "Simple Past": "cast", "Past Participle": "cast" },
 { "Translation": "prendere / afferrare", "Base Form": "catch", "Simple Past": "caught", "Past Participle": "caught" },
 { "Translation": "scegliere", "Base Form": "choose", "Simple Past": "chose", "Past Participle": "chosen" },
 { "Translation": "attaccarsi", "Base Form": "cling", "Simple Past": "clung", "Past Participle": "clung" },
 { "Translation": "venire", "Base Form": "come", "Simple Past": "came", "Past Participle": "come" },
 { "Translation": "costare", "Base Form": "cost", "Simple Past": "cost", "Past Participle": "cost" },
 { "Translation": "strisciare", "Base Form": "creep", "Simple Past": "crept", "Past Participle": "crept" },
 { "Translation": "tagliare", "Base Form": "cut", "Simple Past": "cut", "Past Participle": "cut" },
 { "Translation": "distribuire le carte", "Base Form": "deal", "Simple Past": "dealt", "Past Participle": "dealt" },
 { "Translation": "scavare", "Base Form": "dig", "Simple Past": "dug", "Past Participle": "dug" },
 { "Translation": "tuffarsi / immergersi", "Base Form": "dive", "Simple Past": "dived / dove", "Past Participle": "dived" },
 { "Translation": "fare/ agire", "Base Form": "do", "Simple Past": "did", "Past Participle": "done" },
 { "Translation": "disegnare", "Base Form": "draw", "Simple Past": "drew", "Past Participle": "drawn" },
 { "Translation": "sognare", "Base Form": "dream", "Simple Past": "dreamed / dreamt", "Past Participle": "dreamed / dreamt" },
 { "Translation": "bere", "Base Form": "drink", "Simple Past": "drank", "Past Participle": "drunk" },
 { "Translation": "guidare", "Base Form": "drive", "Simple Past": "drove", "Past Participle": "driven" },
 { "Translation": "mangiare", "Base Form": "eat", "Simple Past": "ate", "Past Participle": "eaten" },
 { "Translation": "cadere", "Base Form": "fall", "Simple Past": "fell", "Past Participle": "fallen" },
 { "Translation": "nutrire", "Base Form": "feed", "Simple Past": "fed", "Past Participle": "fed" },
 { "Translation": "sentire", "Base Form": "feel", "Simple Past": "felt", "Past Participle": "felt" },
 { "Translation": "combattere / lottare", "Base Form": "fight", "Simple Past": "fought", "Past Participle": "fought" },
 { "Translation": "trovare / scoprire", "Base Form": "find", "Simple Past": "found", "Past Participle": "found" },
 { "Translation": "calzare / addattarsi", "Base Form": "fit", "Simple Past": "fitted / fit", "Past Participle": "fitted / fit" },
 { "Translation": "fuggire", "Base Form": "flee", "Simple Past": "fled", "Past Participle": "fled" },
 { "Translation": "scagliare / lanciare", "Base Form": "fling", "Simple Past": "flung", "Past Participle": "flung" },
 { "Translation": "volare", "Base Form": "fly", "Simple Past": "flew", "Past Participle": "flown" },
 { "Translation": "proibire / vietare", "Base Form": "forbid", "Simple Past": "forbade", "Past Participle": "forbidden" },
 { "Translation": "dimenticare", "Base Form": "forget", "Simple Past": "forgot", "Past Participle": "forgotten" },
 { "Translation": "perdonare", "Base Form": "forgive", "Simple Past": "forgave", "Past Participle": "forgiven" },
 { "Translation": "abbandonare", "Base Form": "forsake", "Simple Past": "forsook", "Past Participle": "forsaken" },
 { "Translation": "congelare / gelare", "Base Form": "freeze", "Simple Past": "froze", "Past Participle": "frozen" },
 { "Translation": "ricevere / ottenere", "Base Form": "get", "Simple Past": "got", "Past Participle": "got / gotten" },
 { "Translation": "dare", "Base Form": "give", "Simple Past": "gave", "Past Participle": "given" },
 { "Translation": "andare", "Base Form": "go", "Simple Past": "went", "Past Participle": "gone" },
 { "Translation": "macinare", "Base Form": "grind", "Simple Past": "ground", "Past Participle": "ground" },
 { "Translation": "crescere / coltivare", "Base Form": "grow", "Simple Past": "grew", "Past Participle": "grown" },
 { "Translation": "avere", "Base Form": "have", "Simple Past": "had", "Past Participle": "had" },
 { "Translation": "appendere", "Base Form": "hang", "Simple Past": "hung", "Past Participle": "hung" },
 { "Translation": "sentire / udire", "Base Form": "hear", "Simple Past": "heard", "Past Participle": "heard" },
 { "Translation": "nascondere", "Base Form": "hide", "Simple Past": "hid", "Past Participle": "hidden" },
 { "Translation": "colpire", "Base Form": "hit", "Simple Past": "hit", "Past Participle": "hit" },
 { "Translation": "stringere / tenere", "Base Form": "hold", "Simple Past": "held", "Past Participle": "held" },
 { "Translation": "far male / ferire", "Base Form": "hurt", "Simple Past": "hurt", "Past Participle": "hurt" },
 { "Translation": "tenere / mantenere", "Base Form": "keep", "Simple Past": "kept", "Past Participle": "kept" },
 { "Translation": "inginocchiarsi", "Base Form": "kneel", "Simple Past": "knelt / kneeled", "Past Participle": "knelt / kneeled" },
 { "Translation": "sapere / conoscere", "Base Form": "know", "Simple Past": "knew", "Past Participle": "known" },
 { "Translation": "stendere", "Base Form": "lay", "Simple Past": "laid", "Past Participle": "laid" },
 { "Translation": "guidare / condurre", "Base Form": "lead", "Simple Past": "led", "Past Participle": "led" },
 { "Translation": "imparare", "Base Form": "learn", "Simple Past": "learned / learnt", "Past Participle": "learned / learnt" },
 { "Translation": "lasciare / partire", "Base Form": "leave", "Simple Past": "left", "Past Participle": "left" },
 { "Translation": "prestare", "Base Form": "lend", "Simple Past": "lent", "Past Participle": "lent" },
 { "Translation": "permettere / lasciare", "Base Form": "let", "Simple Past": "let", "Past Participle": "let" },
 { "Translation": "essere sdraiato", "Base Form": "lie", "Simple Past": "lay", "Past Participle": "lain" },
 { "Translation": "accendere / illuminare", "Base Form": "light", "Simple Past": "lit / lighted", "Past Participle": "lit / lighted" },
 { "Translation": "perdere", "Base Form": "lose", "Simple Past": "lost", "Past Participle": "lost" },
 { "Translation": "fare /fabbricare", "Base Form": "make", "Simple Past": "made", "Past Participle": "made" },
 { "Translation": "significare / intendere", "Base Form": "mean", "Simple Past": "meant", "Past Participle": "meant" },
 { "Translation": "incontrare / incontrarsi", "Base Form": "meet", "Simple Past": "met", "Past Participle": "met" },
 { "Translation": "sbagliare a scrivere", "Base Form": "misspell", "Simple Past": "misspelt / misspelled", "Past Participle": "misspelt / misspelled" },
 { "Translation": "sbagliare", "Base Form": "mistake", "Simple Past": "mistook", "Past Participle": "mistaken" },
 { "Translation": "dominare", "Base Form": "overcome", "Simple Past": "overcame", "Past Participle": "overcome" },
 { "Translation": "sorpassare", "Base Form": "overtake", "Simple Past": "overtook", "Past Participle": "overtaken" },
 { "Translation": "pagare", "Base Form": "pay", "Simple Past": "paid", "Past Participle": "paid" },
 { "Translation": "dichiararsi", "Base Form": "plead", "Simple Past": "pleaded / pled", "Past Participle": "pleaded / pled" },
 { "Translation": "provare", "Base Form": "prove", "Simple Past": "proved", "Past Participle": "proved / proven" },
 { "Translation": "mettere", "Base Form": "put", "Simple Past": "put", "Past Participle": "put" },
 { "Translation": "smettere / abbandonare", "Base Form": "quit", "Simple Past": "quit", "Past Participle": "quit" },
 { "Translation": "leggere", "Base Form": "read", "Simple Past": "read", "Past Participle": "read" },
 { "Translation": "cavalcare", "Base Form": "ride", "Simple Past": "rode", "Past Participle": "ridden" },
 { "Translation": "squillare", "Base Form": "ring", "Simple Past": "rang", "Past Participle": "rung" },
 { "Translation": "aumentare / sorgere", "Base Form": "rise", "Simple Past": "rose", "Past Participle": "risen" },
 { "Translation": "correre", "Base Form": "run", "Simple Past": "ran", "Past Participle": "run" },
 { "Translation": "dire", "Base Form": "say", "Simple Past": "said", "Past Participle": "said" },
 { "Translation": "vedere", "Base Form": "see", "Simple Past": "saw", "Past Participle": "seen" },
 { "Translation": "cercare", "Base Form": "seek", "Simple Past": "sought", "Past Participle": "sought" },
 { "Translation": "vendere", "Base Form": "sell", "Simple Past": "sold", "Past Participle": "sold" },
 { "Translation": "mandare / spedire", "Base Form": "send", "Simple Past": "sent", "Past Participle": "sent" },
 { "Translation": "impostare / mettere", "Base Form": "set", "Simple Past": "set", "Past Participle": "set" },
 { "Translation": "cucire", "Base Form": "sew", "Simple Past": "sewed", "Past Participle": "sewed / sewn" },
 { "Translation": "agitare / scuotere", "Base Form": "shake", "Simple Past": "shook", "Past Participle": "shaken" },
 { "Translation": "brillare / risplendere", "Base Form": "shine", "Simple Past": "shone", "Past Participle": "shone" },
 { "Translation": "ferrare", "Base Form": "shoe", "Simple Past": "shod", "Past Participle": "shod" },
 { "Translation": "sparare", "Base Form": "shoot", "Simple Past": "shot", "Past Participle": "shot" },
 { "Translation": "mostrare / esibire", "Base Form": "show", "Simple Past": "showed", "Past Participle": "shown" },
 { "Translation": "restringersi", "Base Form": "shrink", "Simple Past": "shrank", "Past Participle": "shrunk" },
 { "Translation": "chiudere", "Base Form": "shut", "Simple Past": "shut", "Past Participle": "shut" },
 { "Translation": "cantare", "Base Form": "sing", "Simple Past": "sang", "Past Participle": "sung" },
 { "Translation": "affondare", "Base Form": "sink", "Simple Past": "sank", "Past Participle": "sunk" },
 { "Translation": "sedersi / sedere", "Base Form": "sit", "Simple Past": "sat", "Past Participle": "sat" },
 { "Translation": "dormire", "Base Form": "sleep", "Simple Past": "slept", "Past Participle": "slept" },
 { "Translation": "odorare / annusare", "Base Form": "smell", "Simple Past": "smelled / smelt", "Past Participle": "smelled / smelt" },
 { "Translation": "scorrere / scivolare", "Base Form": "slide", "Simple Past": "slid", "Past Participle": "slid" },
 { "Translation": "parlare", "Base Form": "speak", "Simple Past": "spoke", "Past Participle": "spoken" },
 { "Translation": "andare veloce / accelerare", "Base Form": "speed", "Simple Past": "sped", "Past Participle": "sped" },
 { "Translation": "sillabare", "Base Form": "spell", "Simple Past": "spelled / spelt", "Past Participle": "spelled / spelt" },
 { "Translation": "spendere", "Base Form": "spend", "Simple Past": "spent", "Past Participle": "spent" },
 { "Translation": "versare / rovesciare", "Base Form": "spill", "Simple Past": "spilt / spilled", "Past Participle": "spilt / spilled" },
 { "Translation": "sputare", "Base Form": "spit", "Simple Past": "spat", "Past Participle": "spat" },
 { "Translation": "rovinare / viziare", "Base Form": "spoil", "Simple Past": "spoilt / spoiled", "Past Participle": "spoilt/spoiled" },
 { "Translation": "diffondere", "Base Form": "spread", "Simple Past": "spread", "Past Participle": "spread" },
 { "Translation": "saltare", "Base Form": "spring", "Simple Past": "sprang", "Past Participle": "sprung" },
 { "Translation": "alzarsi / stare in piedi", "Base Form": "stand", "Simple Past": "stood", "Past Participle": "stood" },
 { "Translation": "rubare", "Base Form": "steal", "Simple Past": "stole", "Past Participle": "stolen" },
 { "Translation": "incollare", "Base Form": "stick", "Simple Past": "stuck", "Past Participle": "stuck" },
 { "Translation": "pungere", "Base Form": "sting", "Simple Past": "stung", "Past Participle": "stung" },
 { "Translation": "puzzare", "Base Form": "stink", "Simple Past": "stank", "Past Participle": "stunk" },
 { "Translation": "colpire / battere", "Base Form": "strike", "Simple Past": "struck", "Past Participle": "struck" },
 { "Translation": "giurare", "Base Form": "swear", "Simple Past": "swore", "Past Participle": "sworn" },
 { "Translation": "spazzare", "Base Form": "sweep", "Simple Past": "swept / sweeped", "Past Participle": "swept / sweeped" },
 { "Translation": "nuotare", "Base Form": "swim", "Simple Past": "swam", "Past Participle": "swum" },
 { "Translation": "oscillare", "Base Form": "swing", "Simple Past": "swang", "Past Participle": "swung" },
 { "Translation": "prendere", "Base Form": "take", "Simple Past": "took", "Past Participle": "taken" },
 { "Translation": "insegnare", "Base Form": "teach", "Simple Past": "taught", "Past Participle": "taught" },
 { "Translation": "strappare", "Base Form": "tear", "Simple Past": "tore", "Past Participle": "torn" },
 { "Translation": "raccontare", "Base Form": "tell", "Simple Past": "told", "Past Participle": "told" },
 { "Translation": "pensare", "Base Form": "think", "Simple Past": "thought", "Past Participle": "thought" },
 { "Translation": "tirare / lanciare", "Base Form": "throw", "Simple Past": "threw", "Past Participle": "thrown" },
 { "Translation": "spingere", "Base Form": "thrust", "Simple Past": "thrust", "Past Participle": "thrust" },
 { "Translation": "calpestare", "Base Form": "tread", "Simple Past": "trod", "Past Participle": "trodden" },
 { "Translation": "capire", "Base Form": "understand", "Simple Past": "understood", "Past Participle": "understood" },
 { "Translation": "turbare / arrabbiare", "Base Form": "upset", "Simple Past": "upset", "Past Participle": "upset" },
 { "Translation": "svegliare / svegliarsi", "Base Form": "wake", "Simple Past": "woke", "Past Participle": "woken" },
 { "Translation": "indossare", "Base Form": "wear", "Simple Past": "wore", "Past Participle": "worn" },
 { "Translation": "intrecciare", "Base Form": "weave", "Simple Past": "wove", "Past Participle": "woven" },
 { "Translation": "piangere", "Base Form": "weep", "Simple Past": "wept", "Past Participle": "wept" },
 { "Translation": "vincere", "Base Form": "win", "Simple Past": "won", "Past Participle": "won" },
 { "Translation": "avvolgere", "Base Form": "wind", "Simple Past": "wound", "Past Participle": "wound" },
 { "Translation": "torcere/ strizzare", "Base Form": "wring", "Simple Past": "wrung", "Past Participle": "wrung" },
 { "Translation": "scrivere", "Base Form": "write", "Simple Past": "wrote", "Past Participle": "written" }
];

        // Inizializzazione
        window.onload = function() {
            loadSettings();
            if (!localStorage.getItem("difficulty")) {
                isFirstTime = true;
            } else {
                isFirstTime = false;
            }
            showSettings();
        }
        // Add this helper function after the existing functions
        function getRandomColumn() {
            const columns = ['translation', 'base', 'past', 'participle'];
            return columns[Math.floor(Math.random() * columns.length)];
        }

        // Updated showSettings function
        function showSettings() {
            // Stop any running timer
            if (stopwatchInterval) {
                clearInterval(stopwatchInterval);
            }
           
            // Show settings panel
            document.getElementById("settings-panel").classList.remove("hidden");
           
            // Hide control panel
            document.getElementById("control-panel").classList.add("hidden");
           
            // Clear test content
            document.getElementById("test").innerHTML = "";
           
            // Hide all control buttons including the new ones
            hideAllControlButtons();
           
            // Reset timer display
            document.getElementById("timer").innerText = "0s";
            document.getElementById("timer").className = "timer";
           
            // Load settings
            loadSettings();
        }

        function hideSettings() {
            document.getElementById("settings-panel").classList.add("hidden");
            document.getElementById("control-panel").classList.remove("hidden");
        }

        // Fixed hideAllControlButtons function with null checks
        function hideAllControlButtons() {
            const buttons = [
                "check-answers",
                "give-up",
                "start-again",
                "settings-again",
                "toggle-timer",
                "restart-level",
                "back-to-settings"
            ];
           
            buttons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.classList.add("hidden");
                }
            });
        }

        function showGameButtons() {
            document.getElementById("check-answers").classList.remove("hidden");
            document.getElementById("give-up").classList.remove("hidden");
            document.getElementById("toggle-timer").classList.remove("hidden");
        }

        function showEndGameButtons() {
            document.getElementById("start-again").classList.remove("hidden");
            document.getElementById("settings-again").classList.remove("hidden");
            hideAllControlButtons();
        }

        function applySettings() {
            const difficulty = document.getElementById("difficulty").value;
            const time = document.getElementById("time").value;
            const numberOfVerbs = document.getElementById("numberOfVerbs").value;

const header = document.getElementById('game-header');
if (header) {
header.style.display = 'none';
}
            // Salva impostazioni
            localStorage.setItem("difficulty", difficulty);
            localStorage.setItem("time", time);
            localStorage.setItem("numberOfVerbs", numberOfVerbs);

            hideSettings();
            updateScoreDisplay(numberOfVerbs);
            showGameButtons();
            startGame();
        }

        function toggleSettings() {
            showSettings();
            loadSettings();
        }

        function loadSettings() {
            const storedNumber = localStorage.getItem("numberOfVerbs");
            const numberOfVerbs = storedNumber ? parseInt(storedNumber) : 10;
            document.getElementById("numberOfVerbs").value = numberOfVerbs;
            updateScoreDisplay(numberOfVerbs);

            const storedDifficulty = localStorage.getItem("difficulty");
            const difficulty = storedDifficulty ? storedDifficulty : "medium";
            document.getElementById("difficulty").value = difficulty;

            const storedTime = localStorage.getItem("time");
            const time = storedTime ? storedTime : "30";
            document.getElementById("time").value = time;
        }

        function updateScoreDisplay(numberOfVerbs) {
            const maxScore = numberOfVerbs || document.getElementById("numberOfVerbs").value || 10;
            document.getElementById("score").innerText = `Score: 0/${maxScore}`;
        }

        // Theme Management System - da aggiungere prima dello script filterVerbs esistente
        const THEME_CONFIG = {
            cookieName: 'site_theme',
            expirationDays: 365,
            themes: {
                light: {
                    name: 'light',
                    icon: 'üåô',
                    title: 'Attiva tema scuro'
                },
                dark: {
                    name: 'dark',
                    icon: '‚òÄÔ∏è',
                    title: 'Attiva tema chiaro'
                }
            }
        };

        // Icon mapping for theme switching
        const ICON_MAPPING = {
            light: {
                'images/home.png': 'images/home.png',
                'images/learn.png': 'images/learn.png',
                'images/train.png': 'images/train.png',
                'images/test.png': 'images/test.png',
                'images/story.png': 'images/story.png'
            },
            dark: {
                'images/home.png': 'images/home1.png',
                'images/learn.png': 'images/learn1.png',
                'images/train.png': 'images/train1.png',
                'images/test.png': 'images/test1.png',
                'images/story.png': 'images/story1.png'
            }
        };

        // Utility functions per gestire i cookie
        function setThemeCookie(name, value, days) {
            let expires = "";
            if (days) {
                let date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            
            let cookieString = `${name}=${value}${expires}; path=/`;
            document.cookie = cookieString;
            console.log(`Theme cookie impostato: ${name}=${value}`);
        }

        function getThemeCookie(name) {
            const value = "; " + document.cookie;
            const parts = value.split("; " + name + "=");
            if (parts.length === 2) {
                const cookieValue = parts.pop().split(";").shift();
                console.log(`Theme cookie letto: ${name}=${cookieValue}`);
                return cookieValue;
            }
            return null;
        }

        // Fallback per localStorage in ambiente locale
        function setLocalTheme(value) {
            if (typeof(Storage) !== "undefined") {
                localStorage.setItem('local_site_theme', value);
                console.log(`LocalStorage theme impostato: ${value}`);
            }
        }

        function getLocalTheme() {
            if (typeof(Storage) !== "undefined") {
                const value = localStorage.getItem('local_site_theme');
                console.log(`LocalStorage theme letto: ${value}`);
                return value;
            }
            return null;
        }

        // Funzione per cambiare le icone della navbar
        function updateNavIcons(theme) {
            const navIcons = document.querySelectorAll('.nav-item img');
            navIcons.forEach(icon => {
                const currentSrc = icon.src;
                const filename = currentSrc.split('/').pop();
                const basePath = currentSrc.substring(0, currentSrc.lastIndexOf('/') + 1);
                
                // Trova la mappatura corretta
                for (const [lightIcon, darkIcon] of Object.entries(ICON_MAPPING.dark)) {
                    const lightFilename = lightIcon.split('/').pop();
                    const darkFilename = darkIcon.split('/').pop();
                    
                    if (theme === 'dark' && filename === lightFilename) {
                        icon.src = basePath + darkFilename;
                        break;
                    } else if (theme === 'light' && filename === darkFilename) {
                        icon.src = basePath + lightFilename;
                        break;
                    }
                }
            });
        }

        // Funzione per applicare il tema
        function applyTheme(themeName) {
            const html = document.documentElement;
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            
            // Applica o rimuove l'attributo data-theme
            if (themeName === 'dark') {
                html.setAttribute('data-theme', 'dark');
            } else {
                html.removeAttribute('data-theme');
                themeName = 'light';
            }
            
            // Aggiorna l'icona e il tooltip del bottone
            const currentTheme = THEME_CONFIG.themes[themeName];
            if (themeIcon && currentTheme) {
                themeIcon.textContent = currentTheme.icon;
                themeToggle.title = currentTheme.title;
            }
            
            // Aggiorna le icone della navbar
            updateNavIcons(themeName);
            
            console.log(`Tema applicato: ${themeName}`);
        }

        function getCurrentTheme() {
            // Prima fonte: attributo data-theme nel DOM
            const domTheme = document.documentElement.getAttribute('data-theme');
            if (domTheme) {
                console.log(`getCurrentTheme -> datasource: DOM, theme=${domTheme}`);
                return domTheme;
            }

            // Altrimenti prova il cookie
            let theme = getThemeCookie(THEME_CONFIG.cookieName);
            if (theme) {
                console.log(`getCurrentTheme -> datasource: cookie, theme=${theme}`);
                return theme;
            }

            // Fallback per ambiente locale: localStorage
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                const local = getLocalTheme();
                if (local) {
                    console.log(`getCurrentTheme -> datasource: localStorage, theme=${local}`);
                    return local;
                }
            }

            // Default
            console.log('getCurrentTheme -> default: light');
            return 'light';
        }

        function toggleTheme() {
            const currentTheme = getCurrentTheme();
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';

            console.log(`Cambio tema da ${currentTheme} a ${newTheme}`);

            // Applica subito il tema al DOM
            applyTheme(newTheme);

            // Salva la scelta
            saveTheme(newTheme);
        }

        // Funzione per salvare il tema
        function saveTheme(theme) {
            setThemeCookie(THEME_CONFIG.cookieName, theme, THEME_CONFIG.expirationDays);
            
            // Fallback per localhost
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                setLocalTheme(theme);
            }
            
            // Notifica altre schede del cambiamento
            if (typeof(Storage) !== "undefined") {
                localStorage.setItem('theme_changed', Date.now().toString());
            }
        }

        // Funzione per sincronizzare tra schede
        function setupThemeCrossTabSync() {
            if (typeof(Storage) !== "undefined") {
                window.addEventListener('storage', function(e) {
                    if (e.key === 'theme_changed') {
                        console.log("Tema cambiato in altra scheda - aggiorno");
                        const currentTheme = getCurrentTheme();
                        applyTheme(currentTheme);
                    }
                });
            }
        }

        // Funzione di inizializzazione del sistema tema
        function initializeThemeSystem() {
            console.log("Inizializzazione sistema tema");
            
            // Applica il tema salvato
            const savedTheme = getCurrentTheme();
            console.log("Tema salvato trovato:", savedTheme);
            applyTheme(savedTheme);
            
            // Configura il toggle button
            setTimeout(() => {
                const themeToggle = document.getElementById('theme-toggle');
                const themeIcon = document.getElementById('theme-icon');
                
                console.log("Cercando elementi tema...");
                console.log("Theme toggle trovato:", !!themeToggle);
                console.log("Theme icon trovato:", !!themeIcon);
                
                if (themeToggle) {
                    // Rimuovi eventuali listener esistenti
                    themeToggle.removeEventListener('click', toggleTheme);
                    
                    // Aggiungi il nuovo listener
                    themeToggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log("Click sul toggle tema!");
                        toggleTheme();
                    });
                    
                    console.log("Event listener tema configurato correttamente");
                } else {
                    console.error("Elemento theme-toggle non trovato!");
                }
            }, 100);
            
            // Configura sincronizzazione tra schede
            setupThemeCrossTabSync();
            
            console.log("Sistema tema inizializzato con tema:", savedTheme);
        }

        // Rendi disponibili le funzioni debug globalmente
        window.getCurrentTheme = getCurrentTheme;
        window.toggleTheme = toggleTheme;

        // Inizializza il sistema tema quando il DOM √® pronto
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM loaded - inizializzo sistema tema");
            initializeThemeSystem();
        });
        
        // Fallback se il DOM √® gi√† caricato
        if (document.readyState !== 'loading') {
            console.log("DOM gi√† caricato - inizializzo sistema tema");
            initializeThemeSystem();
        }

        function filterVerbs(level) {
            let easyVerbs = [
                            "be", "become", "begin", "break", "bring", "build", "burn", "buy", "catch", "choose",
                            "come", "cut", "do", "draw", "dream", "drink", "drive", "eat", "fall", "feel",
                            "find", "forget", "get", "give", "go", "grow", "have", "hear", "hit", "hurt",
                            "keep", "know", "learn", "leave", "let", "lose", "make", "meet", "pay", "put",
                            "read", "ride", "run", "say", "see", "sell", "send", "sing", "sit", "sleep",
                            "speak", "spend", "stand", "swim", "take", "teach", "tell", "think", "understand",
                            "wake", "wear", "win", "write"
            ];

            let mediumVerbs = [
"be", "beat", "become", "begin", "bend", "bite", "blow", "break", "bring", "build", "burn", "buy",
"catch", "choose", "come", "cost", "cut", "deal", "dig", "do", "draw", "dream", "drink", "drive", "eat",
"fall", "feed", "feel", "fight", "find", "fly", "forbid", "forget", "forgive", "freeze", "get", "give",
"go", "grow", "hang", "have", "hear", "hide", "hit", "hold", "hurt", "keep", "kneel", "know", "lay", "lead",
"learn", "leave", "lend", "let", "lie", "light", "lose", "make", "mean", "meet", "pay", "put", "read",
"ride", "ring", "rise", "run", "say", "see", "sell", "send", "set", "sew", "shake", "shine", "shoot",
"show", "shut", "sing", "sink", "sit", "sleep", "smell", "speak", "spell", "spend", "spoil", "stand",
"steal", "stick", "strike", "sweep", "swim", "swing", "take", "teach", "tear", "tell", "think", "throw",
"understand", "wake", "wear", "win", "write"
            ];

            let hardVerbs = [
                            "awake", "be", "bear", "beat", "become", "begin", "bend", "bet", "bid", "bind",
                            "bite", "bleed", "blow", "break", "breed", "bring", "broadcast", "build", "burn", "burst",
                            "buy", "cast", "catch", "choose", "cling", "come", "cost", "creep", "cut", "deal",
                            "dig", "dive", "do", "draw", "dream", "drink", "drive", "eat", "fall", "feed",
                            "feel", "fight", "find", "fit", "flee", "fling", "fly", "forbid", "forget", "forgive",
                            "forsake", "freeze", "get", "give", "go", "grind", "grow", "have", "hang", "hear",
                            "hide", "hit", "hold", "hurt", "keep", "kneel", "know", "lay", "lead", "learn",
                            "leave", "lend", "let", "lie", "light", "lose", "make", "mean", "meet", "misspell",
                            "mistake", "overcome", "overtake", "pay", "plead", "prove", "put", "quit", "read", "ride",
                            "ring", "rise", "run", "say", "see", "seek", "sell", "send", "set", "sew",
                            "shake", "shine", "shoe", "shoot", "show", "shrink", "shut", "sing", "sink", "sit",
                            "sleep", "smell", "slide", "speak", "speed", "spell", "spend", "spill", "spit", "spoil",
                            "spread", "spring", "stand", "steal", "stick", "sting", "stink", "strike", "swear", "sweep",
                            "swim", "swing", "take", "teach", "tear", "tell", "think", "throw", "thrust", "tread",
                            "understand", "upset", "wake", "wear", "weave", "weep", "win", "wind", "wring", "write"
            ];

            return verbs.filter(verb => {
                if (level === "easy") {
                    return easyVerbs.includes(verb["Base Form"]);
                } else if (level === "medium") {
                    return mediumVerbs.includes(verb["Base Form"]);
                } else if (level === "hard") {
                    return hardVerbs.includes(verb["Base Form"]);
                }
                return true;
            });
        }

        function startStopwatch() {
            let remainingTime = elapsedTime || maxTime;
            updateTimerDisplay(remainingTime);

            stopwatchInterval = setInterval(() => {
                remainingTime--;
                elapsedTime = remainingTime;
                updateTimerDisplay(remainingTime);

                // Cambia colore timer in base al tempo rimasto
                const timerElement = document.getElementById("timer");
                const percentage = remainingTime / maxTime;
               
                if (percentage > 0.5) {
                    timerElement.className = "timer";
                } else if (percentage > 0.1) {
                    timerElement.className = "timer warning";
                } else {
                    timerElement.className = "timer danger";
                }

                if (remainingTime <= 0) {
                    clearInterval(stopwatchInterval);
                    giveUp();
                    showModal("‚è∞ Tempo Scaduto!", "Il tempo a disposizione √® terminato!", "error");
                }
            }, 1000);
        }

        function updateTimerDisplay(secondsLeft) {
            const minutes = Math.floor(secondsLeft / 60);
            const seconds = secondsLeft % 60;
            document.getElementById("timer").innerText = `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
        }

        function toggleTimer() {
            const button = document.getElementById("toggle-timer");
            if (isTimerRunning) {
                clearInterval(stopwatchInterval);
                button.innerHTML = "‚ñ∂Ô∏è Riprendi";
                button.className = "btn-control btn-secondary";
            } else {
                startStopwatch();
                button.innerHTML = "‚è∏Ô∏è Pausa";
                button.className = "btn-control btn-pause";
            }
            isTimerRunning = !isTimerRunning;
        }

        function stopStopwatch() {
            clearInterval(stopwatchInterval);
        }

        // Replace the existing startGame() function with this modified version
        function startGame() {
            const difficulty = localStorage.getItem("difficulty") || "medium";
            const time = parseInt(localStorage.getItem("time")) || 30;
            const numberOfVerbs = parseInt(localStorage.getItem("numberOfVerbs")) || 10;

            maxTime = time * 60;
            elapsedTime = maxTime;

            const filteredVerbs = filterVerbs(difficulty);
            selectedVerbs = getRandomVerbsFromList(filteredVerbs, numberOfVerbs);

            updateScoreDisplay(numberOfVerbs);

            let tableHTML = `
                <table class="test-table">
                    <thead>
                        <tr>
                            <th>Translation</th>
                            <th>Base Form</th>
                            <th>Simple Past</th>
                            <th>Past Participle</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
           
            selectedVerbs.forEach(verb => {
                // Get random column to show for this row
                const shownColumn = getRandomColumn();
               
                tableHTML += `<tr>`;
               
                // Translation column
                if (shownColumn === 'translation') {
                    tableHTML += `<td class="given-word">${verb.Translation}</td>`;
                } else {
                    tableHTML += `<td><input type="text" class="verb-input" data-verb="${verb.Translation}" data-form="translation" placeholder="Translation"></td>`;
                }
               
                // Base Form column
                if (shownColumn === 'base') {
                    tableHTML += `<td class="given-word">${verb['Base Form']}</td>`;
                } else {
                    tableHTML += `<td><input type="text" class="verb-input" data-verb="${verb['Base Form']}" data-form="base" placeholder="Base Form"></td>`;
                }
               
                // Simple Past column
                if (shownColumn === 'past') {
                    tableHTML += `<td class="given-word">${verb['Simple Past']}</td>`;
                } else {
                    tableHTML += `<td><input type="text" class="verb-input" data-verb="${verb['Simple Past']}" data-form="past" placeholder="Simple Past"></td>`;
                }
               
                // Past Participle column
                if (shownColumn === 'participle') {
                    tableHTML += `<td class="given-word">${verb['Past Participle']}</td>`;
                } else {
                    tableHTML += `<td><input type="text" class="verb-input" data-verb="${verb['Past Participle']}" data-form="participle" placeholder="Past Participle"></td>`;
                }
               
                tableHTML += `</tr>`;
            });
           
            tableHTML += `
                    </tbody>
                </table>
            `;

            document.getElementById("test").innerHTML = tableHTML;
            startStopwatch();
           
            // Focus sul primo input
            const firstInput = document.querySelector('.verb-input');
            if (firstInput) {
                firstInput.focus();
            }

            // Aggiungi event listeners per navigazione con Tab/Enter
            addInputEventListeners();
        }
        function addInputEventListeners() {
            const inputs = document.querySelectorAll('.verb-input');
            inputs.forEach((input, index) => {
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === 'Tab') {
                        e.preventDefault();
                        const nextIndex = (index + 1) % inputs.length;
                        inputs[nextIndex].focus();
                    }
                });

                // Auto-check mentre si digita
                input.addEventListener('input', function() {
                    const userAnswer = this.value.trim().toLowerCase();
                    const correctAnswer = this.getAttribute('data-verb').toLowerCase();
                   
                    // Rimuovi classi precedenti
                    this.classList.remove('correct', 'wrong');
                   
                    if (userAnswer && userAnswer === correctAnswer) {
                        this.classList.add('correct');
                    }
                });
            });
        }

        function getRandomVerbsFromList(verbsList, numberOfVerbs) {
            const shuffled = verbsList.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, numberOfVerbs);
        }



        // 1. Modified checkAnswers function
function checkAnswers() {
const inputs = document.querySelectorAll('.verb-input');
const numberOfVerbs = parseInt(localStorage.getItem("numberOfVerbs")) || 10;

// Raggruppa gli input per riga (assumendo che ogni riga abbia 3 input: base, past, participle)
const rows = [];
for (let i = 0; i < inputs.length; i += 3) {
rows.push([inputs[i], inputs[i + 1], inputs[i + 2]]);
}

let correctRows = 0;
let totalCellsCorrect = 0;

// Controlla ogni riga
rows.forEach(row => {
let rowCorrect = true;
let rowCellsCorrect = 0;

// Controlla ogni cella nella riga
row.forEach(input => {
const userAnswer = input.value.trim().toLowerCase();
const correctAnswer = input.getAttribute('data-verb').toLowerCase();

// Rimuovi classi precedenti
input.classList.remove('correct', 'wrong', 'revealed');

function normalizeAnswer(answer) {
  return answer
    .toLowerCase()
    .split(/\/|,|-/) // separatori: / , -
    .map(word => word.trim())
    .filter(word => word); // rimuove vuoti
}

const userOptions = normalizeAnswer(userAnswer);
const correctOptions = normalizeAnswer(correctAnswer);

// ‚úÖ Corretto se almeno UNA parola dell'utente √® tra quelle corrette
const isCorrect = userOptions.some(word => correctOptions.includes(word));



if (isCorrect) {
input.classList.add('correct');
rowCellsCorrect++;
totalCellsCorrect++;
} else {
rowCorrect = false;
if (userAnswer !== '') {
input.classList.add('wrong');
}
// Mostra la risposta corretta
input.value = input.getAttribute('data-verb');
input.classList.add('revealed');
}

// Disabilita l'input
input.disabled = true;
});

// Se tutta la riga √® corretta, incrementa il contatore delle righe corrette
if (rowCorrect) {
correctRows++;
}
});

// Aggiorna il punteggio basandoti sulle righe corrette
score = correctRows;
document.getElementById("score").innerText = `Score: ${correctRows}/${numberOfVerbs}`;

// Ferma il timer
stopStopwatch();
isTimerRunning = false;

// Mostra risultato
showResultModal(correctRows, numberOfVerbs);

// Mostra bottoni di fine gioco con nuove opzioni
showEndGameButtonsWithOptions();
}

        function showResultModal(correct, total) {
            const percentage = Math.round((correct / total) * 100);
            let title, message, type;

            if (percentage >= 90) {
                title = "üèÜ Eccellente!";
                message = `Hai risposto correttamente a ${correct} su ${total} domande (${percentage}%). Complimenti!`;
                type = "success";
            } else if (percentage >= 70) {
                title = "üëç Molto Bene!";
                message = `Hai risposto correttamente a ${correct} su ${total} domande (${percentage}%). Buon lavoro!`;
                type = "success";
            } else if (percentage >= 50) {
                title = "üìö Da Migliorare";
                message = `Hai risposto correttamente a ${correct} su ${total} domande (${percentage}%). Continua a studiare!`;
                type = "warning";
            } else {
                title = "üí™ Non Mollare!";
                message = `Hai risposto correttamente a ${correct} su ${total} domande (${percentage}%). Riprova, ce la puoi fare!`;
                type = "error";
            }

            showModal(title, message, type);
        }

        // 2. Modified giveUp function
        function giveUp() {
            const inputs = document.querySelectorAll('.verb-input');
           
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    input.value = input.getAttribute('data-verb');
                    input.classList.add('revealed');
                }
                input.disabled = true;
            });

            stopStopwatch();
            isTimerRunning = false;
           
            // Calcola comunque il punteggio delle risposte corrette
            let correctAnswers = 0;
            inputs.forEach(input => {
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = input.getAttribute('data-verb').toLowerCase();
                if (userAnswer === correctAnswer && !input.classList.contains('revealed')) {
                    correctAnswers++;
                    input.classList.add('correct');
                }
            });

            const numberOfVerbs = parseInt(localStorage.getItem("numberOfVerbs")) || 10;
            document.getElementById("score").innerText = `Score: ${correctAnswers}/${numberOfVerbs}`;
           
            showModal("üòì Test Terminato", "Hai visualizzato tutte le risposte. Studia e riprova!", "warning");
           
            // Mostra bottoni di fine gioco con nuove opzioni
            showEndGameButtonsWithOptions();
        }
                // 3. New function to show end game buttons with new options
        function showEndGameButtonsWithOptions() {
            document.getElementById("check-answers").classList.add("hidden");
            document.getElementById("give-up").classList.add("hidden");
            document.getElementById("toggle-timer").classList.add("hidden");
           
            // Show the new navigation buttons
            document.getElementById("restart-level").classList.remove("hidden");
            document.getElementById("back-to-settings").classList.remove("hidden");
        }

        // 4. New function to restart current level
        function restartLevel() {
            // Reset variabili
            score = 0;
            elapsedTime = 0;
            isTimerRunning = true;
           
            // Reset timer button
            const timerButton = document.getElementById("toggle-timer");
            timerButton.innerHTML = "‚è∏Ô∏è Pausa";
            timerButton.className = "btn-control btn-pause";
           
            // Nascondi modal se aperto
            hideModal();
           
            // Hide navigation buttons and show game buttons
            document.getElementById("restart-level").classList.add("hidden");
            document.getElementById("back-to-settings").classList.add("hidden");
           
            // Riavvia il gioco con le stesse impostazioni
            startGame();
            showGameButtons();
        }
// Debug version - use this temporarily to see what's happening
        // Clean version of backToSettings (replace the debug version with this)
        function backToSettings() {
            // Stop any running timer
            if (stopwatchInterval) {
                clearInterval(stopwatchInterval);
            }
           
            // Reset all variables
            score = 0;
            elapsedTime = 0;
            isTimerRunning = true;
           
            // Reset timer button to initial state
            const timerButton = document.getElementById("toggle-timer");
            if (timerButton) {
                timerButton.innerHTML = "‚è∏Ô∏è Pausa";
                timerButton.className = "btn-control btn-pause";
            }
           
            // Hide modal if open
            hideModal();
           
            // Hide navigation buttons
            const restartBtn = document.getElementById("restart-level");
            const backBtn = document.getElementById("back-to-settings");
           
            if (restartBtn) restartBtn.classList.add("hidden");
            if (backBtn) backBtn.classList.add("hidden");
           
            // Show settings panel and hide control panel
            const settingsPanel = document.getElementById("settings-panel");
            const controlPanel = document.getElementById("control-panel");
           
            if (settingsPanel) settingsPanel.classList.remove("hidden");
            if (controlPanel) controlPanel.classList.add("hidden");
           
            // Clear the test area
            const testArea = document.getElementById("test");
            if (testArea) testArea.innerHTML = "";
           
            // Reset timer display
            const timerElement = document.getElementById("timer");
            if (timerElement) {
                timerElement.innerText = "0s";
                timerElement.className = "timer";
            }
           
            // Load current settings into the form
            loadSettings();
        }
        function startAgain() {
            // Reset variabili
            score = 0;
            elapsedTime = 0;
            isTimerRunning = true;
           
            // Reset timer button
            const timerButton = document.getElementById("toggle-timer");
            timerButton.innerHTML = "‚è∏Ô∏è Pausa";
            timerButton.className = "btn-control btn-pause";
           
            // Nascondi modal se aperto
            hideModal();
           
            // Riavvia il gioco
            startGame();
            showGameButtons();
        }

        function showModal(title, message, type = "success") {
            const modal = document.getElementById("message-modal");
            const modalTitle = document.getElementById("modal-title");
            const modalText = document.getElementById("modal-text");

            modalTitle.textContent = title;
            modalText.textContent = message;
           
            modal.className = `modal ${type} fade-in`;
            modal.classList.remove("hidden");

            // Auto-hide dopo 4 secondi
            setTimeout(() => {
                hideModal();
            }, 4000);

            // Click per chiudere
            modal.onclick = function(e) {
                if (e.target === modal) {
                    hideModal();
                }
            };
        }

        function hideModal() {
            const modal = document.getElementById("message-modal");
            modal.classList.add("fade-out");
            setTimeout(() => {
                modal.classList.add("hidden");
                modal.classList.remove("fade-in", "fade-out");
                modal.className = "modal hidden";
            }, 300);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (!document.getElementById("check-answers").classList.contains("hidden")) {
                        checkAnswers();
                    }
                } else if (e.key === ' ') {
                    e.preventDefault();
                    if (!document.getElementById("toggle-timer").classList.contains("hidden")) {
                        toggleTimer();
                    }
                }
            }
           
            if (e.key === 'Escape') {
                hideModal();
            }
        });

        // Previeni il refresh accidentale durante il test
        window.addEventListener('beforeunload', function (e) {
            if (!document.getElementById("control-panel").classList.contains("hidden") &&
                !document.getElementById("start-again").classList.contains("hidden") === false) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>

    <!-- Cookie Banner - Sostituisci il div esistente con questo -->
    <div id="cookie-banner" style="
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        z-index: 9999;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(3px);
    ">
        <div style="
            background: #fff;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            margin: 1rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            animation: slideIn 0.3s ease-out;
        ">
            <h3 style="margin: 0 0 1rem 0; color: #333; font-size: 1.2em;">
                üç™ Informativa Cookie
            </h3>
            <p style="margin-bottom: 1.5rem; color: #666; line-height: 1.5;">
                Utilizziamo i cookie per personalizzare gli annunci e misurare il traffico. 
                I tuoi dati sono sicuri e rispettiamo la tua privacy.
                <br>
                <a href="/privacy.html" target="_blank" style="color: #2563eb; text-decoration: underline;">
                    Scopri di pi√π
                </a>
            </p>
            <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                <button id="accept-cookies" style="
                    padding: 0.75rem 1.5rem; 
                    background: linear-gradient(135deg, #10b981, #059669); 
                    color: white; 
                    border: none; 
                    border-radius: 8px; 
                    cursor: pointer;
                    font-weight: 600;
                    transition: transform 0.2s, box-shadow 0.2s;
                    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
                " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.4)'" 
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(16, 185, 129, 0.3)'">
                    ‚úì Accetta e Impara
                </button>
                <button id="reject-cookies" style="
                    padding: 0.75rem 1.5rem; 
                    background: #6b7280; 
                    color: white; 
                    border: none; 
                    border-radius: 8px; 
                    cursor: pointer;
                    font-weight: 600;
                    transition: background 0.2s;
                " onmouseover="this.style.background='#4b5563'" onmouseout="this.style.background='#6b7280'">
                    ‚úó Rifiuta
                </button>
            </div>
            <p style="margin-top: 1rem; font-size: 0.8em; color: #9ca3af;">
                La tua scelta verr√† ricordata per tutte le pagine del sito
            </p>
        </div>
    </div>

    <style>
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px) scale(0.95);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    /* Responsive per il banner cookie */
    @media (max-width: 480px) {
        #cookie-banner > div {
            margin: 0.5rem;
            padding: 1.5rem;
        }
        
        #cookie-banner h3 {
            font-size: 1.1em;
        }
        
        #cookie-banner button {
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        #cookie-banner > div > div {
            flex-direction: column;
        }
    }
    </style>



    <footer style="text-align: center; margin-top: 2rem; font-size: 0.9em;">
        <p>¬© 2025 LearnWithMe - All rights reserved</p>
        <p><a href="privacy.html">Privacy & Cookie Policy</a></p>
    </footer>
    <script>
        // Cookie Consent Manager - Codice da utilizzare su tutte le pagine
        // Sostituisci il codice JavaScript esistente con questo

        // Configurazione
        const COOKIE_CONFIG = {
            consentCookieName: 'cookie_consent',
            expirationDays: 365,
            // Per localhost non impostiamo domain, per domini reali s√¨
            domain: (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') ? null : window.location.hostname,
            adsClientId: 'ca-pub-8624143381240320' // Il tuo client ID reale
        };

        // Utility functions per gestire i cookie
        function setCookie(name, value, days, domain = null) {
            let expires = "";
            if (days) {
                let date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            
            // Per localhost usiamo un approccio pi√π semplice
            let cookieString = `${name}=${value}${expires}; path=/`;
            
            // Solo per domini reali (non localhost) aggiungiamo domain e SameSite
            if (domain && !window.location.hostname.includes('localhost') && !window.location.hostname.includes('127.0.0.1')) {
                cookieString += `; domain=${domain}; SameSite=Lax`;
            }
            
            document.cookie = cookieString;
            console.log(`Cookie impostato: ${name}=${value} su ${window.location.hostname}`);
            console.log(`Stringa cookie completa: ${cookieString}`);
        }

        function getCookie(name) {
            const value = "; " + document.cookie;
            const parts = value.split("; " + name + "=");
            if (parts.length === 2) {
                const cookieValue = parts.pop().split(";").shift();
                console.log(`Cookie letto: ${name}=${cookieValue}`);
                return cookieValue;
            }
            console.log(`Cookie non trovato: ${name}`);
            return null;
        }

        function deleteCookie(name, domain = null) {
            // Prova pi√π varianti per essere sicuri di eliminare il cookie
            const paths = ['/', ''];
            const domains = domain ? [domain, `.${domain}`, ''] : [''];
            
            paths.forEach(path => {
                domains.forEach(dom => {
                    let cookieString = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${path};`;
                    if (dom && !window.location.hostname.includes('localhost')) {
                        cookieString += ` domain=${dom};`;
                    }
                    document.cookie = cookieString;
                });
            });
            
            console.log(`Cookie eliminato: ${name}`);
        }

        // Funzione per caricare Google Ads
        function loadGoogleAds() {
            // Verifica se gli ads sono gi√† stati caricati
            if (window.adsLoaded) {
                console.log("Google Ads gi√† caricati");
                return;
            }
            
            // In localhost non carichiamo gli ads reali
            if (location.hostname === "localhost" || location.hostname === "127.0.0.1" || location.hostname.includes('file://')) {
                console.log("Ambiente locale - simulo caricamento Google Ads");
                window.adsLoaded = true;
                return;
            }
            
            if (location.hostname === "learnwithme.work") {
                try {
                    var adsScript = document.createElement('script');
                    adsScript.src = `https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${COOKIE_CONFIG.adsClientId}`;
                    adsScript.setAttribute("crossorigin", "anonymous");
                    adsScript.async = true;
                    adsScript.onload = function() {
                        window.adsLoaded = true;
                        console.log("Google Ads caricati con successo");
                    };
                    adsScript.onerror = function() {
                        console.error("Errore nel caricamento di Google Ads");
                    };
                    document.head.appendChild(adsScript);
                } catch (error) {
                    console.error("Errore durante l'inizializzazione di Google Ads:", error);
                }
            } else {
                console.log("Google Ads non caricati (ambiente di sviluppo)");
            }
        }

        // Funzioni per gestire il banner
        function showCookieBanner() {
            const banner = document.getElementById('cookie-banner');
            if (banner) {
                banner.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                console.log("Banner cookie mostrato");
            }
        }

        function hideCookieBanner() {
            const banner = document.getElementById('cookie-banner');
            if (banner) {
                banner.style.display = 'none';
                document.body.style.overflow = '';
                console.log("Banner cookie nascosto");
            }
        }

        // Fallback per localStorage in ambiente locale
        function setLocalConsent(value) {
            if (typeof(Storage) !== "undefined") {
                localStorage.setItem('local_cookie_consent', value);
                console.log(`LocalStorage consent impostato: ${value}`);
            }
        }

        function getLocalConsent() {
            if (typeof(Storage) !== "undefined") {
                const value = localStorage.getItem('local_cookie_consent');
                console.log(`LocalStorage consent letto: ${value}`);
                return value;
            }
            return null;
        }

        // Funzione principale per gestire il consenso
        function handleCookieConsent() {
            let consent = getCookie(COOKIE_CONFIG.consentCookieName);
            
            // Se siamo in localhost e non troviamo cookie, prova localStorage
            if (!consent && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')) {
                consent = getLocalConsent();
                console.log("Localhost: usando localStorage per consenso:", consent);
            }
            
            console.log("Stato consenso finale:", consent);
            
            if (consent === "accepted") {
                console.log("Consenso gi√† dato - caricamento Google Ads");
                loadGoogleAds();
                hideCookieBanner();
            } else if (consent === "rejected") {
                console.log("Consenso rifiutato - nessun ads");
                hideCookieBanner();
            } else {
                console.log("Nessun consenso trovato - mostra banner");
                showCookieBanner();
            }
        }

        // Funzione per accettare i cookie
        function acceptCookies() {
            console.log("Utente ha accettato i cookie");
            setCookie(COOKIE_CONFIG.consentCookieName, "accepted", COOKIE_CONFIG.expirationDays, COOKIE_CONFIG.domain);
            
            // Fallback per localhost
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                setLocalConsent("accepted");
            }
            
            hideCookieBanner();
            loadGoogleAds();
            
            // Notifica altre schede aperte del cambiamento
            if (typeof(Storage) !== "undefined") {
                localStorage.setItem('cookie_consent_changed', Date.now().toString());
            }
        }

        // Funzione per rifiutare i cookie
        function rejectCookies() {
            console.log("Utente ha rifiutato i cookie");
            setCookie(COOKIE_CONFIG.consentCookieName, "rejected", COOKIE_CONFIG.expirationDays, COOKIE_CONFIG.domain);
            
            // Fallback per localhost
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                setLocalConsent("rejected");
            }
            
            hideCookieBanner();
            
            // Notifica altre schede aperte del cambiamento
            if (typeof(Storage) !== "undefined") {
                localStorage.setItem('cookie_consent_changed', Date.now().toString());
            }
        }

        // Listener per cambiamenti di consenso in altre schede
        function setupCrossTabSync() {
            if (typeof(Storage) !== "undefined") {
                window.addEventListener('storage', function(e) {
                    if (e.key === 'cookie_consent_changed') {
                        console.log("Consenso cookie cambiato in altra scheda - aggiorno");
                        handleCookieConsent();
                    }
                });
            }
        }

        // Inizializzazione quando il DOM √® pronto
        function initializeCookieConsent() {
            console.log("Inizializzazione gestione cookie consent");
            
            // Gestisci il consenso esistente
            handleCookieConsent();
            
            // Configura la sincronizzazione tra schede
            setupCrossTabSync();
            
            // Aggiungi event listeners ai pulsanti
            const acceptButton = document.getElementById("accept-cookies");
            if (acceptButton) {
                acceptButton.addEventListener("click", acceptCookies);
            }
            
            const rejectButton = document.getElementById("reject-cookies");
            if (rejectButton) {
                rejectButton.addEventListener("click", rejectCookies);
            }
            
            console.log("Gestione cookie consent inizializzata");
        }

        // Debug function - rimuovi in produzione
        function debugCookies() {
            console.log("=== DEBUG COOKIES ===");
            console.log("Hostname:", location.hostname);
            console.log("Tutti i cookie:", document.cookie);
            console.log("Consenso corrente:", getCookie(COOKIE_CONFIG.consentCookieName));
            console.log("Domain config:", COOKIE_CONFIG.domain);
            console.log("Ads caricati:", window.adsLoaded || false);
            console.log("localStorage consent:", localStorage.getItem('cookie_consent_changed'));
            
            // Test manuale cookie
            console.log("--- TEST COOKIE ---");
            setCookie('test_cookie', 'test_value', 1, COOKIE_CONFIG.domain);
            console.log("Cookie test impostato:", getCookie('test_cookie'));
            deleteCookie('test_cookie', COOKIE_CONFIG.domain);
            console.log("Cookie test dopo eliminazione:", getCookie('test_cookie'));
            console.log("====================");
        }

        // Funzione per resettare i cookie (utile per test)
        function resetCookieConsent() {
            deleteCookie(COOKIE_CONFIG.consentCookieName, COOKIE_CONFIG.domain);
            if (typeof(Storage) !== "undefined") {
                localStorage.removeItem('cookie_consent_changed');
                localStorage.removeItem('local_cookie_consent'); // Rimuovi anche il fallback localStorage
            }
            window.adsLoaded = false;
            console.log("Consenso cookie resettato completamente");
            location.reload();
        }

        // Avvia l'inizializzazione quando il DOM √® pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeCookieConsent);
        } else {
            initializeCookieConsent();
        }

        // Rendi disponibili le funzioni debug globalmente (rimuovi in produzione)
        window.debugCookies = debugCookies;
        window.resetCookieConsent = resetCookieConsent;
    </script>


</body>
</html>